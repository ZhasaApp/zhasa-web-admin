import{U as Ve}from"./maska-82a16b27.js";import{C as Z,b as oe,R as le,l as Ne,_ as Oe,B as R,a as Ie,T as V,D as je,c as Pe}from"./DeleteModal-a4447fae.js";import{d as K,r as s,w,_ as W,a as m,u as Je,o as S,h as I,f as B,q as j,b as _,c as D,j as Q,v as te,e as r,x as me,i as N,g as T,m as ze,t as x,p as Le,k as qe,l as he,n as He,s as Ke,F as We}from"./index-3b4e784d.js";import{E as Ge}from"./EditUserModal-cb474307.js";const Qe=K({components:{CustomButton:Z,CustomModal:oe},props:{modalTitle:{type:String,default:"Создать нового пользователя"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,brands:Array,branches:Array},setup(e){const t=s(""),d=s(""),u=s(""),h=s(""),f=s(),p=s([]),i=s(!1);w(()=>e.modalActive,()=>{t.value="",d.value="",u.value="",h.value="",f.value=void 0,p.value=[],i.value=!1});const v=(b,l)=>l.label.toLowerCase().indexOf(b.toLowerCase())>=0,a=b=>{h.value=b,M()},c=b=>{f.value=b,M()},k=b=>{p.value=b,M()},M=()=>{t.value.length>0&&d.value.length>0&&u.value.length==16&&h.value.length>0&&(h.value=="owner"||f.value&&p.value.length>0)?i.value=!0:i.value=!1};return{firstName:t,lastName:d,telephoneNumber:u,selectedRole:h,selectedBranchId:f,selectedBrandsIds:p,filterOption:v,onRoleSelected:a,onBranchSelected:c,onBrandSelected:k,validate:M,isAllDataEntered:i}},directives:{maska:Ve},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1},roleOptions:le}},methods:{onCreateButtonClick(){this.$emit("createUser",{firstName:this.firstName,lastName:this.lastName,telephoneNumber:this.telephoneNumber,role:this.selectedRole,brand_ids:this.selectedBrandsIds,branch_id:this.selectedBranchId})}}});const Xe={class:"modal-content"},Ye={class:"button-box"};function Ze(e,t,d,u,h,f){const p=m("a-select"),i=m("a-alert"),v=m("CustomButton"),a=m("CustomModal"),c=Je("maska");return S(),I(a,{onClose:j(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:B(()=>{var k,M,b;return[_("div",Xe,[(S(),D("form",{onSubmit:t[12]||(t[12]=j((...l)=>e.onCreateButtonClick&&e.onCreateButtonClick(...l),["prevent"])),key:e.modalActive.toString()},[Q(_("input",{placeholder:"Имя",type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>e.firstName=l),onInput:t[1]||(t[1]=(...l)=>e.validate&&e.validate(...l)),class:"inputFirstName"},null,544),[[te,e.firstName]]),Q(_("input",{placeholder:"Фамилия",type:"text","onUpdate:modelValue":t[2]||(t[2]=l=>e.lastName=l),onInput:t[3]||(t[3]=(...l)=>e.validate&&e.validate(...l)),class:"inputLastName"},null,544),[[te,e.lastName]]),Q(_("input",{placeholder:"+7 ___ ___ __ __","data-maska":"+7 ### ### ## ##","onUpdate:modelValue":t[4]||(t[4]=l=>e.telephoneNumber=l),onInput:t[5]||(t[5]=(...l)=>e.validate&&e.validate(...l)),class:"inputTelephone"},null,544),[[c],[te,e.telephoneNumber]]),r(p,{modelValue:e.selectedRole,"onUpdate:modelValue":t[6]||(t[6]=l=>e.selectedRole=l),placeholder:"Выберите роль",style:{width:"100%"},options:e.roleOptions.map(l=>({label:l.text,value:l.value})),onChange:t[7]||(t[7]=l=>e.onRoleSelected(l))},null,8,["modelValue","options"]),Q(r(p,{modelValue:e.selectedBranchId,"onUpdate:modelValue":t[8]||(t[8]=l=>e.selectedBranchId=l),"show-search":"",placeholder:"Выберите филиал",style:{width:"100%",margin:"24px auto"},options:(k=e.branches)==null?void 0:k.map(l=>({label:l.title.toString(),value:l.id.toString()})),"filter-option":e.filterOption,onChange:t[9]||(t[9]=l=>e.onBranchSelected(l))},null,8,["modelValue","options","filter-option"]),[[me,e.selectedRole=="branch_director"||e.selectedRole=="sales_manager"]]),Q(r(p,{modelValue:e.selectedBrandsIds,"onUpdate:modelValue":t[10]||(t[10]=l=>e.selectedBrandsIds=l),mode:"multiple","show-search":"",placeholder:"Выберите бренд",class:"selector-with_multiple-select",options:(M=e.brands)==null?void 0:M.map(l=>({label:l.title.toString(),value:l.id.toString()})),"filter-option":e.filterOption,onChange:t[11]||(t[11]=l=>e.onBrandSelected(l)),showArrow:""},null,8,["modelValue","options","filter-option"]),[[me,e.selectedRole=="branch_director"||e.selectedRole=="sales_manager"]]),(((b=e.errorMessage)==null?void 0:b.length)??0)>0?(S(),I(i,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),_("div",Ye,[r(v,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(v,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:B(()=>[T(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const xe=W(Qe,[["render",Ze],["__scopeId","data-v-e2ab15a9"]]),et=K({name:"ActionsBlock",props:{branches:Array,brands:Array,allSelected:Boolean,selectedUsers:Array},setup(e,{emit:t}){const d=s([]),u=s([]),h=s([]),f=s(e.allSelected);return w(d,k=>{t("updateRolesFilter",k)}),w(u,k=>{console.log("branches",e.branches),t("updateBrandsFilter",k)}),w(h,k=>{t("updateBranchesFilter",k)}),w(()=>e.allSelected,k=>{f.value=k}),{selectedRoles:d,selectedBrands:u,selectedBranches:h,allSelected:f,toggleAll:()=>{t("toggleAll")},handleEditRole:()=>{t("editRoleClicked")},handleEditBranch:()=>{t("editBranchClicked")},handleEditBrand:()=>{t("editBrandClicked")},handleDeleteUsers:()=>{t("deleteUserClicked")},roleOptions:le}}});const tt={class:"outer_actions_block"},ot={class:"actions_first_block"},lt=_("span",{class:"deleteText"},"Удалить",-1),nt={class:"actions_inner_cards"},at={key:0,class:"innerSpan"},st={key:0,class:"innerSpan"},rt={key:0,class:"innerSpan"};function dt(e,t,d,u,h,f){var l,F;const p=m("v-checkbox"),i=m("v-icon"),v=m("v-btn"),a=m("v-list-item-content"),c=m("v-list-item"),k=m("v-list"),M=m("v-menu"),b=m("v-select");return S(),D("div",tt,[_("div",ot,[r(p,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=g=>e.allSelected=g),onChange:e.toggleAll},null,8,["modelValue","onChange"]),r(M,null,{activator:B(({props:g})=>{var O,G;return[r(v,ze({color:"primary"},g,{variant:(((O=e.selectedUsers)==null?void 0:O.length)??0)>0?"tonal":"text",disabled:(((G=e.selectedUsers)==null?void 0:G.length)??0)===0,style:{width:"270px","text-align":"left"}}),{default:B(()=>{var P,J,z;return[T(x((((P=e.selectedUsers)==null?void 0:P.length)??0)>0?"Выбрано пользователей "+(((J=e.selectedUsers)==null?void 0:J.length)??0)+"  ":"Выбрать все")+" ",1),(((z=e.selectedUsers)==null?void 0:z.length)??0)>0?(S(),I(i,{key:0},{default:B(()=>[T("mdi-chevron-down")]),_:1})):N("",!0)]}),_:2},1040,["variant","disabled"])]}),default:B(()=>[r(k,null,{default:B(()=>[r(c,{onClick:e.handleEditRole},{default:B(()=>[r(a,null,{default:B(()=>[T("Поменять роль")]),_:1})]),_:1},8,["onClick"]),r(c,{onClick:e.handleEditBranch},{default:B(()=>[r(a,null,{default:B(()=>[T("Поменять филиал")]),_:1})]),_:1},8,["onClick"]),r(c,{onClick:e.handleEditBrand},{default:B(()=>[r(a,null,{default:B(()=>[T("Поменять бренд")]),_:1})]),_:1},8,["onClick"]),r(c,{onClick:e.handleDeleteUsers},{default:B(()=>[r(a,null,{default:B(()=>[lt]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_("div",nt,[r(b,{modelValue:e.selectedRoles,"onUpdate:modelValue":t[1]||(t[1]=g=>e.selectedRoles=g),items:e.roleOptions,"item-title":"text","item-value":"value",multiple:"",chip:"","small-chips":"",style:{width:"144px"},placeholder:"Роли",variant:"outlined",color:"#1CB5C2","bg-color":"#00000000","placeholder-color":"red",class:"demo"},{selection:B(({index:g})=>[g===0?(S(),D("span",at,"Роли")):N("",!0)]),_:1},8,["modelValue","items"]),r(b,{modelValue:e.selectedBrands,"onUpdate:modelValue":t[2]||(t[2]=g=>e.selectedBrands=g),items:(l=e.brands)==null?void 0:l.map(g=>({text:g.title.toString(),value:g.id.toString()})),"item-title":"text","item-value":"value",multiple:"",chip:"","small-chips":"",style:{width:"144px"},placeholder:"Бренды",variant:"outlined",color:"#1CB5C2","bg-color":"#00000000","placeholder-color":"red"},{selection:B(({index:g})=>[g===0?(S(),D("span",st,"Бренд")):N("",!0)]),_:1},8,["modelValue","items"]),r(b,{modelValue:e.selectedBranches,"onUpdate:modelValue":t[3]||(t[3]=g=>e.selectedBranches=g),items:(F=e.branches)==null?void 0:F.map(g=>({text:g.title.toString(),value:g.id.toString()})),"item-title":"text","item-value":"value",multiple:"",chip:"","small-chips":"",style:{width:"144px"},placeholder:"Филиал",variant:"outlined",color:"#1CB5C2","bg-color":"#00000000","placeholder-color":"red"},{selection:B(({index:g})=>[g===0?(S(),D("span",rt,"Филиалы")):N("",!0)]),_:1},8,["modelValue","items"])])])}const ve=W(et,[["render",dt]]),ut=K({name:"HeaderBar",components:{ActionsBlock:ve,CustomButton:Z},props:{isCreate:{type:Boolean,default:!1},handleSearch:{type:Function,required:!0},branches:Array,brands:Array,allSelected:Boolean,selectedUsers:Array},data(){},setup(e,{emit:t}){const d=s(""),u=s(e.allSelected),h=Ne.debounce(l=>{e.handleSearch(l)},700),f=l=>{d.value=l,h(l)};return w(()=>e.allSelected,l=>{u.value=l}),{inputValue:d,allSelected:u,handleInput:f,handleUpdateRolesFilter:l=>{t("updateRolesFilter",l)},handleUpdateBrandsFilter:l=>{t("updateBrandsFilter",l)},handleUpdateBranchesFilter:l=>{t("updateBranchesFilter",l)},handleRoleUpdate:()=>{t("editRoleClicked")},handleBrandUpdate:()=>{t("editBrandClicked")},handleBranchUpdate:()=>{t("editBranchClicked")},toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteUserClicked")}}}});const it=e=>(Le("data-v-ef2f1223"),e=e(),qe(),e),ct={class:"header_container"},pt={class:"header-body"},mt={class:"input-wrapper"},ht=it(()=>_("img",{src:Oe,class:"search-icon",alt:"Search"},null,-1));function vt(e,t,d,u,h,f){const p=m("CustomButton"),i=m("ActionsBlock");return S(),D("div",ct,[_("div",pt,[_("div",mt,[ht,Q(_("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=v=>e.inputValue=v),onInput:t[1]||(t[1]=v=>e.handleInput(e.inputValue))},null,544),[[te,e.inputValue]])]),r(p,{onClick:t[2]||(t[2]=v=>e.$emit("modalToggler"))},{default:B(()=>[T(x(e.isCreate?"Создать":"Добавить"),1)]),_:1})]),r(i,{brands:e.brands,branches:e.branches,allSelected:e.allSelected,onUpdateRolesFilter:e.handleUpdateRolesFilter,onUpdateBrandsFilter:e.handleUpdateBrandsFilter,onUpdateBranchesFilter:e.handleUpdateBranchesFilter,onEditRoleClicked:e.handleRoleUpdate,onEditBrandClicked:e.handleBrandUpdate,onEditBranchClicked:e.handleBranchUpdate,onDeleteUserClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedUsers:e.selectedUsers},null,8,["brands","branches","allSelected","onUpdateRolesFilter","onUpdateBrandsFilter","onUpdateBranchesFilter","onEditRoleClicked","onEditBrandClicked","onEditBranchClicked","onDeleteUserClicked","onToggleAll","selectedUsers"])])}const gt=W(ut,[["render",vt],["__scopeId","data-v-ef2f1223"]]);function Bt(){const e=s([]),t=s(!0);let d=s(0);const u=57,h=s(12),f=()=>{const v=window.innerHeight;h.value=Math.floor((v-310)/u)};he(()=>{f(),window.addEventListener("resize",f),i(1,"",[],[],[],void 0)}),He(()=>{window.removeEventListener("resize",f)});const p={Authorization:V},i=async(v,a,c,k,M,b)=>{var l,F;try{const g=c.map(L=>`&role_keys=${encodeURIComponent(L)}`).join("&"),O=k.map(L=>`&brand_ids=${encodeURIComponent(L)}`).join("&"),G=M.map(L=>`&branch_ids=${encodeURIComponent(L)}`).join("&"),P=!b||b.sortState==="none"?"":`&sort_field=${b.columnName=="fullName"?"fio":"branch"}&sort_type=${b.sortState}`;console.log("roleKeysParams=",g),console.log("sortParams=",P);const J=`${R}/users?page=${v-1}&size=${h.value}${g}${O}${G}${P}&search=${a}`;console.log("url=",J);const z=await Ie.get(J,{headers:p});e.value=(l=z.data)==null?void 0:l.result,d.value=(F=z.data)==null?void 0:F.count}catch(g){console.log(g)}finally{t.value=!1}};return he(()=>{i(1,"",[],[],[],void 0)}),{users:e,isLoading:t,totalCount:d,size:h,fetching:i}}const ft=K({components:{CustomButton:Z,CustomModal:oe},props:{modalTitle:{type:String,default:"Поменять роль"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e,{emit:t}){const d=s(null),u=()=>{t("editRoleFromDropDown",{role:d.value})};return w(()=>e.modalActive,()=>{d.value=null}),{selectedRole:d,onEditButtonClick:u,roleOptions:le}}});const Ct={class:"modal-content"},bt={key:0,class:"error-message"},Ut={class:"buttons_block"};function yt(e,t,d,u,h,f){const p=m("v-select"),i=m("CustomButton"),v=m("CustomModal");return S(),I(v,{onClose:j(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:B(()=>[_("div",Ct,[_("form",{onSubmit:t[1]||(t[1]=j((...a)=>e.onEditButtonClick&&e.onEditButtonClick(...a),["prevent"]))},[r(p,{items:e.roleOptions,modelValue:e.selectedRole,"onUpdate:modelValue":t[0]||(t[0]=a=>e.selectedRole=a),"item-title":"text","item-value":"value",placeholder:"Выберите роль",variant:"outlined",style:{width:"100%","margin-bottom":"24px"}},null,8,["items","modelValue"]),e.errorMessage?(S(),D("div",bt,x(e.errorMessage),1)):N("",!0),_("div",Ut,[r(i,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(i,{type:"submit"},{default:B(()=>[T(" Сохранить ")]),_:1})])],32)])]),_:1},8,["onClose","modalActive","modal-title"])}const kt=W(ft,[["render",yt],["__scopeId","data-v-93dc129b"]]),_t=K({components:{CustomButton:Z,CustomModal:oe},props:{modalTitle:{type:String,default:"Поменять бренд"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,brands:Array},setup(e,{emit:t}){const d=s(null),u=()=>{console.log("selectedBrand.value",d.value),t("editBrandFromDropDown",{brand:d.value})};return w(()=>e.modalActive,()=>{d.value=null}),{selectedBrand:d,onEditButtonClick:u}}});const At={class:"modal-content"},St={key:0,class:"error-message"},Mt={class:"buttons_block"};function $t(e,t,d,u,h,f){const p=m("v-select"),i=m("CustomButton"),v=m("CustomModal");return S(),I(v,{onClose:j(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:B(()=>{var a;return[_("div",At,[_("form",{onSubmit:t[1]||(t[1]=j((...c)=>e.onEditButtonClick&&e.onEditButtonClick(...c),["prevent"]))},[r(p,{items:(a=e.brands)==null?void 0:a.map(c=>({text:c.title.toString(),value:c.id.toString()})),modelValue:e.selectedBrand,"onUpdate:modelValue":t[0]||(t[0]=c=>e.selectedBrand=c),"item-title":"text","item-value":"value",placeholder:"Выберите бренд",variant:"outlined",color:"#1CB5C2",multiple:"",style:{width:"100%","margin-bottom":"24px"}},null,8,["items","modelValue"]),e.errorMessage?(S(),D("div",St,x(e.errorMessage),1)):N("",!0),_("div",Mt,[r(i,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(i,{type:"submit"},{default:B(()=>[T(" Сохранить ")]),_:1})])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Et=W(_t,[["render",$t],["__scopeId","data-v-6f0d9ccd"]]),wt=K({components:{CustomButton:Z,CustomModal:oe},props:{modalTitle:{type:String,default:"Поменять филиал"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,branches:Array},setup(e,{emit:t}){const d=s(null),u=()=>{t("editBranchFromDropDown",{branch:d.value})};return w(()=>e.modalActive,()=>{d.value=null}),{selectedBranch:d,onEditButtonClick:u}}});const Tt={class:"modal-content"},Dt={key:0,class:"error-message"},Ft={class:"buttons_block"};function Rt(e,t,d,u,h,f){const p=m("v-select"),i=m("CustomButton"),v=m("CustomModal");return S(),I(v,{onClose:j(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:B(()=>{var a;return[_("div",Tt,[_("form",{onSubmit:t[1]||(t[1]=j((...c)=>e.onEditButtonClick&&e.onEditButtonClick(...c),["prevent"]))},[r(p,{items:(a=e.branches)==null?void 0:a.map(c=>({text:c.title.toString(),value:c.id.toString()})),modelValue:e.selectedBranch,"onUpdate:modelValue":t[0]||(t[0]=c=>e.selectedBranch=c),"item-title":"text","item-value":"value",placeholder:"Выберите филиал",variant:"outlined",color:"#1CB5C2",style:{width:"100%","margin-bottom":"24px"}},null,8,["items","modelValue"]),e.errorMessage?(S(),D("div",Dt,x(e.errorMessage),1)):N("",!0),_("div",Ft,[r(i,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(i,{type:"submit"},{default:B(()=>[T(" Сохранить ")]),_:1})])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Vt=W(wt,[["render",Rt],["__scopeId","data-v-e1012e6c"]]),Nt=K({name:"AllUsersListPage",components:{EditUserModal:Ge,DeleteModal:je,ChangeBranchModal:Vt,ChangeBrandModal:Et,ActionsBlock:ve,ChangeRole:kt,CreatUserModal:xe,TableData:Pe,HeaderBar:gt},mounted(){const e={Authorization:V};fetch(`${R}/branches`,{headers:e}).then(t=>t.json()).then(t=>this.branches=t==null?void 0:t.result).catch(t=>console.log(t)),fetch(`${R}/brands`,{headers:e}).then(t=>t.json()).then(t=>this.brands=t==null?void 0:t.result).catch(t=>console.log(t))},setup(){const e=s([]),t=s([]),d=s([]),u=s(""),h=s([]),f=s([]),p=s([]),i=s(null),v=s([]),a=s([]),c=s(!1),k=s(!1),M=s(!1),b=s(!1),l=s(!1),F=s(!1),g=s(null),O=s(null);w(a,o=>{o.length===X.value.length&&X.value.length!=0?c.value=!0:c.value=!1});function G(){c.value?a.value=[]:a.value=X.value.map(o=>o.id)}const P=o=>{let y=X.value[o].id;a.value.includes(y)?a.value=a.value.filter(n=>n!==y):a.value=[...a.value,y]},J=(o,y)=>{$e(o,y.id)},z=o=>{h.value=o},L=o=>{f.value=o},ge=o=>{p.value=o},ne=()=>{k.value=!k.value},ae=()=>{M.value=!M.value},se=()=>{b.value=!b.value},Be=()=>{ne()},fe=()=>{ae()},Ce=()=>{se()},{users:ee,isLoading:ie,fetching:q,totalCount:be,size:Ue}=Bt(),X=Ke(()=>!ee.value||ie.value?[]:(e.value=ee.value,ee.value.map(o=>({id:o.id,fullName:`${o.first_name} ${o.last_name}`,phone:`${o.phone.slice(0,2)} ${o.phone.slice(2,5)} ${o.phone.slice(5,8)}
          ${o.phone.slice(8,10)} ${o.phone.slice(10)}`,branch:`${o.role=="owner"?"-":o.branch_title??"-"}`,brand:`${o.role=="owner"?"-":o.brands.join(", ")}`,role:o.role})))),H=()=>{q(1,u.value,h.value,f.value,p.value,i.value),a.value=[]},ye=o=>{u.value=o};w(u,o=>{q(1,o,[],[],[],i.value),a.value=[]}),w(h,o=>{q(1,u.value,o,f.value,p.value,i.value),a.value=[]}),w(f,o=>{q(1,u.value,h.value,o,p.value,i.value),a.value=[]}),w(p,o=>{q(1,u.value,h.value,f.value,o,i.value),a.value=[]});const ke=o=>{o.value=o,q(1,u.value,h.value,f.value,p.value,o.value),console.log("sortState",o)},_e=o=>{const y={method:"PUT",headers:{Authorization:V,"Content-Type":"application/json"},body:JSON.stringify({user_ids:a.value,new_role:o.role})};fetch(`${R}/change-users-role`,y).then(async n=>{var C;const U=((C=n.headers.get("content-type"))==null?void 0:C.includes("application/json"))&&await n.json();if(!n.ok){const A=U&&U.message||n.status;return Promise.reject(A)}ne(),H()}).catch(n=>{setTimeout(()=>{E.value=o.error,setTimeout(()=>{E.value=""},3e3)},200),console.error("There was an error!",n)})},Ae=()=>{v.value=[...a.value],l.value=!0},Se=o=>{v.value=[o.id],l.value=!0},ce=()=>{l.value=!1},Me=o=>{var U;const y=e.value.find(C=>C.id==o.id);g.value=y;const n=(U=t.value.find(C=>C.title==y.branch_title))==null?void 0:U.id,$=[];for(let C=0;C<y.brands.length;C++)for(let A=0;A<d.value.length;A++)if(y.brands[C]==d.value[A].title){$.push(d.value[A].id);break}O.value={role:o.role,brandIds:$,branchId:n},ue()},$e=(o,y)=>{const n={method:"PUT",headers:{Authorization:V,"Content-Type":"application/json"},body:JSON.stringify({user_ids:[y],new_role:o})};fetch(`${R}/change-users-role`,n).then(async $=>{var A;const C=((A=$.headers.get("content-type"))==null?void 0:A.includes("application/json"))&&await $.json();if(!$.ok){const Re=C&&C.message||$.status;return Promise.reject(Re)}H()}).catch($=>{E.value=$.error,console.error("There was an error!",$)})},Ee=o=>{const y={method:"PUT",headers:{Authorization:V,"Content-Type":"application/json"},body:JSON.stringify({user_ids:a.value,new_brands_ids:o.brand.map(n=>Number(n))})};fetch(`${R}/change-users-brands`,y).then(async n=>{var C;const U=((C=n.headers.get("content-type"))==null?void 0:C.includes("application/json"))&&await n.json();if(!n.ok){const A=U&&U.message||n.status;return Promise.reject(A)}ae(),H()}).catch(n=>{setTimeout(()=>{E.value=o.error,setTimeout(()=>{E.value=""},3e3)},200),console.error("There was an error!",n)})},we=o=>{const y={method:"PUT",headers:{Authorization:V,"Content-Type":"application/json"},body:JSON.stringify({user_ids:a.value,new_branch_id:Number(o.branch)})};fetch(`${R}/change-users-branch`,y).then(async n=>{var C;const U=((C=n.headers.get("content-type"))==null?void 0:C.includes("application/json"))&&await n.json();if(!n.ok){const A=U&&U.message||n.status;return Promise.reject(A)}se(),H()}).catch(n=>{setTimeout(()=>{E.value=o.error,setTimeout(()=>{E.value=""},3e3)},200),console.error("There was an error!",n)})},Te=o=>{console.log("ids",o);const y={method:"DELETE",headers:{Authorization:V,"Content-Type":"application/json"},body:JSON.stringify({user_ids:o})};fetch(`${R}/users`,y).then(async n=>{var C;const U=((C=n.headers.get("content-type"))==null?void 0:C.includes("application/json"))&&await n.json();if(!n.ok){const A=U&&U.message||n.status;return Promise.reject(A)}ce(),H()}).catch(n=>{E.value=n.error,console.error("There was an error!",n)})},re=s(!1),de=s(""),E=s(""),Y=s(""),De=o=>{const y={method:"POST",headers:{Authorization:V,"Content-Type":"application/json"},body:JSON.stringify({phone:o.telephoneNumber.replace(/\s/g,""),first_name:o.firstName,last_name:o.lastName,role:o.role,brand_ids:o.brand_ids.map(n=>Number(n)),branch_id:Number(o.branch_id)})};fetch(`${R}/user`,y).then(async n=>{var C;const U=((C=n.headers.get("content-type"))==null?void 0:C.includes("application/json"))&&await n.json();if(!n.ok){const A=U&&U.error||n;return setTimeout(()=>{E.value=U.error,setTimeout(()=>{E.value=""},3e3)},200),Promise.reject(A)}de.value=U,pe(),H(),setTimeout(()=>{Y.value="Новый пользователь успешно создан",setTimeout(()=>{Y.value=""},2e3)},200)}).catch(n=>{E.value=n.error,console.error("There was an error!",n)})},Fe=o=>{const y={method:"PUT",headers:{Authorization:V,"Content-Type":"application/json"},body:JSON.stringify({user_id:o.id,phone:o.telephoneNumber.replace(/\s/g,""),first_name:o.firstName,last_name:o.lastName,role:o.role,brand_ids:o.brand_ids.map(n=>Number(n)),branch_id:Number(o.branch_id)})};fetch(`${R}/update-user`,y).then(async n=>{var C;const U=((C=n.headers.get("content-type"))==null?void 0:C.includes("application/json"))&&await n.json();if(!n.ok){const A=U&&U.message||n.status;return console.log("HERE IT IS",A),setTimeout(()=>{E.value=U.error,setTimeout(()=>{E.value=""},3e3)},200),Promise.reject(A)}de.value=U,ue(),H(),setTimeout(()=>{Y.value="Пользователь успешно отредактирован!",setTimeout(()=>{Y.value=""},2e3)},200)}).catch(n=>{E.value=n.error,console.error("There was an error!",n)})},pe=()=>{re.value=!re.value},ue=()=>{F.value=!F.value,F.value==!1&&(O.value=null)};return{usersTableData:X,isLoading:ie,users:ee,totalCount:be,size:Ue,fetching:q,handleSearch:ye,searchValue:u,selectedRoles:h,selectedBrands:f,selectedBranches:p,selectedUsers:a,toggleAll:G,allSelected:c,toggleSelection:P,updateSelectedRoles:z,updateSelectedBrands:L,updateSelectedBranches:ge,editRoleModalToggler:ne,editBrandModalToggler:ae,editBranchModalToggler:se,editRoleClicked:Be,editBrandClicked:fe,editBranchClicked:Ce,editRoleAction:_e,editBrandAction:Ee,editBranchAction:we,deleteAction:Te,editRoleModalActive:k,editBrandModalActive:M,editBranchModalActive:b,deleteModalActive:l,deleteUserClicked:Ae,editModalActive:F,editToggleModal:ue,onEditUser:Fe,branches:t,brands:d,handleSortSelected:ke,roleOptions:le,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"fullName",label:"ФИО",width:"216px",withSort:!0},{key:"phone",label:"Номер телефона",width:"168px",withSort:!1},{key:"branch",label:"Филиал",width:"188px",withSort:!0},{key:"brand",label:"Бренд",width:"140px",withSort:!1},{key:"role",label:"Роль",width:"198px",withSort:!1}],onRoleSelected:J,onUserDelete:Se,onUserEdit:Me,deleteItems:v,closeDeleteModal:ce,onCreateUser:De,modalActive:re,createdUserId:de,errorMessage:E,showAlert:Y,createUserModalToggler:pe,selectedEditUser:g,selectedEditUserDefaultOption:O}},watch:{}});const Ot={class:"content-body"},It={key:1};function jt(e,t,d,u,h,f){const p=m("HeaderBar"),i=m("TableData"),v=m("CreatUserModal"),a=m("EditUserModal"),c=m("ChangeRole"),k=m("ChangeBrandModal"),M=m("ChangeBranchModal"),b=m("DeleteModal"),l=m("a-alert");return S(),D(We,null,[_("div",Ot,[r(p,{onModalToggler:e.createUserModalToggler,handleSearch:e.handleSearch,isCreate:!0,brands:e.brands,branches:e.branches,allSelected:e.allSelected,selectedUsers:e.selectedUsers,onUpdateRolesFilter:e.updateSelectedRoles,onUpdateBrandsFilter:e.updateSelectedBrands,onUpdateBranchesFilter:e.updateSelectedBranches,onEditRoleClicked:e.editRoleClicked,onEditBrandClicked:e.editBrandClicked,onEditBranchClicked:e.editBranchClicked,onDeleteUserClicked:e.deleteUserClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","brands","branches","allSelected","selectedUsers","onUpdateRolesFilter","onUpdateBrandsFilter","onUpdateBranchesFilter","onEditRoleClicked","onEditBrandClicked","onEditBranchClicked","onDeleteUserClicked","onToggleAll"]),e.isLoading?(S(),D("span",It,"Загрузка ...")):(S(),I(i,{key:0,tableData:e.usersTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,onUpdateRolesFilter:e.updateSelectedRoles,onUpdateBrandsFilter:e.updateSelectedBrands,onUpdateBranchesFilter:e.updateSelectedBranches,onToggleSelection:e.toggleSelection,filterRoles:e.selectedRoles,filterBrands:e.selectedBrands,filterBranches:e.selectedBranches,selectedUsers:e.selectedUsers,onOnRoleSelected:e.onRoleSelected,onOnUserDelete:e.onUserDelete,onOnUserEdit:e.onUserEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","onUpdateRolesFilter","onUpdateBrandsFilter","onUpdateBranchesFilter","onToggleSelection","filterRoles","filterBrands","filterBranches","selectedUsers","onOnRoleSelected","onOnUserDelete","onOnUserEdit"]))]),r(v,{modalActive:e.modalActive,toggleModal:e.createUserModalToggler,onCreateUser:e.onCreateUser,brands:e.brands,branches:e.branches,errorMessage:e.errorMessage},null,8,["modalActive","toggleModal","onCreateUser","brands","branches","errorMessage"]),r(a,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditUser:e.onEditUser,brands:e.brands,branches:e.branches,errorMessage:e.errorMessage,user:e.selectedEditUser,defaultOption:e.selectedEditUserDefaultOption},null,8,["editModalActive","editToggleModal","onEditUser","brands","branches","errorMessage","user","defaultOption"]),r(c,{modalActive:e.editRoleModalActive,toggleModal:e.editRoleModalToggler,onEditRoleFromDropDown:e.editRoleAction},null,8,["modalActive","toggleModal","onEditRoleFromDropDown"]),r(k,{modalActive:e.editBrandModalActive,toggleModal:e.editBrandModalToggler,brands:e.brands,onEditBrandFromDropDown:e.editBrandAction},null,8,["modalActive","toggleModal","brands","onEditBrandFromDropDown"]),r(M,{modalActive:e.editBranchModalActive,toggleModal:e.editBranchModalToggler,branches:e.branches,onEditBranchFromDropDown:e.editBranchAction},null,8,["modalActive","toggleModal","branches","onEditBranchFromDropDown"]),r(b,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"]),e.showAlert.length>0?(S(),I(l,{key:0,message:e.showAlert,type:"success","show-icon":"",class:"success-alert"},null,8,["message"])):N("",!0)],64)}const qt=W(Nt,[["render",jt],["__scopeId","data-v-fd25d933"]]);export{qt as default};
