import{C as L,l as ae,_ as ne,B as P,a as se,T as U,b as W,U as de,D as re,c as ie}from"./maska-3918070e.js";import{d as F,r as d,w,_ as O,a as u,o as y,c as V,b as h,e as g,f as B,m as ue,g as D,t as ce,h as I,i as N,j as J,v as q,p as pe,k as ge,l as Q,n as ve,q as z,s as me,F as Be}from"./index-c16cad30.js";const he=F({name:"BrandsActionsBlock",props:{allSelected:Boolean,selectedBrands:Array},setup(e,{emit:t}){const o=d(e.allSelected);return w(()=>e.allSelected,v=>{o.value=v}),{allSelected:o,toggleAll:()=>{t("toggleAll")},handleDeleteBrand:()=>{t("deleteBrandClicked")},roleOptions:[]}}});const _e={class:"outer_actions_block"},fe={class:"actions_first_block"},Ce=h("span",{class:"deleteText"},"Удалить",-1);function ye(e,t,o,i,c,v){const p=u("v-checkbox"),a=u("v-icon"),n=u("v-btn"),m=u("v-list-item-content"),r=u("v-list-item"),_=u("v-list"),$=u("v-menu");return y(),V("div",_e,[h("div",fe,[g(p,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=A=>e.allSelected=A),onChange:e.toggleAll},null,8,["modelValue","onChange"]),g($,null,{activator:B(({props:A})=>{var M,b;return[g(n,ue({color:"primary"},A,{variant:(((M=e.selectedBrands)==null?void 0:M.length)??0)>0?"tonal":"text",disabled:(((b=e.selectedBrands)==null?void 0:b.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:B(()=>{var T,k,j;return[D(ce((((T=e.selectedBrands)==null?void 0:T.length)??0)>0?"Выбрано "+(((k=e.selectedBrands)==null?void 0:k.length)??0)+"  ":"Выбрать все")+" ",1),(((j=e.selectedBrands)==null?void 0:j.length)??0)>0?(y(),I(a,{key:0},{default:B(()=>[D("mdi-chevron-down")]),_:1})):N("",!0)]}),_:2},1040,["variant","disabled"])]}),default:B(()=>[g(_,null,{default:B(()=>[g(r,{onClick:e.handleDeleteBrand},{default:B(()=>[g(m,null,{default:B(()=>[Ce]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const Ae=O(he,[["render",ye]]),Me=F({name:"BrandsHeaderBar",components:{BrandsActionsBlock:Ae,CustomButton:L},props:{handleSearch:{type:Function,required:!0},brands:Array,allSelected:Boolean,selectedBrands:Array},data(){},setup(e,{emit:t}){const o=d(""),i=d(e.allSelected),c=ae.debounce(n=>{e.handleSearch(n)},700),v=n=>{o.value=n,c(n)};return w(()=>e.allSelected,n=>{i.value=n}),{inputValue:o,allSelected:i,handleInput:v,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteBrandClicked")}}}});const be=e=>(pe("data-v-1a68c492"),e=e(),ge(),e),Te={class:"header_container"},Se={class:"header-body"},De={class:"input-wrapper"},$e=be(()=>h("img",{src:ne,class:"search-icon",alt:"Search"},null,-1));function ke(e,t,o,i,c,v){const p=u("CustomButton"),a=u("BrandsActionsBlock");return y(),V("div",Te,[h("div",Se,[h("div",De,[$e,J(h("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=n=>e.inputValue=n),onInput:t[1]||(t[1]=n=>e.handleInput(e.inputValue))},null,544),[[q,e.inputValue]])]),g(p,{onClick:t[2]||(t[2]=n=>e.$emit("modalToggler"))},{default:B(()=>[D("Создать")]),_:1})]),g(a,{allSelected:e.allSelected,onDeleteBrandClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedBrands:e.selectedBrands},null,8,["allSelected","onDeleteBrandClicked","onToggleAll","selectedBrands"])])}const Ee=O(Me,[["render",ke],["__scopeId","data-v-1a68c492"]]);function we(){const e=d([]),t=d(!0);let o=d(0);const i=57,c=d(12),v=()=>{const n=window.innerHeight;c.value=Math.floor((n-310)/i)};Q(()=>{v(),window.addEventListener("resize",v),a(1,"",void 0)}),ve(()=>{window.removeEventListener("resize",v)});const p={Authorization:U},a=async(n,m,r)=>{var _,$;try{const A=!r||r.sortState==="none"?"":`&sort_field=title&sort_type=${r.sortState}`,M=`${P}/brands?page=${n-1}&size=${c.value}${A}&search=${m}`,b=await se.get(M,{headers:p});e.value=(_=b.data)==null?void 0:_.result,o.value=($=b.data)==null?void 0:$.count}catch(A){console.log(A)}finally{t.value=!1}};return Q(()=>{a(1,"",void 0)}),{brands:e,isLoading:t,totalCount:o,size:c,fetching:a}}const Ie=F({components:{CustomButton:L,CustomModal:W},props:{modalTitle:{type:String,default:"Создать бренд"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e){const t=d(""),o=d(!1);return w(()=>e.modalActive,()=>{t.value="",o.value=!1}),{title:t,validate:()=>{t.value.length>0?o.value=!0:o.value=!1},isAllDataEntered:o}},methods:{onCreateButtonClick(){this.$emit("createBrand",{title:this.title})}}});const Ve={class:"modal-content"},Fe={class:"button-box"};function Oe(e,t,o,i,c,v){const p=u("a-alert"),a=u("CustomButton"),n=u("CustomModal");return y(),I(n,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:B(()=>{var m;return[h("div",Ve,[(y(),V("form",{onSubmit:t[2]||(t[2]=z((...r)=>e.onCreateButtonClick&&e.onCreateButtonClick(...r),["prevent"])),key:e.modalActive.toString()},[J(h("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>e.title=r),onInput:t[1]||(t[1]=(...r)=>e.validate&&e.validate(...r)),class:"inputFirstName"},null,544),[[q,e.title]]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(y(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),h("div",Fe,[g(a,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),g(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:B(()=>[D(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const je=O(Ie,[["render",Oe],["__scopeId","data-v-98f95eb4"]]),Pe=F({components:{CustomButton:L,CustomModal:W},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,curBrand:Object},setup(e){const t=d(""),o=d(!1);w(()=>e.curBrand,c=>{t.value=c.title,i()});const i=()=>{t.value.length>0?o.value=!0:o.value=!1};return{title:t,validate:i,isAllDataEntered:o}},directives:{maska:de},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){console.log("title=",this.title),this.$emit("editBrand",{title:this.title,id:e})}}});const Ue={class:"modal-content"},ze={class:"button-box"};function He(e,t,o,i,c,v){const p=u("a-alert"),a=u("CustomButton"),n=u("CustomModal");return y(),I(n,{onClose:z(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:B(()=>{var m;return[h("div",Ue,[h("form",{onSubmit:t[2]||(t[2]=z(r=>{var _;return e.onSaveButtonClick(((_=e.curBrand)==null?void 0:_.id)??0)},["prevent"]))},[J(h("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>e.title=r),onInput:t[1]||(t[1]=(...r)=>e.validate&&e.validate(...r)),class:"inputFirstName"},null,544),[[q,e.title]]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(y(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),h("div",ze,[g(a,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),g(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:B(()=>[D(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Le=O(Pe,[["render",He],["__scopeId","data-v-870f87c2"]]),Ne=F({name:"BrandsListPage",components:{EditBrandModal:Le,DeleteModal:re,CreateBrandModal:je,TableData:ie,BrandsHeaderBar:Ee},setup(){const e=d(!1),t=d(!1),o=d(""),i=d(""),c=d(""),v=d(null),p=d(!1),a=d([]),n=d([]),{brands:m,isLoading:r,fetching:_,totalCount:$,size:A}=we(),M=d(!1),b=d(null),T=me(()=>!m.value||r.value?[]:m.value.map(l=>({id:l.id,title:l.title}))),k=()=>{_(1,c.value,v.value),a.value=[]},j=l=>{c.value=l};w(c,l=>{_(1,l,v.value),a.value=[]});const R=()=>{e.value=!e.value},X=l=>{const f={method:"POST",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({title:l.title})};console.log("CREATE BRAND",l,f),fetch(`${P}/brand`,f).then(async s=>{var S;const C=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=C&&C.error||s;return setTimeout(()=>{o.value=C.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}R(),k(),setTimeout(()=>{i.value="Новый бренд успешно создан",setTimeout(()=>{i.value=""},2e3)},200)}).catch(s=>{setTimeout(()=>{o.value=s.error,setTimeout(()=>{o.value=""},3e3)},200),console.error("There was an error!",s)})},Y=l=>{console.log("ids",l);const f={method:"DELETE",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({brand_ids:l})};console.log("requestOptions",f),fetch(`${P}/brand`,f).then(async s=>{var S;const C=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=C&&C.message||s.status;return setTimeout(()=>{o.value=C.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}K(),k()}).catch(s=>{setTimeout(()=>{o.value=s.error,setTimeout(()=>{o.value=""},3e3)},200),console.error("There was an error!",s)})},Z=()=>{n.value=[...a.value],t.value=!0,console.log("DELETE2",n)},x=l=>{console.log("onBrandDelete",l),n.value=[l.id],t.value=!0},ee=l=>{console.log("onBrandEdit",l),b.value=l,H()},K=()=>{t.value=!1};function te(){p.value?a.value=[]:a.value=T.value.map(l=>l.id)}const oe=l=>{l.value=l,_(1,c.value,l.value)},le=l=>{let f=T.value[l].id;a.value.includes(f)?a.value=a.value.filter(s=>s!==f):a.value=[...a.value,f]};w(a,l=>{l.length===T.value.length&&T.value.length!=0?p.value=!0:p.value=!1});const H=()=>{M.value=!M.value};return{brandsTableData:T,isLoading:r,fetching:_,totalCount:$,size:A,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"684px",withSort:!0}],createBrandModalToggler:R,modalActive:e,searchValue:c,onCreateBrand:X,brands:m,errorMessage:o,handleSearch:j,allSelected:p,selectedBrandIds:a,deleteBrandClicked:Z,deleteModalActive:t,onBrandDelete:x,closeDeleteModal:K,toggleAll:te,handleSortSelected:oe,toggleSelection:le,onBrandEdit:ee,deleteItems:n,deleteAction:Y,showAlert:i,editModalActive:M,editToggleModal:H,onEditBrand:l=>{const f={method:"PUT",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({brand_id:l.id,title:l.title})};fetch(`${P}/brand`,f).then(async s=>{var S;const C=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=C&&C.message||s.status;return console.log("HERE IT IS",E),setTimeout(()=>{o.value=C.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}H(),k(),setTimeout(()=>{i.value="Бренд успешно отредактирован!",setTimeout(()=>{i.value=""},2e3)},200)}).catch(s=>{o.value=s.error,console.error("There was an error!",s)})},selectedEditBrand:b}}});const Je={class:"content-body"},qe={key:1};function Re(e,t,o,i,c,v){const p=u("BrandsHeaderBar"),a=u("TableData"),n=u("CreateBrandModal"),m=u("EditBrandModal"),r=u("DeleteModal");return y(),V(Be,null,[h("div",Je,[g(p,{onModalToggler:e.createBrandModalToggler,handleSearch:e.handleSearch,allSelected:e.allSelected,selectedBrands:e.selectedBrandIds,onDeleteBrandClicked:e.deleteBrandClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","allSelected","selectedBrands","onDeleteBrandClicked","onToggleAll"]),e.isLoading?(y(),V("span",qe,"Загрузка ...")):(y(),I(a,{key:0,tableData:e.brandsTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,selectedUsers:e.selectedBrandIds,onToggleSelection:e.toggleSelection,onOnUserDelete:e.onBrandDelete,onOnUserEdit:e.onBrandEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","selectedUsers","onToggleSelection","onOnUserDelete","onOnUserEdit"]))]),g(n,{toggleModal:e.createBrandModalToggler,modalActive:e.modalActive,onCreateBrand:e.onCreateBrand,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateBrand","errorMessage"]),g(m,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditBrand:e.onEditBrand,errorMessage:e.errorMessage,curBrand:e.selectedEditBrand},null,8,["editModalActive","editToggleModal","onEditBrand","errorMessage","curBrand"]),g(r,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"brand"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const We=O(Ne,[["render",Re],["__scopeId","data-v-d53e1e4d"]]);export{We as default};
