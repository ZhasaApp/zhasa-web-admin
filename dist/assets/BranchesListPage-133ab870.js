import{C as q,l as se,_ as re,B as V,a as de,T as F,b as X,U as ie,R as ue,D as ce,c as he}from"./maska-054ec05c.js";import{d as N,r as s,w as D,_ as P,a as v,o as A,c as U,b,e as f,f as y,m as pe,g as w,t as me,h as $,i as J,j,v as L,p as ve,k as ge,l as W,n as Be,q as z,s as fe,F as be}from"./index-72fa6c25.js";import{E as Ce}from"./EditUserModal-28d3e96b.js";const ye=N({name:"BranchesActionsBlock",props:{branches:Array,brands:Array,allSelected:Boolean,selectedBranches:Array},setup(e,{emit:t}){const u=s([]),n=s([]),i=s([]),p=s(e.allSelected);return D(u,m=>{t("updateRolesFilter",m)}),D(n,m=>{console.log("branches",e.branches),t("updateBrandsFilter",m)}),D(i,m=>{t("updateBranchesFilter",m)}),D(()=>e.allSelected,m=>{p.value=m}),{selectedRoles:u,selectedBrands:n,allSelected:p,toggleAll:()=>{t("toggleAll")},handleEditRole:()=>{t("editRoleClicked")},handleEditBranch:()=>{t("editBranchClicked")},handleEditBrand:()=>{t("editBrandClicked")},handleDeleteBranch:()=>{t("deleteBranchClicked")},roleOptions:[]}}});const Ae={class:"outer_actions_block"},Se={class:"actions_first_block"},Me=b("span",{class:"deleteText"},"Удалить",-1);function Te(e,t,u,n,i,p){const g=v("v-checkbox"),c=v("v-icon"),l=v("v-btn"),B=v("v-list-item-content"),h=v("v-list-item"),m=v("v-list"),r=v("v-menu");return A(),U("div",Ae,[b("div",Se,[f(g,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=S=>e.allSelected=S),onChange:e.toggleAll},null,8,["modelValue","onChange"]),f(r,null,{activator:y(({props:S})=>{var T,a;return[f(l,pe({color:"primary"},S,{variant:(((T=e.selectedBranches)==null?void 0:T.length)??0)>0?"tonal":"text",disabled:(((a=e.selectedBranches)==null?void 0:a.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:y(()=>{var k,I,E;return[w(me((((k=e.selectedBranches)==null?void 0:k.length)??0)>0?"Выбрано "+(((I=e.selectedBranches)==null?void 0:I.length)??0)+"  ":"Выбрать все")+" ",1),(((E=e.selectedBranches)==null?void 0:E.length)??0)>0?(A(),$(c,{key:0},{default:y(()=>[w("mdi-chevron-down")]),_:1})):J("",!0)]}),_:2},1040,["variant","disabled"])]}),default:y(()=>[f(m,null,{default:y(()=>[f(h,{onClick:e.handleDeleteBranch},{default:y(()=>[f(B,null,{default:y(()=>[Me]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const De=P(ye,[["render",Te]]),ke=N({name:"BranchesHeaderBar",components:{BranchesActionsBlock:De,CustomButton:q},props:{handleSearch:{type:Function,required:!0},branches:Array,allSelected:Boolean,selectedBranches:Array},data(){},setup(e,{emit:t}){const u=s(""),n=s(e.allSelected),i=se.debounce(l=>{e.handleSearch(l)},700),p=l=>{u.value=l,i(l)};return D(()=>e.allSelected,l=>{n.value=l}),{inputValue:u,allSelected:n,handleInput:p,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteBranchClicked")}}}});const Ee=e=>(ve("data-v-d69883c3"),e=e(),ge(),e),_e={class:"header_container"},$e={class:"header-body"},we={class:"input-wrapper"},Ie=Ee(()=>b("img",{src:re,class:"search-icon",alt:"Search"},null,-1));function Oe(e,t,u,n,i,p){const g=v("CustomButton"),c=v("BranchesActionsBlock");return A(),U("div",_e,[b("div",$e,[b("div",we,[Ie,j(b("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=l=>e.inputValue=l),onInput:t[1]||(t[1]=l=>e.handleInput(e.inputValue))},null,544),[[L,e.inputValue]])]),f(g,{onClick:t[2]||(t[2]=l=>e.$emit("modalToggler"))},{default:y(()=>[w("Создать")]),_:1})]),f(c,{branches:e.branches,allSelected:e.allSelected,onDeleteBranchClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedBranches:e.selectedBranches},null,8,["branches","allSelected","onDeleteBranchClicked","onToggleAll","selectedBranches"])])}const Ve=P(ke,[["render",Oe],["__scopeId","data-v-d69883c3"]]);function Fe(){const e=s([]),t=s(!0);let u=s(0);const n=57,i=s(12),p=()=>{const l=window.innerHeight;i.value=Math.floor((l-310)/n)};W(()=>{p(),window.addEventListener("resize",p),c(1,"",void 0)}),Be(()=>{window.removeEventListener("resize",p)});const g={Authorization:F},c=async(l,B,h)=>{var m,r;try{const S=!h||h.sortState==="none"?"":`&sort_field=title&sort_type=${h.sortState}`,T=`${V}/branches?page=${l-1}&size=${i.value}${S}&search=${B}`,a=await de.get(T,{headers:g});e.value=(m=a.data)==null?void 0:m.result,u.value=(r=a.data)==null?void 0:r.count}catch(S){console.log(S)}finally{t.value=!1}};return W(()=>{c(1,"",void 0)}),{branches:e,isLoading:t,totalCount:u,size:i,fetching:c}}const Ue=N({components:{CustomButton:q,CustomModal:X},props:{modalTitle:{type:String,default:"Создать филиал"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,brands:Array,branches:Array},setup(e){const t=s(""),u=s(""),n=s([]),i=s(!1);D(()=>e.modalActive,()=>{t.value="",u.value="",n.value=[],i.value=!1});const p=(l,B)=>B.label.toLowerCase().indexOf(l.toLowerCase())>=0,g=l=>{n.value=l,c()},c=()=>{t.value.length>0&&u.value.length>0&&n.value.length>0?i.value=!0:i.value=!1};return{title:t,description:u,selectedBrandsIds:n,filterOption:p,onBrandSelected:g,validate:c,isAllDataEntered:i}},methods:{onCreateButtonClick(){this.$emit("createBranch",{title:this.title,description:this.description,brand_ids:this.selectedBrandsIds})}}});const je={class:"modal-content"},Le={class:"button-box"};function Ne(e,t,u,n,i,p){const g=v("a-select"),c=v("a-alert"),l=v("CustomButton"),B=v("CustomModal");return A(),$(B,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:y(()=>{var h,m;return[b("div",je,[(A(),U("form",{onSubmit:t[6]||(t[6]=z((...r)=>e.onCreateButtonClick&&e.onCreateButtonClick(...r),["prevent"])),key:e.modalActive.toString()},[j(b("input",{placeholder:"Название филиала",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>e.title=r),onInput:t[1]||(t[1]=(...r)=>e.validate&&e.validate(...r)),class:"inputFirstName"},null,544),[[L,e.title]]),j(b("input",{placeholder:"Описание",type:"text","onUpdate:modelValue":t[2]||(t[2]=r=>e.description=r),onInput:t[3]||(t[3]=(...r)=>e.validate&&e.validate(...r)),class:"inputLastName"},null,544),[[L,e.description]]),f(g,{modelValue:e.selectedBrandsIds,"onUpdate:modelValue":t[4]||(t[4]=r=>e.selectedBrandsIds=r),mode:"multiple","show-search":"",placeholder:"Выберите бренд",style:{width:"100%"},class:"selector-with_multiple-select",options:(h=e.brands)==null?void 0:h.map(r=>({label:r.title.toString(),value:r.id.toString()})),"filter-option":e.filterOption,onChange:t[5]||(t[5]=r=>e.onBrandSelected(r)),showArrow:""},null,8,["modelValue","options","filter-option"]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(A(),$(c,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):J("",!0),b("div",Le,[f(l,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[w(" Закрыть ")]),_:1},8,["onClick"]),f(l,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[w(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Pe=P(Ue,[["render",Ne],["__scopeId","data-v-0d6667c6"]]),ze=N({components:{CustomButton:q,CustomModal:X},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,brands:Array,curBranch:Object,defaultOption:{type:Object,required:!0}},setup(e){const t=s(""),u=s(""),n=s([]),i=s(!1),p=ue,g=s((e==null?void 0:e.brands)??[]);D(()=>e.curBranch,h=>{g.value=(e==null?void 0:e.brands)??[],t.value=h.title,u.value=h.description,n.value=[],B()});const c=(h,m)=>m.label.toLowerCase().indexOf(h.toLowerCase())>=0,l=h=>{n.value=h,B()},B=()=>{t.value.length>0&&u.value.length>0?i.value=!0:i.value=!1};return{title:t,description:u,selectedBrandsIds:n,filterOption:c,onBrandSelected:l,validate:B,isAllDataEntered:i,roleOptions:p}},directives:{maska:ie},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){this.$emit("editBranch",{title:this.title,description:this.description,brand_ids:this.selectedBrandsIds,id:e})}}});const He={class:"modal-content"},Re={class:"button-box"};function qe(e,t,u,n,i,p){const g=v("a-select"),c=v("a-alert"),l=v("CustomButton"),B=v("CustomModal");return A(),$(B,{onClose:z(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:y(()=>{var h,m,r,S,T;return[b("div",He,[b("form",{onSubmit:t[8]||(t[8]=z(a=>{var k;return e.onSaveButtonClick(((k=e.curBranch)==null?void 0:k.id)??0)},["prevent"]))},[j(b("input",{placeholder:"Название филиала",type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>e.title=a),onInput:t[1]||(t[1]=(...a)=>e.validate&&e.validate(...a)),class:"inputFirstName"},null,544),[[L,e.title]]),j(b("input",{placeholder:"Описание",type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>e.description=a),onInput:t[3]||(t[3]=(...a)=>e.validate&&e.validate(...a)),class:"inputLastName"},null,544),[[L,e.description]]),(((m=(h=e.defaultOption)==null?void 0:h.selectedBrandsIds)==null?void 0:m.size)??0)>0?(A(),$(g,{key:0,modelValue:e.selectedBrandsIds,"onUpdate:modelValue":t[4]||(t[4]=a=>e.selectedBrandsIds=a),mode:"multiple",defaultValue:e.defaultOption.brandIds,"show-search":"",placeholder:"Выберите бренд",class:"selector-with_multiple-select",options:(r=e.brands)==null?void 0:r.map(a=>({label:a.title.toString(),value:a.id})),"filter-option":e.filterOption,onChange:t[5]||(t[5]=a=>e.onBrandSelected(a)),showArrow:""},null,8,["modelValue","defaultValue","options","filter-option"])):(A(),$(g,{key:1,modelValue:e.selectedBrandsIds,"onUpdate:modelValue":t[6]||(t[6]=a=>e.selectedBrandsIds=a),mode:"multiple","show-search":"",placeholder:"Выберите бренд",class:"selector-with_multiple-select",options:(S=e.brands)==null?void 0:S.map(a=>({label:a.title.toString(),value:a.id})),"filter-option":e.filterOption,onChange:t[7]||(t[7]=a=>e.onBrandSelected(a)),showArrow:""},null,8,["modelValue","options","filter-option"])),(((T=e.errorMessage)==null?void 0:T.length)??0)>0?(A(),$(c,{key:2,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):J("",!0),b("div",Re,[f(l,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[w(" Закрыть ")]),_:1},8,["onClick"]),f(l,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[w(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Je=P(ze,[["render",qe],["__scopeId","data-v-32097cde"]]),Ke=N({name:"BranchesListPage",components:{EditBranchModal:Je,EditUserModal:Ce,DeleteModal:ce,CreateBranchesModal:Pe,TableData:he,BranchesHeaderBar:Ve},mounted(){const e={Authorization:F};fetch(`${V}/brands`,{headers:e}).then(t=>t.json()).then(t=>this.brands=t==null?void 0:t.result).catch(t=>console.log(t))},setup(){const e=s([]),t=s(!1),u=s(!1),n=s(""),i=s(""),p=s(""),g=s(null),c=s(!1),l=s([]),B=s([]),{branches:h,isLoading:m,fetching:r,totalCount:S,size:T}=Fe(),a=s(!1),k=s(null),I=s(null),E=fe(()=>!h.value||m.value?[]:h.value.map(o=>{var C;return{id:o.id,title:o.title,description:o.description,brand:`${((C=o.brands)==null?void 0:C.join(", "))??"-"}`}})),H=()=>{r(1,p.value,g.value),l.value=[]},Y=o=>{p.value=o};D(p,o=>{r(1,o,g.value),l.value=[]});const K=()=>{t.value=!t.value},Z=o=>{const C={method:"POST",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({title:o.title,description:o.description,brand_ids:o.brand_ids.map(d=>Number(d))})};console.log("CREATE BRANCH",o,C),fetch(`${V}/branch`,C).then(async d=>{var _;const M=((_=d.headers.get("content-type"))==null?void 0:_.includes("application/json"))&&await d.json();if(!d.ok){const O=M&&M.error||d;return setTimeout(()=>{n.value=M.error,setTimeout(()=>{n.value=""},3e3)},200),Promise.reject(O)}K(),H(),setTimeout(()=>{i.value="Новый филиал успешно создан",setTimeout(()=>{i.value=""},2e3)},200)}).catch(d=>{setTimeout(()=>{n.value=d.error,setTimeout(()=>{n.value=""},3e3)},200),console.error("There was an error!",d)})},x=o=>{console.log("ids",o);const C={method:"DELETE",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({branch_ids:o})};console.log("requestOptions",C),fetch(`${V}/branch`,C).then(async d=>{var _;const M=((_=d.headers.get("content-type"))==null?void 0:_.includes("application/json"))&&await d.json();if(!d.ok){const O=M&&M.message||d.status;return setTimeout(()=>{n.value=M.error,setTimeout(()=>{n.value=""},3e3)},200),Promise.reject(O)}G(),H()}).catch(d=>{setTimeout(()=>{n.value=d.error,setTimeout(()=>{n.value=""},3e3)},200),console.error("There was an error!",d)})},ee=()=>{B.value=[...l.value],u.value=!0,console.log("DELETE2",B)},te=o=>{console.log("onBranchDelete",o),B.value=[o.id],u.value=!0},le=o=>{console.log("onBranchEdit",o),k.value=o,I.value={brandIds:[]},R()},G=()=>{u.value=!1};function oe(){c.value?l.value=[]:l.value=E.value.map(o=>o.id)}const ne=o=>{o.value=o,r(1,p.value,o.value)},ae=o=>{let C=E.value[o].id;l.value.includes(C)?l.value=l.value.filter(d=>d!==C):l.value=[...l.value,C]};D(l,o=>{o.length===E.value.length&&E.value.length!=0?c.value=!0:c.value=!1});const R=()=>{a.value=!a.value,a.value==!1&&(I.value=null)};return{branchesTableData:E,isLoading:m,fetching:r,totalCount:S,size:T,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"216px",withSort:!0},{key:"description",label:"Описание",width:"168px",withSort:!1},{key:"brand",label:"Бренд",width:"140px",withSort:!1}],createBranchModalToggler:K,modalActive:t,searchValue:p,onCreateBranch:Z,brands:e,errorMessage:n,handleSearch:Y,allSelected:c,selectedBranches:l,deleteBranchClicked:ee,deleteModalActive:u,onBranchDelete:te,closeDeleteModal:G,toggleAll:oe,handleSortSelected:ne,toggleSelection:ae,onBranchEdit:le,deleteItems:B,deleteAction:x,showAlert:i,editModalActive:a,editToggleModal:R,onEditBranch:o=>{const C={method:"PUT",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({branch_id:o.id,title:o.title,description:o.description,brand_ids:o.brand_ids.map(d=>Number(d))})};fetch(`${V}/branch`,C).then(async d=>{var _;const M=((_=d.headers.get("content-type"))==null?void 0:_.includes("application/json"))&&await d.json();if(!d.ok){const O=M&&M.message||d.status;return console.log("HERE IT IS",O),setTimeout(()=>{n.value=M.error,setTimeout(()=>{n.value=""},3e3)},200),Promise.reject(O)}R(),H(),setTimeout(()=>{i.value="Филиал успешно отредактирован!",setTimeout(()=>{i.value=""},2e3)},200)}).catch(d=>{n.value=d.error,console.error("There was an error!",d)})},selectedEditBranch:k,selectedEditBranchDefaultOption:I}}});const Ge={class:"content-body"},Qe={key:1};function We(e,t,u,n,i,p){const g=v("BranchesHeaderBar"),c=v("TableData"),l=v("CreateBranchesModal"),B=v("EditBranchModal"),h=v("DeleteModal");return A(),U(be,null,[b("div",Ge,[f(g,{onModalToggler:e.createBranchModalToggler,handleSearch:e.handleSearch,brands:e.brands,allSelected:e.allSelected,selectedBranches:e.selectedBranches,onDeleteBranchClicked:e.deleteBranchClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","brands","allSelected","selectedBranches","onDeleteBranchClicked","onToggleAll"]),e.isLoading?(A(),U("span",Qe,"Загрузка ...")):(A(),$(c,{key:0,tableData:e.branchesTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,onToggleSelection:e.toggleSelection,filterBranches:e.selectedBranches,selectedUsers:e.selectedBranches,onOnUserDelete:e.onBranchDelete,onOnUserEdit:e.onBranchEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","onToggleSelection","filterBranches","selectedUsers","onOnUserDelete","onOnUserEdit"]))]),f(l,{toggleModal:e.createBranchModalToggler,modalActive:e.modalActive,onCreateBranch:e.onCreateBranch,brands:e.brands,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateBranch","brands","errorMessage"]),f(B,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditBranch:e.onEditBranch,brands:e.brands,errorMessage:e.errorMessage,curBranch:e.selectedEditBranch,defaultOption:e.selectedEditBranchDefaultOption},null,8,["editModalActive","editToggleModal","onEditBranch","brands","errorMessage","curBranch","defaultOption"]),f(h,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"branch"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const et=P(Ke,[["render",We],["__scopeId","data-v-2db47995"]]);export{et as default};
