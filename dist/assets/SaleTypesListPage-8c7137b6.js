import{C as H,l as ae,_ as ne,B as j,a as se,T as U,b as Q,U as ie,c as de,D as ue}from"./maska-702f4c00.js";import{d as V,r as i,w,_ as F,a as r,o as C,c as P,b as T,e as v,f as y,m as re,g as D,t as ce,h as I,i as N,j as J,v as q,p as pe,k as ge,l as G,n as ve,q as z,s as me,F as ye}from"./index-58b4ec5e.js";const Te=V({name:"SaleTypesActionsBlock",props:{allSelected:Boolean,selectedSaleTypes:Array},setup(e,{emit:t}){const l=i(e.allSelected);return w(()=>e.allSelected,m=>{l.value=m}),{allSelected:l,toggleAll:()=>{t("toggleAll")},handleDeleteSaleType:()=>{t("deleteSaleTypeClicked")},roleOptions:[]}}});const Se={class:"outer_actions_block"},he={class:"actions_first_block"},_e=T("span",{class:"deleteText"},"Удалить",-1);function fe(e,t,l,d,u,m){const g=r("v-checkbox"),a=r("v-icon"),n=r("v-btn"),p=r("v-list-item-content"),c=r("v-list-item"),S=r("v-list"),k=r("v-menu");return C(),P("div",Se,[T("div",he,[v(g,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=M=>e.allSelected=M),onChange:e.toggleAll},null,8,["modelValue","onChange"]),v(k,null,{activator:y(({props:M})=>{var A,$;return[v(n,re({color:"primary"},M,{variant:(((A=e.selectedSaleTypes)==null?void 0:A.length)??0)>0?"tonal":"text",disabled:((($=e.selectedSaleTypes)==null?void 0:$.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:y(()=>{var h,E,O;return[D(ce((((h=e.selectedSaleTypes)==null?void 0:h.length)??0)>0?"Выбрано "+(((E=e.selectedSaleTypes)==null?void 0:E.length)??0)+"  ":"Выбрать все")+" ",1),(((O=e.selectedSaleTypes)==null?void 0:O.length)??0)>0?(C(),I(a,{key:0},{default:y(()=>[D("mdi-chevron-down")]),_:1})):N("",!0)]}),_:2},1040,["variant","disabled"])]}),default:y(()=>[v(S,null,{default:y(()=>[v(c,{onClick:e.handleDeleteSaleType},{default:y(()=>[v(p,null,{default:y(()=>[_e]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const Ce=F(Te,[["render",fe]]),Ae=V({name:"SaleTypesHeaderBar",components:{SaleTypesActionsBlock:Ce,CustomButton:H},props:{handleSearch:{type:Function,required:!0},allSelected:Boolean,selectedSaleTypes:Array},data(){},setup(e,{emit:t}){const l=i(""),d=i(e.allSelected),u=ae.debounce(n=>{e.handleSearch(n)},700),m=n=>{l.value=n,u(n)};return w(()=>e.allSelected,n=>{d.value=n}),{inputValue:l,allSelected:d,handleInput:m,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteSaleTypeClicked")}}}});const Me=e=>(pe("data-v-ba4c5485"),e=e(),ge(),e),be={class:"header_container"},$e={class:"header-body"},De={class:"input-wrapper"},ke=Me(()=>T("img",{src:ne,class:"search-icon",alt:"Search"},null,-1));function Ee(e,t,l,d,u,m){const g=r("CustomButton"),a=r("SaleTypesActionsBlock");return C(),P("div",be,[T("div",$e,[T("div",De,[ke,J(T("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=n=>e.inputValue=n),onInput:t[1]||(t[1]=n=>e.handleInput(e.inputValue))},null,544),[[q,e.inputValue]])]),v(g,{onClick:t[2]||(t[2]=n=>e.$emit("modalToggler"))},{default:y(()=>[D("Создать")]),_:1})]),v(a,{allSelected:e.allSelected,onDeleteSaleTypeClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedSaleTypes:e.selectedSaleTypes},null,8,["allSelected","onDeleteSaleTypeClicked","onToggleAll","selectedSaleTypes"])])}const Be=F(Ae,[["render",Ee],["__scopeId","data-v-ba4c5485"]]);function we(){const e=i([]),t=i(!0);let l=i(0);const d=57,u=i(12),m=()=>{const p=window.innerHeight;g()?u.value=20:u.value=Math.floor((p-310)/d)},g=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);G(()=>{m(),window.addEventListener("resize",m),n(1,"",void 0)}),ve(()=>{window.removeEventListener("resize",m)});const a={Authorization:U},n=async(p,c,S)=>{var k,M;try{const A=!S||S.sortState==="none"?"":`&sort_field=title&sort_type=${S.sortState}`,$=`${j}/sale-types?page=${p-1}&size=${u.value}${A}&search=${c}`,h=await se.get($,{headers:a});e.value=(k=h.data)==null?void 0:k.result,l.value=(M=h.data)==null?void 0:M.count}catch(A){console.log(A)}finally{t.value=!1}};return G(()=>{n(1,"",void 0)}),{saleTypes:e,isLoading:t,totalCount:l,size:u,fetching:n}}const Ie=V({components:{CustomButton:H,CustomModal:Q},props:{modalTitle:{type:String,default:"Создать Тип Продаж"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e){const t=i(""),l=i(!1);return w(()=>e.modalActive,()=>{t.value="",l.value=!1}),{title:t,validate:()=>{t.value.length>0?l.value=!0:l.value=!1},isAllDataEntered:l}},methods:{onCreateButtonClick(){this.$emit("createSaleType",{title:this.title})}}});const Pe={class:"modal-content"},Ve={class:"button-box"};function Fe(e,t,l,d,u,m){const g=r("a-alert"),a=r("CustomButton"),n=r("CustomModal");return C(),I(n,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:y(()=>{var p;return[T("div",Pe,[(C(),P("form",{onSubmit:t[2]||(t[2]=z((...c)=>e.onCreateButtonClick&&e.onCreateButtonClick(...c),["prevent"])),key:e.modalActive.toString()},[J(T("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=c=>e.title=c),onInput:t[1]||(t[1]=(...c)=>e.validate&&e.validate(...c)),class:"inputFirstName"},null,544),[[q,e.title]]),(((p=e.errorMessage)==null?void 0:p.length)??0)>0?(C(),I(g,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),T("div",Ve,[v(a,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),v(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[D(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Oe=F(Ie,[["render",Fe],["__scopeId","data-v-538d5dae"]]),je=V({components:{CustomButton:H,CustomModal:Q},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,curSaleType:Object},setup(e){const t=i(""),l=i(!1);w(()=>e.curSaleType,u=>{t.value=u.title,d()});const d=()=>{t.value.length>0?l.value=!0:l.value=!1};return{title:t,validate:d,isAllDataEntered:l}},directives:{maska:ie},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){console.log("title=",this.title),this.$emit("editSaleType",{title:this.title,id:e})}}});const Ue={class:"modal-content"},ze={class:"button-box"};function Le(e,t,l,d,u,m){const g=r("a-alert"),a=r("CustomButton"),n=r("CustomModal");return C(),I(n,{onClose:z(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:y(()=>{var p;return[T("div",Ue,[T("form",{onSubmit:t[2]||(t[2]=z(c=>{var S;return e.onSaveButtonClick(((S=e.curSaleType)==null?void 0:S.id)??0)},["prevent"]))},[J(T("input",{placeholder:"Название типа продажи",type:"text","onUpdate:modelValue":t[0]||(t[0]=c=>e.title=c),onInput:t[1]||(t[1]=(...c)=>e.validate&&e.validate(...c)),class:"inputFirstName"},null,544),[[q,e.title]]),(((p=e.errorMessage)==null?void 0:p.length)??0)>0?(C(),I(g,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),T("div",ze,[v(a,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),v(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[D(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const He=F(je,[["render",Le],["__scopeId","data-v-d9f8b4d6"]]),Ne=V({name:"SaleTypeListPage",components:{TableData:de,DeleteModal:ue,SaleTypesHeaderBar:Be,CreateSaleTypeModal:Oe,EditSaleTypeModal:He},setup(){const e=i(!1),t=i(!1),l=i(""),d=i(""),u=i(""),m=i(null),g=i(!1),a=i([]),n=i([]),{saleTypes:p,isLoading:c,fetching:S,totalCount:k,size:M}=we(),A=i(!1),$=i(null),h=me(()=>!p.value||c.value?[]:p.value.map(o=>({id:o.id,title:o.title}))),E=()=>{S(1,u.value,m.value),a.value=[]},O=o=>{u.value=o};w(u,o=>{S(1,o,m.value),a.value=[]});const R=()=>{e.value=!e.value},W=o=>{const _={method:"POST",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({title:o.title})};console.log("CREATE SALE TYPE",o,_),fetch(`${j}/sale-type`,_).then(async s=>{var b;const f=((b=s.headers.get("content-type"))==null?void 0:b.includes("application/json"))&&await s.json();if(!s.ok){const B=f&&f.error||s;return setTimeout(()=>{l.value=f.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}R(),E(),setTimeout(()=>{d.value="Новый Тип Продаж успешно создан",setTimeout(()=>{d.value=""},2e3)},200)}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},X=o=>{console.log("ids",o);const _={method:"DELETE",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({sale_type_ids:o})};console.log("requestOptions",_),fetch(`${j}/sale-type`,_).then(async s=>{var b;const f=((b=s.headers.get("content-type"))==null?void 0:b.includes("application/json"))&&await s.json();if(!s.ok){const B=f&&f.message||s.status;return setTimeout(()=>{l.value=f.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}K(),E()}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},Z=()=>{n.value=[...a.value],t.value=!0,console.log("DELETE2",n)},x=o=>{console.log("onDelete",o),n.value=[o.id],t.value=!0},ee=o=>{console.log("onEdit",o),$.value=o,L()},K=()=>{t.value=!1};function te(){g.value?a.value=[]:a.value=h.value.map(o=>o.id)}const le=o=>{o.value=o,S(1,u.value,o.value)},oe=o=>{let _=h.value[o].id;a.value.includes(_)?a.value=a.value.filter(s=>s!==_):a.value=[...a.value,_]};w(a,o=>{o.length===h.value.length&&h.value.length!=0?g.value=!0:g.value=!1});const L=()=>{A.value=!A.value};return{saleTypesTableData:h,isLoading:c,fetching:S,totalCount:k,size:M,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"684px",withSort:!0}],createSaleTypeModalToggler:R,modalActive:e,searchValue:u,onCreateSaleType:W,saleTypes:p,errorMessage:l,handleSearch:O,allSelected:g,selectedSaleTypeIds:a,deleteSaleTypeClicked:Z,deleteModalActive:t,onSaleTypeDelete:x,closeDeleteModal:K,toggleAll:te,handleSortSelected:le,toggleSelection:oe,onSaleTypeEdit:ee,deleteItems:n,deleteAction:X,showAlert:d,editModalActive:A,editToggleModal:L,onEditSaleType:o=>{const _={method:"PUT",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({sale_type_id:o.id,title:o.title})};fetch(`${j}/sale-type`,_).then(async s=>{var b;const f=((b=s.headers.get("content-type"))==null?void 0:b.includes("application/json"))&&await s.json();if(!s.ok){const B=f&&f.message||s.status;return console.log("HERE IT IS",B),setTimeout(()=>{l.value=f.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}L(),E(),setTimeout(()=>{d.value="Тип продаж успешно отредактирован!",setTimeout(()=>{d.value=""},2e3)},200)}).catch(s=>{l.value=s.error,console.error("There was an error!",s)})},selectedEditSaleType:$}}});const Je={class:"content-body"},qe={key:1};function Re(e,t,l,d,u,m){const g=r("SaleTypesHeaderBar"),a=r("TableData"),n=r("CreateSaleTypeModal"),p=r("EditSaleTypeModal"),c=r("DeleteModal");return C(),P(ye,null,[T("div",Je,[v(g,{onModalToggler:e.createSaleTypeModalToggler,handleSearch:e.handleSearch,allSelected:e.allSelected,selectedSaleTypes:e.selectedSaleTypeIds,onDeleteSaleTypeClicked:e.deleteSaleTypeClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","allSelected","selectedSaleTypes","onDeleteSaleTypeClicked","onToggleAll"]),e.isLoading?(C(),P("span",qe,"Загрузка ...")):(C(),I(a,{key:0,tableData:e.saleTypesTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,selectedUsers:e.selectedSaleTypeIds,onToggleSelection:e.toggleSelection,onOnUserDelete:e.onSaleTypeDelete,onOnUserEdit:e.onSaleTypeEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","selectedUsers","onToggleSelection","onOnUserDelete","onOnUserEdit"]))]),v(n,{toggleModal:e.createSaleTypeModalToggler,modalActive:e.modalActive,onCreateSaleType:e.onCreateSaleType,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateSaleType","errorMessage"]),v(p,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditSaleType:e.onEditSaleType,errorMessage:e.errorMessage,curSaleType:e.selectedEditSaleType},null,8,["editModalActive","editToggleModal","onEditSaleType","errorMessage","curSaleType"]),v(c,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"saleType"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const Qe=F(Ne,[["render",Re],["__scopeId","data-v-aacacdb0"]]);export{Qe as default};
