import{C as z,T as q}from"./constants-a62344da.js";import{C as Z,T as K,H as G,u as Q}from"./useAllUsersWithRoles-26026cc0.js";import{d as P,_ as j,r as f,a as X,o as v,c as w,w as T,b as g,e as V,f as N,v as _,g as $,t as Y,h as I,i as A,j as S,k as x,l as ee,m as te,F as se}from"./index-99c4c287.js";/*! maska v2.1.10 | (c) Alexander Shabunevich | Released under the MIT license */var ae=Object.defineProperty,oe=(s,t,e)=>t in s?ae(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,M=(s,t,e)=>(oe(s,typeof t!="symbol"?t+"":t,e),e);const B={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class O{constructor(t={}){M(this,"opts",{}),M(this,"memo",new Map);const e={...t};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...B,...e.tokens};for(const a of Object.values(e.tokens))typeof a.pattern=="string"&&(a.pattern=new RegExp(a.pattern))}else e.tokens=B;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((a,o)=>a.length-o.length):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const e=this.findMask(t);if(this.opts.mask==null||e==null)return!1;const a=this.process(t,e).length;return typeof this.opts.mask=="string"?a>=this.opts.mask.length:typeof this.opts.mask=="function"?a>=e.length:this.opts.mask.filter(o=>a>=o.length).length===this.opts.mask.length}findMask(t){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(t);const a=this.process(t,e.slice(-1).pop()??"",!1);return e.find(o=>this.process(t,o,!1).length>=a.length)??""}escapeMask(t){const e=[],a=[];return t.split("").forEach((o,l)=>{o==="!"&&t[l-1]!=="!"?a.push(l-a.length):e.push(o)}),{mask:e.join(""),escaped:a}}process(t,e,a=!0){var o;if(e==null)return t;const l=`value=${t},mask=${e},masked=${a?1:0}`;if(this.memo.has(l))return this.memo.get(l);const{mask:r,escaped:i}=this.escapeMask(e),p=[],n=this.opts.tokens!=null?this.opts.tokens:{},d=this.isReversed()?-1:1,c=this.isReversed()?"unshift":"push",C=this.isReversed()?0:r.length-1,W=this.isReversed()?()=>u>-1&&m>-1:()=>u<r.length&&m<t.length,H=k=>!this.isReversed()&&k<=C||this.isReversed()&&k>=C;let b,y=-1,u=this.isReversed()?r.length-1:0,m=this.isReversed()?t.length-1:0;for(;W();){const k=r.charAt(u),h=n[k],E=(h==null?void 0:h.transform)!=null?h.transform(t.charAt(m)):t.charAt(m);if(!i.includes(u)&&h!=null){if(E.match(h.pattern)!=null)p[c](E),h.repeated?(y===-1?y=u:u===C&&u!==y&&(u=y-d),C===y&&(u-=d)):h.multiple&&(u-=d),u+=d;else if(h.multiple){const J=((o=p[m-d])==null?void 0:o.match(h.pattern))!=null,R=r.charAt(u+d);J&&R!==""&&n[R]==null?(u+=d,m-=d):p[c]("")}else E===b?b=void 0:h.optional&&(u+=d,m-=d);m+=d}else a&&!this.isEager()&&p[c](k),E===k&&!this.isEager()?m+=d:b=k,this.isEager()||(u+=d);if(this.isEager())for(;H(u)&&(n[r.charAt(u)]==null||i.includes(u));)a?p[c](r.charAt(u)):r.charAt(u)===t.charAt(m)&&(m+=d),u+=d}return this.memo.set(l,p.join("")),this.memo.get(l)}}const L=s=>JSON.parse(s.replaceAll("'",'"')),F=(s,t={})=>{const e={...t};return s.dataset.maska!=null&&s.dataset.maska!==""&&(e.mask=ne(s.dataset.maska)),s.dataset.maskaEager!=null&&(e.eager=D(s.dataset.maskaEager)),s.dataset.maskaReversed!=null&&(e.reversed=D(s.dataset.maskaReversed)),s.dataset.maskaTokensReplace!=null&&(e.tokensReplace=D(s.dataset.maskaTokensReplace)),s.dataset.maskaTokens!=null&&(e.tokens=le(s.dataset.maskaTokens)),e},D=s=>s!==""?!!JSON.parse(s):!0,ne=s=>s.startsWith("[")&&s.endsWith("]")?L(s):s,le=s=>{if(s.startsWith("{")&&s.endsWith("}"))return L(s);const t={};return s.split("|").forEach(e=>{const a=e.split(":");t[a[0]]={pattern:new RegExp(a[1]),optional:a[2]==="optional",multiple:a[2]==="multiple",repeated:a[2]==="repeated"}}),t};class re{constructor(t,e={}){M(this,"items",new Map),M(this,"beforeinputEvent",a=>{const o=a.target,l=this.items.get(o);l.isEager()&&"inputType"in a&&a.inputType.startsWith("delete")&&l.unmasked(o.value).length<=1&&this.setMaskedValue(o,"")}),M(this,"inputEvent",a=>{if(a instanceof CustomEvent&&a.type==="input"&&a.detail!=null&&typeof a.detail=="object"&&"masked"in a.detail)return;const o=a.target,l=this.items.get(o),r=o.value,i=o.selectionStart,p=o.selectionEnd;let n=r;if(l.isEager()){const d=l.masked(r),c=l.unmasked(r);c===""&&"data"in a&&a.data!=null?n=a.data:c!==l.unmasked(d)&&(n=c)}if(this.setMaskedValue(o,n),"inputType"in a&&(a.inputType.startsWith("delete")||i!=null&&i<r.length))try{o.setSelectionRange(i,p)}catch{}}),this.options=e,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(e)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(e))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,e){const a=this.items.get(t),o=new O(F(t,this.getMaskOpts(e)));return JSON.stringify(a.opts)!==JSON.stringify(o.opts)}needUpdateValue(t){const e=t.dataset.maskaValue;return e==null&&t.value!==""||e!=null&&e!==t.value}getMaskOpts(t){const{onMaska:e,preProcess:a,postProcess:o,...l}=t;return l}init(t,e){for(const a of t){const o=new O(F(a,e));this.items.set(a,o),a.value!==""&&this.setMaskedValue(a,a.value),a.addEventListener("input",this.inputEvent),a.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,e){const a=this.items.get(t);this.options.preProcess!=null&&(e=this.options.preProcess(e));const o=a.masked(e),l=a.unmasked(a.isEager()?o:e),r=a.completed(e),i={masked:o,unmasked:l,completed:r};e=o,this.options.postProcess!=null&&(e=this.options.postProcess(e)),t.value=e,t.dataset.maskaValue=e,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(p=>p(i)):this.options.onMaska(i)),t.dispatchEvent(new CustomEvent("maska",{detail:i})),t.dispatchEvent(new CustomEvent("input",{detail:i}))}}const U=new WeakMap,ie=s=>{setTimeout(()=>{var t;((t=U.get(s))==null?void 0:t.needUpdateValue(s))===!0&&s.dispatchEvent(new CustomEvent("input"))})},ue=(s,t)=>{const e=s instanceof HTMLInputElement?s:s.querySelector("input"),a={...t.arg};if(e==null||(e==null?void 0:e.type)==="file")return;ie(e);const o=U.get(e);if(o!=null){if(!o.needUpdateOptions(e,a))return;o.destroy()}if(t.value!=null){const l=t.value,r=i=>{l.masked=i.masked,l.unmasked=i.unmasked,l.completed=i.completed};a.onMaska=a.onMaska==null?r:Array.isArray(a.onMaska)?[...a.onMaska,r]:[a.onMaska,r]}U.set(e,new re(e,a))},de=P({components:{CustomButton:z,CustomModal:Z},props:{modalTitle:{type:String,default:"Создать нового пользователя"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},directives:{maska:ue},data(){return{firstName:"",lastName:"",telephoneNumber:"",maskedValue:"",isAllDataEntered:!1,bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onCreateButtonClick(){this.$emit("createUser",{firstName:this.firstName,lastName:this.lastName,telephoneNumber:this.telephoneNumber})},checkForData(){this.firstName.length>0&&this.lastName.length>0&&this.telephoneNumber.length>0?this.isAllDataEntered=!0:this.isAllDataEntered=!1}}});const pe={class:"modal-content"},me={key:0,class:"error-message"};function he(s,t,e,a,o,l){const r=f("CustomButton"),i=f("CustomModal"),p=X("maska");return v(),w(i,{onClose:V(s.toggleModal,["prevent"]),modalActive:s.modalActive,"modal-title":s.modalTitle},{default:T(()=>[g("div",pe,[g("form",{onSubmit:t[6]||(t[6]=V((...n)=>s.onCreateButtonClick&&s.onCreateButtonClick(...n),["prevent"]))},[N(g("input",{placeholder:"Имя",type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>s.firstName=n),onInput:t[1]||(t[1]=(...n)=>s.checkForData&&s.checkForData(...n))},null,544),[[_,s.firstName]]),N(g("input",{placeholder:"Фамилия",type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>s.lastName=n),onInput:t[3]||(t[3]=(...n)=>s.checkForData&&s.checkForData(...n))},null,544),[[_,s.lastName]]),N(g("input",{placeholder:"+7 ___ ___ __ __","data-maska":"+7 ### ### ## ##","onUpdate:modelValue":t[4]||(t[4]=n=>s.telephoneNumber=n),onInput:t[5]||(t[5]=(...n)=>s.checkForData&&s.checkForData(...n))},null,544),[[p],[_,s.telephoneNumber]]),s.errorMessage?(v(),$("div",me,Y(s.errorMessage),1)):I("",!0),A(r,{type:"submit","additional-styles":{marginBottom:"24px",opacity:`${s.isAllDataEntered?"1":"0.5"}`},disabled:!s.isAllDataEntered},{default:T(()=>[S(" Создать ")]),_:1},8,["additional-styles","disabled"]),A(r,{onClick:s.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:T(()=>[S(" Закрыть ")]),_:1},8,["onClick"])],32)])]),_:1},8,["onClose","modalActive","modal-title"])}const ce=j(de,[["render",he],["__scopeId","data-v-575d43ef"]]),ke=P({name:"AllUsersListPage",components:{CreatUserModal:ce,TableData:K,HeaderBar:G},data(){return{modalActive:!1,createdUserId:"",errorMessage:"",showAlert:!1}},setup(){const s=x(""),{users:t,isLoading:e,fetching:a,totalCount:o,size:l}=Q(),r=ee(()=>!t.value||e.value?[]:t.value.map(n=>({id:n.id,fullName:`${n.first_name} ${n.last_name}`,phone:`${n.phone.slice(0,2)} ${n.phone.slice(2,5)} ${n.phone.slice(5,8)}
          ${n.phone.slice(8,10)} ${n.phone.slice(10)}`}))),i=[{key:"id",label:"ID"},{key:"fullName",label:"ФИО"},{key:"phone",label:"Номер телефона"}],p=n=>{s.value=n};return te(s,n=>{a(1,n)}),{tableColumns:i,usersTableData:r,isLoading:e,users:t,totalCount:o,size:l,fetching:a,handleSearch:p,searchValue:s}},methods:{modalToggler(){this.modalActive=!this.modalActive},onCreateUser(s){const t={method:"POST",headers:{Authorization:q,"Content-Type":"application/json"},body:JSON.stringify({phone:s.telephoneNumber.replace(/\s/g,""),first_name:s.firstName,last_name:s.lastName})};fetch("http://185.182.219.90/admin/user",t).then(async e=>{var l;const o=((l=e.headers.get("content-type"))==null?void 0:l.includes("application/json"))&&await e.json();if(!e.ok){const r=o&&o.message||e.status;return console.log("HERE IT IS",r),this.errorMessage=r.message,Promise.reject(r)}this.createdUserId=o,this.modalToggler(),setTimeout(()=>{this.showAlert=!0,setTimeout(()=>{this.showAlert=!1},2e3)},200)}).catch(e=>{console.error("There was an error!",e)})}}});const ge={class:"content-body"},fe={key:1};function ve(s,t,e,a,o,l){const r=f("HeaderBar"),i=f("TableData"),p=f("CreatUserModal"),n=f("a-alert");return v(),$(se,null,[g("div",ge,[A(r,{onModalToggler:s.modalToggler,handleSearch:s.handleSearch,isCreate:!0},null,8,["onModalToggler","handleSearch"]),s.isLoading?(v(),$("span",fe,"Загрузка ...")):(v(),w(i,{key:0,tableData:s.usersTableData,columns:s.tableColumns,onHandlePageChange:s.fetching,totalCount:s.totalCount,size:s.size,searchValue:s.searchValue},null,8,["tableData","columns","onHandlePageChange","totalCount","size","searchValue"]))]),A(p,{modalActive:s.modalActive,toggleModal:s.modalToggler,onCreateUser:s.onCreateUser,errorMessage:s.errorMessage},null,8,["modalActive","toggleModal","onCreateUser","errorMessage"]),s.showAlert?(v(),w(n,{key:0,message:"Новый пользователь успешно создан",type:"success","show-icon":"",class:"success-alert"})):I("",!0)],64)}const Ee=j(ke,[["render",ve],["__scopeId","data-v-b3ae9c5c"]]);export{Ee as default};
