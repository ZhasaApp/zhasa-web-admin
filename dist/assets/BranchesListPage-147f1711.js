import{C as J,l as se,_ as de,B as V,a as re,T as F,b as X,U as ie,R as ue,E as ce,D as he,c as pe}from"./EditUserModal-aca6fc90.js";import{d as N,r as a,w as T,_ as P,a as v,o as S,c as U,b,e as f,f as C,m as ge,g as $,t as ve,h as k,i as z,j as L,v as j,p as me,k as Be,l as W,n as fe,q as H,s as be,F as Ce}from"./index-e726122b.js";const ye=N({name:"BranchesActionsBlock",props:{branches:Array,brands:Array,allSelected:Boolean,selectedBranches:Array},setup(e,{emit:t}){const i=a([]),n=a([]),r=a([]),h=a(e.allSelected);return T(i,p=>{t("updateRolesFilter",p)}),T(n,p=>{console.log("branches",e.branches),t("updateBrandsFilter",p)}),T(r,p=>{t("updateBranchesFilter",p)}),T(()=>e.allSelected,p=>{h.value=p}),{selectedRoles:i,selectedBrands:n,allSelected:h,toggleAll:()=>{t("toggleAll")},handleEditRole:()=>{t("editRoleClicked")},handleEditBranch:()=>{t("editBranchClicked")},handleEditBrand:()=>{t("editBrandClicked")},handleDeleteBranch:()=>{t("deleteBranchClicked")},roleOptions:[]}}});const Ae={class:"outer_actions_block"},Se={class:"actions_first_block"},_e=b("span",{class:"deleteText"},"Удалить",-1);function Me(e,t,i,n,r,h){const B=v("v-checkbox"),u=v("v-icon"),l=v("v-btn"),m=v("v-list-item-content"),c=v("v-list-item"),p=v("v-list"),s=v("v-menu");return S(),U("div",Ae,[b("div",Se,[f(B,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=A=>e.allSelected=A),onChange:e.toggleAll},null,8,["modelValue","onChange"]),f(s,null,{activator:C(({props:A})=>{var g,y;return[f(l,ge({color:"primary"},A,{variant:(((g=e.selectedBranches)==null?void 0:g.length)??0)>0?"tonal":"text",disabled:(((y=e.selectedBranches)==null?void 0:y.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:C(()=>{var O,w,D;return[$(ve((((O=e.selectedBranches)==null?void 0:O.length)??0)>0?"Выбрано "+(((w=e.selectedBranches)==null?void 0:w.length)??0)+"  ":"Выбрать все")+" ",1),(((D=e.selectedBranches)==null?void 0:D.length)??0)>0?(S(),k(u,{key:0},{default:C(()=>[$("mdi-chevron-down")]),_:1})):z("",!0)]}),_:2},1040,["variant","disabled"])]}),default:C(()=>[f(p,null,{default:C(()=>[f(c,{onClick:e.handleDeleteBranch},{default:C(()=>[f(m,null,{default:C(()=>[_e]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const Te=P(ye,[["render",Me]]),De=N({name:"BranchesHeaderBar",components:{BranchesActionsBlock:Te,CustomButton:J},props:{handleSearch:{type:Function,required:!0},branches:Array,allSelected:Boolean,selectedBranches:Array},data(){},setup(e,{emit:t}){const i=a(""),n=a(e.allSelected),r=se.debounce(l=>{e.handleSearch(l)},700),h=l=>{i.value=l,r(l)};return T(()=>e.allSelected,l=>{n.value=l}),{inputValue:i,allSelected:n,handleInput:h,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteBranchClicked")}}}});const Ee=e=>(me("data-v-e5d1bda7"),e=e(),Be(),e),ke={class:"header_container"},$e={class:"header-body"},we={class:"input-wrapper"},Ie=Ee(()=>b("img",{src:de,class:"search-icon",alt:"Search"},null,-1));function Oe(e,t,i,n,r,h){const B=v("CustomButton"),u=v("BranchesActionsBlock");return S(),U("div",ke,[b("div",$e,[b("div",we,[Ie,L(b("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=l=>e.inputValue=l),onInput:t[1]||(t[1]=l=>e.handleInput(e.inputValue))},null,544),[[j,e.inputValue]])]),f(B,{onClick:t[2]||(t[2]=l=>e.$emit("modalToggler"))},{default:C(()=>[$("Создать")]),_:1})]),f(u,{branches:e.branches,allSelected:e.allSelected,onDeleteBranchClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedBranches:e.selectedBranches},null,8,["branches","allSelected","onDeleteBranchClicked","onToggleAll","selectedBranches"])])}const Ve=P(De,[["render",Oe],["__scopeId","data-v-e5d1bda7"]]);function Fe(){const e=a([]),t=a(!0);let i=a(0);const n=57,r=a(12),h=()=>{const l=window.innerHeight;r.value=Math.floor((l-310)/n)};W(()=>{h(),window.addEventListener("resize",h),u(1,"",void 0)}),fe(()=>{window.removeEventListener("resize",h)});const B={Authorization:F},u=async(l,m,c)=>{var p,s;try{const A=!c||c.sortState==="none"?"":`&sort_field=title&sort_type=${c.sortState}`,g=`${V}/branches?page=${l-1}&size=${r.value}${A}&search=${m}`,y=await re.get(g,{headers:B});e.value=(p=y.data)==null?void 0:p.result,i.value=(s=y.data)==null?void 0:s.count}catch(A){console.log(A)}finally{t.value=!1}};return W(()=>{u(1,"",void 0)}),{branches:e,isLoading:t,totalCount:i,size:r,fetching:u}}const Ue=N({components:{CustomButton:J,CustomModal:X},props:{modalTitle:{type:String,default:"Создать филиал"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,brands:Array,branches:Array},setup(e){const t=a(""),i=a(""),n=a([]),r=a(!1);T(()=>e.modalActive,()=>{t.value="",i.value="",n.value=[],r.value=!1});const h=(l,m)=>m.label.toLowerCase().indexOf(l.toLowerCase())>=0,B=l=>{n.value=l,u()},u=()=>{t.value.length>0&&i.value.length>0&&n.value.length>0?r.value=!0:r.value=!1};return{title:t,description:i,selectedBrandsIds:n,filterOption:h,onBrandSelected:B,validate:u,isAllDataEntered:r}},methods:{onCreateButtonClick(){this.$emit("createBranch",{title:this.title,description:this.description,brand_ids:this.selectedBrandsIds})}}});const Le={class:"modal-content"},je={class:"button-box"};function Ne(e,t,i,n,r,h){const B=v("a-select"),u=v("a-alert"),l=v("CustomButton"),m=v("CustomModal");return S(),k(m,{onClose:H(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:C(()=>{var c,p;return[b("div",Le,[(S(),U("form",{onSubmit:t[6]||(t[6]=H((...s)=>e.onCreateButtonClick&&e.onCreateButtonClick(...s),["prevent"])),key:e.modalActive.toString()},[L(b("input",{placeholder:"Название филиала",type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>e.title=s),onInput:t[1]||(t[1]=(...s)=>e.validate&&e.validate(...s)),class:"inputFirstName"},null,544),[[j,e.title]]),L(b("input",{placeholder:"Описание",type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>e.description=s),onInput:t[3]||(t[3]=(...s)=>e.validate&&e.validate(...s)),class:"inputLastName"},null,544),[[j,e.description]]),f(B,{modelValue:e.selectedBrandsIds,"onUpdate:modelValue":t[4]||(t[4]=s=>e.selectedBrandsIds=s),mode:"multiple","show-search":"",placeholder:"Выберите бренд",style:{width:"100%"},class:"selector-with_multiple-select",options:(c=e.brands)==null?void 0:c.map(s=>({label:s.title.toString(),value:s.id.toString()})),"filter-option":e.filterOption,onChange:t[5]||(t[5]=s=>e.onBrandSelected(s)),showArrow:""},null,8,["modelValue","options","filter-option"]),(((p=e.errorMessage)==null?void 0:p.length)??0)>0?(S(),k(u,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):z("",!0),b("div",je,[f(l,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:C(()=>[$(" Закрыть ")]),_:1},8,["onClick"]),f(l,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:C(()=>[$(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Pe=P(Ue,[["render",Ne],["__scopeId","data-v-e38dd7bc"]]),ze=N({components:{CustomButton:J,CustomModal:X},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,brands:Array,curBranch:Object,defaultOption:{type:Object,required:!0}},setup(e){const t=a(""),i=a(""),n=a([]),r=a(!1),h=ue,B=a((e==null?void 0:e.brands)??[]);T(()=>e.curBranch,c=>{B.value=(e==null?void 0:e.brands)??[],t.value=c.title,i.value=c.description,n.value=[],m()});const u=(c,p)=>p.label.toLowerCase().indexOf(c.toLowerCase())>=0,l=c=>{n.value=c,m()},m=()=>{console.log("selectedBrandsIds",n.value),t.value.length>0&&i.value.length>0?r.value=!0:r.value=!1};return{title:t,description:i,selectedBrandsIds:n,filterOption:u,onBrandSelected:l,validate:m,isAllDataEntered:r,roleOptions:h}},directives:{maska:ie},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){console.log("title=",this.title),console.log("description=",this.description),console.log("brand_ids=",this.selectedBrandsIds),this.$emit("editBranch",{title:this.title,description:this.description,brand_ids:this.selectedBrandsIds,id:e})}}});const He={class:"modal-content"},Re={class:"button-box"};function qe(e,t,i,n,r,h){const B=v("a-select"),u=v("a-alert"),l=v("CustomButton"),m=v("CustomModal");return S(),k(m,{onClose:H(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:C(()=>{var c,p,s,A;return[b("div",He,[b("form",{onSubmit:t[6]||(t[6]=H(g=>{var y;return e.onSaveButtonClick(((y=e.curBranch)==null?void 0:y.id)??0)},["prevent"]))},[L(b("input",{placeholder:"Название филиала",type:"text","onUpdate:modelValue":t[0]||(t[0]=g=>e.title=g),onInput:t[1]||(t[1]=(...g)=>e.validate&&e.validate(...g)),class:"inputFirstName"},null,544),[[j,e.title]]),L(b("input",{placeholder:"Описание",type:"text","onUpdate:modelValue":t[2]||(t[2]=g=>e.description=g),onInput:t[3]||(t[3]=(...g)=>e.validate&&e.validate(...g)),class:"inputLastName"},null,544),[[j,e.description]]),(((p=(c=e.defaultOption)==null?void 0:c.selectedBrandsIds)==null?void 0:p.size)??0)>0?(S(),k(B,{key:0,modelValue:e.selectedBrandsIds,"onUpdate:modelValue":t[4]||(t[4]=g=>e.selectedBrandsIds=g),mode:"multiple",defaultValue:e.defaultOption.brandIds,"show-search":"",placeholder:"Выберите бренд",class:"selector-with_multiple-select",options:(s=e.brands)==null?void 0:s.map(g=>({label:g.title.toString(),value:g.id})),"filter-option":e.filterOption,onChange:t[5]||(t[5]=g=>e.onBrandSelected(g)),showArrow:""},null,8,["modelValue","defaultValue","options","filter-option"])):z("",!0),(((A=e.errorMessage)==null?void 0:A.length)??0)>0?(S(),k(u,{key:1,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):z("",!0),b("div",Re,[f(l,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:C(()=>[$(" Закрыть ")]),_:1},8,["onClick"]),f(l,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:C(()=>[$(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Je=P(ze,[["render",qe],["__scopeId","data-v-309ccfe1"]]),Ke=N({name:"BranchesListPage",components:{EditBranchModal:Je,EditUserModal:ce,DeleteModal:he,CreateBranchesModal:Pe,TableData:pe,BranchesHeaderBar:Ve},mounted(){const e={Authorization:F};fetch(`${V}/brands`,{headers:e}).then(t=>t.json()).then(t=>this.brands=t==null?void 0:t.result).catch(t=>console.log(t))},setup(){const e=a([]),t=a(!1),i=a(!1),n=a(""),r=a(""),h=a(""),B=a(null),u=a(!1),l=a([]),m=a([]),{branches:c,isLoading:p,fetching:s,totalCount:A,size:g}=Fe(),y=a(!1),O=a(null),w=a(null),D=be(()=>!c.value||p.value?[]:c.value.map(o=>({id:o.id,title:o.title,description:o.description}))),R=()=>{s(1,h.value,B.value),l.value=[]},Y=o=>{h.value=o};T(h,o=>{s(1,o,B.value),l.value=[]});const K=()=>{t.value=!t.value},Z=o=>{const _={method:"POST",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({title:o.title,description:o.description,brand_ids:o.brand_ids.map(d=>Number(d))})};console.log("CREATE BRANCH",o,_),fetch(`${V}/branch`,_).then(async d=>{var E;const M=((E=d.headers.get("content-type"))==null?void 0:E.includes("application/json"))&&await d.json();if(!d.ok){const I=M&&M.error||d;return setTimeout(()=>{n.value=M.error,setTimeout(()=>{n.value=""},3e3)},200),Promise.reject(I)}K(),R(),setTimeout(()=>{r.value="Новый филиал успешно создан",setTimeout(()=>{r.value=""},2e3)},200)}).catch(d=>{setTimeout(()=>{n.value=d.error,setTimeout(()=>{n.value=""},3e3)},200),console.error("There was an error!",d)})},x=o=>{console.log("ids",o);const _={method:"DELETE",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({branch_ids:o})};console.log("requestOptions",_),fetch(`${V}/branch`,_).then(async d=>{var E;const M=((E=d.headers.get("content-type"))==null?void 0:E.includes("application/json"))&&await d.json();if(!d.ok){const I=M&&M.message||d.status;return setTimeout(()=>{n.value=M.error,setTimeout(()=>{n.value=""},3e3)},200),Promise.reject(I)}G(),R()}).catch(d=>{setTimeout(()=>{n.value=d.error,setTimeout(()=>{n.value=""},3e3)},200),console.error("There was an error!",d)})},ee=()=>{m.value=[...l.value],i.value=!0,console.log("DELETE2",m)},te=o=>{console.log("onBranchDelete",o),m.value=[o.id],i.value=!0},le=o=>{console.log("onBranchEdit",o),O.value=o,w.value={brandIds:[]},q()},G=()=>{i.value=!1};function oe(){u.value?l.value=[]:l.value=D.value.map(o=>o.id)}const ne=o=>{o.value=o,s(1,h.value,o.value)},ae=o=>{let _=D.value[o].id;l.value.includes(_)?l.value=l.value.filter(d=>d!==_):l.value=[...l.value,_]};T(l,o=>{o.length===D.value.length&&D.value.length!=0?u.value=!0:u.value=!1});const q=()=>{y.value=!y.value,y.value==!1&&(w.value=null)};return{branchesTableData:D,isLoading:p,fetching:s,totalCount:A,size:g,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"216px",withSort:!0},{key:"description",label:"Описание",width:"168px",withSort:!1}],createBranchModalToggler:K,modalActive:t,searchValue:h,onCreateBranch:Z,brands:e,errorMessage:n,handleSearch:Y,allSelected:u,selectedBranches:l,deleteBranchClicked:ee,deleteModalActive:i,onBranchDelete:te,closeDeleteModal:G,toggleAll:oe,handleSortSelected:ne,toggleSelection:ae,onBranchEdit:le,deleteItems:m,deleteAction:x,showAlert:r,editModalActive:y,editToggleModal:q,onEditBranch:o=>{const _={method:"PUT",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({branch_id:o.id,title:o.title,description:o.description,brand_ids:o.brand_ids.map(d=>Number(d))})};fetch(`${V}/branch`,_).then(async d=>{var E;const M=((E=d.headers.get("content-type"))==null?void 0:E.includes("application/json"))&&await d.json();if(!d.ok){const I=M&&M.message||d.status;return console.log("HERE IT IS",I),setTimeout(()=>{n.value=M.error,setTimeout(()=>{n.value=""},3e3)},200),Promise.reject(I)}q(),R(),setTimeout(()=>{r.value="Филиал успешно отредактирован!",setTimeout(()=>{r.value=""},2e3)},200)}).catch(d=>{n.value=d.error,console.error("There was an error!",d)})},selectedEditBranch:O,selectedEditBranchDefaultOption:w}}});const Ge={class:"content-body"},Qe={key:1};function We(e,t,i,n,r,h){const B=v("BranchesHeaderBar"),u=v("TableData"),l=v("CreateBranchesModal"),m=v("EditBranchModal"),c=v("DeleteModal");return S(),U(Ce,null,[b("div",Ge,[f(B,{onModalToggler:e.createBranchModalToggler,handleSearch:e.handleSearch,brands:e.brands,allSelected:e.allSelected,selectedBranches:e.selectedBranches,onDeleteBranchClicked:e.deleteBranchClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","brands","allSelected","selectedBranches","onDeleteBranchClicked","onToggleAll"]),e.isLoading?(S(),U("span",Qe,"Загрузка ...")):(S(),k(u,{key:0,tableData:e.branchesTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,onToggleSelection:e.toggleSelection,filterBranches:e.selectedBranches,selectedUsers:e.selectedBranches,onOnUserDelete:e.onBranchDelete,onOnUserEdit:e.onBranchEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","onToggleSelection","filterBranches","selectedUsers","onOnUserDelete","onOnUserEdit"]))]),f(l,{toggleModal:e.createBranchModalToggler,modalActive:e.modalActive,onCreateBranch:e.onCreateBranch,brands:e.brands,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateBranch","brands","errorMessage"]),f(m,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditBranch:e.onEditBranch,brands:e.brands,errorMessage:e.errorMessage,curBranch:e.selectedEditBranch,defaultOption:e.selectedEditBranchDefaultOption},null,8,["editModalActive","editToggleModal","onEditBranch","brands","errorMessage","curBranch","defaultOption"]),f(c,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"branch"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const xe=P(Ke,[["render",We],["__scopeId","data-v-dd6cad49"]]);export{xe as default};
