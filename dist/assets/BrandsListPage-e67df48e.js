import{C as L,l as ne,_ as ae,B as V,a as se,T as j,b as W,U as de,E as re,D as ie,c as ue}from"./EditUserModal-b134a86a.js";import{d as O,r as d,w,_ as P,a as u,o as y,c as F,b as B,e as g,f as h,m as ce,g as $,t as pe,h as I,i as N,j as J,v as q,p as ge,k as ve,l as Q,n as me,q as z,s as he,F as Be}from"./index-2084bc34.js";const fe=O({name:"BrandsActionsBlock",props:{allSelected:Boolean,selectedBrands:Array},setup(e,{emit:t}){const o=d(e.allSelected);return w(()=>e.allSelected,v=>{o.value=v}),{allSelected:o,toggleAll:()=>{t("toggleAll")},handleDeleteBrand:()=>{t("deleteBrandClicked")},roleOptions:[]}}});const _e={class:"outer_actions_block"},Ce={class:"actions_first_block"},ye=B("span",{class:"deleteText"},"Удалить",-1);function Ae(e,t,o,i,c,v){const p=u("v-checkbox"),n=u("v-icon"),a=u("v-btn"),m=u("v-list-item-content"),r=u("v-list-item"),f=u("v-list"),D=u("v-menu");return y(),F("div",_e,[B("div",Ce,[g(p,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=A=>e.allSelected=A),onChange:e.toggleAll},null,8,["modelValue","onChange"]),g(D,null,{activator:h(({props:A})=>{var b,M;return[g(a,ce({color:"primary"},A,{variant:(((b=e.selectedBrands)==null?void 0:b.length)??0)>0?"tonal":"text",disabled:(((M=e.selectedBrands)==null?void 0:M.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:h(()=>{var T,k,U;return[$(pe((((T=e.selectedBrands)==null?void 0:T.length)??0)>0?"Выбрано "+(((k=e.selectedBrands)==null?void 0:k.length)??0)+"  ":"Выбрать все")+" ",1),(((U=e.selectedBrands)==null?void 0:U.length)??0)>0?(y(),I(n,{key:0},{default:h(()=>[$("mdi-chevron-down")]),_:1})):N("",!0)]}),_:2},1040,["variant","disabled"])]}),default:h(()=>[g(f,null,{default:h(()=>[g(r,{onClick:e.handleDeleteBrand},{default:h(()=>[g(m,null,{default:h(()=>[ye]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const be=P(fe,[["render",Ae]]),Me=O({name:"BrandsHeaderBar",components:{BrandsActionsBlock:be,CustomButton:L},props:{handleSearch:{type:Function,required:!0},brands:Array,allSelected:Boolean,selectedBrands:Array},data(){},setup(e,{emit:t}){const o=d(""),i=d(e.allSelected),c=ne.debounce(a=>{e.handleSearch(a)},700),v=a=>{o.value=a,c(a)};return w(()=>e.allSelected,a=>{i.value=a}),{inputValue:o,allSelected:i,handleInput:v,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteBrandClicked")}}}});const Te=e=>(ge("data-v-1a68c492"),e=e(),ve(),e),Se={class:"header_container"},$e={class:"header-body"},De={class:"input-wrapper"},ke=Te(()=>B("img",{src:ae,class:"search-icon",alt:"Search"},null,-1));function Ee(e,t,o,i,c,v){const p=u("CustomButton"),n=u("BrandsActionsBlock");return y(),F("div",Se,[B("div",$e,[B("div",De,[ke,J(B("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=a=>e.inputValue=a),onInput:t[1]||(t[1]=a=>e.handleInput(e.inputValue))},null,544),[[q,e.inputValue]])]),g(p,{onClick:t[2]||(t[2]=a=>e.$emit("modalToggler"))},{default:h(()=>[$("Создать")]),_:1})]),g(n,{allSelected:e.allSelected,onDeleteBrandClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedBrands:e.selectedBrands},null,8,["allSelected","onDeleteBrandClicked","onToggleAll","selectedBrands"])])}const we=P(Me,[["render",Ee],["__scopeId","data-v-1a68c492"]]);function Ie(){const e=d([]),t=d(!0);let o=d(0);const i=57,c=d(12),v=()=>{const a=window.innerHeight;c.value=Math.floor((a-310)/i)};Q(()=>{v(),window.addEventListener("resize",v),n(1,"",void 0)}),me(()=>{window.removeEventListener("resize",v)});const p={Authorization:j},n=async(a,m,r)=>{var f,D;try{const A=!r||r.sortState==="none"?"":`&sort_field=title&sort_type=${r.sortState}`,b=`${V}/brands?page=${a-1}&size=${c.value}${A}&search=${m}`,M=await se.get(b,{headers:p});e.value=(f=M.data)==null?void 0:f.result,o.value=(D=M.data)==null?void 0:D.count}catch(A){console.log(A)}finally{t.value=!1}};return Q(()=>{n(1,"",void 0)}),{brands:e,isLoading:t,totalCount:o,size:c,fetching:n}}const Ve=O({components:{CustomButton:L,CustomModal:W},props:{modalTitle:{type:String,default:"Создать бренд"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e){const t=d(""),o=d(!1);return w(()=>e.modalActive,()=>{t.value="",o.value=!1}),{title:t,validate:()=>{t.value.length>0?o.value=!0:o.value=!1},isAllDataEntered:o}},methods:{onCreateButtonClick(){this.$emit("createBrand",{title:this.title})}}});const je={class:"modal-content"},Fe={class:"button-box"};function Oe(e,t,o,i,c,v){const p=u("a-alert"),n=u("CustomButton"),a=u("CustomModal");return y(),I(a,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:h(()=>{var m;return[B("div",je,[(y(),F("form",{onSubmit:t[2]||(t[2]=z((...r)=>e.onCreateButtonClick&&e.onCreateButtonClick(...r),["prevent"])),key:e.modalActive.toString()},[J(B("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>e.title=r),onInput:t[1]||(t[1]=(...r)=>e.validate&&e.validate(...r)),class:"inputFirstName"},null,544),[[q,e.title]]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(y(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),B("div",Fe,[g(n,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:h(()=>[$(" Закрыть ")]),_:1},8,["onClick"]),g(n,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:h(()=>[$(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Pe=P(Ve,[["render",Oe],["__scopeId","data-v-98f95eb4"]]),Ue=O({components:{CustomButton:L,CustomModal:W},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,curBrand:Object},setup(e){const t=d(""),o=d(!1);w(()=>e.curBrand,c=>{t.value=c.title,i()});const i=()=>{t.value.length>0?o.value=!0:o.value=!1};return{title:t,validate:i,isAllDataEntered:o}},directives:{maska:de},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){console.log("title=",this.title),this.$emit("editBrand",{title:this.title,id:e})}}});const ze={class:"modal-content"},He={class:"button-box"};function Le(e,t,o,i,c,v){const p=u("a-alert"),n=u("CustomButton"),a=u("CustomModal");return y(),I(a,{onClose:z(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:h(()=>{var m;return[B("div",ze,[B("form",{onSubmit:t[2]||(t[2]=z(r=>{var f;return e.onSaveButtonClick(((f=e.curBrand)==null?void 0:f.id)??0)},["prevent"]))},[J(B("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>e.title=r),onInput:t[1]||(t[1]=(...r)=>e.validate&&e.validate(...r)),class:"inputFirstName"},null,544),[[q,e.title]]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(y(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),B("div",He,[g(n,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:h(()=>[$(" Закрыть ")]),_:1},8,["onClick"]),g(n,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:h(()=>[$(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Ne=P(Ue,[["render",Le],["__scopeId","data-v-870f87c2"]]),Je=O({name:"BrandsListPage",components:{EditBrandModal:Ne,EditUserModal:re,DeleteModal:ie,CreateBrandModal:Pe,TableData:ue,BrandsHeaderBar:we},mounted(){const e={Authorization:j};fetch(`${V}/brands`,{headers:e}).then(t=>t.json()).then(t=>this.brands=t==null?void 0:t.result).catch(t=>console.log(t))},setup(){const e=d(!1),t=d(!1),o=d(""),i=d(""),c=d(""),v=d(null),p=d(!1),n=d([]),a=d([]),{brands:m,isLoading:r,fetching:f,totalCount:D,size:A}=Ie(),b=d(!1),M=d(null),T=he(()=>!m.value||r.value?[]:m.value.map(l=>({id:l.id,title:l.title}))),k=()=>{f(1,c.value,v.value),n.value=[]},U=l=>{c.value=l};w(c,l=>{f(1,l,v.value),n.value=[]});const R=()=>{e.value=!e.value},X=l=>{const _={method:"POST",headers:{Authorization:j,"Content-Type":"application/json"},body:JSON.stringify({title:l.title})};console.log("CREATE BRAND",l,_),fetch(`${V}/brand`,_).then(async s=>{var S;const C=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=C&&C.error||s;return setTimeout(()=>{o.value=C.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}R(),k(),setTimeout(()=>{i.value="Новый бренд успешно создан",setTimeout(()=>{i.value=""},2e3)},200)}).catch(s=>{setTimeout(()=>{o.value=s.error,setTimeout(()=>{o.value=""},3e3)},200),console.error("There was an error!",s)})},Y=l=>{console.log("ids",l);const _={method:"DELETE",headers:{Authorization:j,"Content-Type":"application/json"},body:JSON.stringify({brand_ids:l})};console.log("requestOptions",_),fetch(`${V}/brand`,_).then(async s=>{var S;const C=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=C&&C.message||s.status;return setTimeout(()=>{o.value=C.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}K(),k()}).catch(s=>{setTimeout(()=>{o.value=s.error,setTimeout(()=>{o.value=""},3e3)},200),console.error("There was an error!",s)})},Z=()=>{a.value=[...n.value],t.value=!0,console.log("DELETE2",a)},x=l=>{console.log("onBrandDelete",l),a.value=[l.id],t.value=!0},ee=l=>{console.log("onBrandEdit",l),M.value=l,H()},K=()=>{t.value=!1};function te(){p.value?n.value=[]:n.value=T.value.map(l=>l.id)}const oe=l=>{l.value=l,f(1,c.value,l.value)},le=l=>{let _=T.value[l].id;n.value.includes(_)?n.value=n.value.filter(s=>s!==_):n.value=[...n.value,_]};w(n,l=>{l.length===T.value.length&&T.value.length!=0?p.value=!0:p.value=!1});const H=()=>{b.value=!b.value};return{brandsTableData:T,isLoading:r,fetching:f,totalCount:D,size:A,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"684px",withSort:!0}],createBrandModalToggler:R,modalActive:e,searchValue:c,onCreateBrand:X,brands:m,errorMessage:o,handleSearch:U,allSelected:p,selectedBrandIds:n,deleteBrandClicked:Z,deleteModalActive:t,onBrandDelete:x,closeDeleteModal:K,toggleAll:te,handleSortSelected:oe,toggleSelection:le,onBrandEdit:ee,deleteItems:a,deleteAction:Y,showAlert:i,editModalActive:b,editToggleModal:H,onEditBrand:l=>{const _={method:"PUT",headers:{Authorization:j,"Content-Type":"application/json"},body:JSON.stringify({brand_id:l.id,title:l.title})};fetch(`${V}/brand`,_).then(async s=>{var S;const C=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=C&&C.message||s.status;return console.log("HERE IT IS",E),setTimeout(()=>{o.value=C.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}H(),k(),setTimeout(()=>{i.value="Бренд успешно отредактирован!",setTimeout(()=>{i.value=""},2e3)},200)}).catch(s=>{o.value=s.error,console.error("There was an error!",s)})},selectedEditBrand:M}}});const qe={class:"content-body"},Re={key:1};function Ke(e,t,o,i,c,v){const p=u("BrandsHeaderBar"),n=u("TableData"),a=u("CreateBrandModal"),m=u("EditBrandModal"),r=u("DeleteModal");return y(),F(Be,null,[B("div",qe,[g(p,{onModalToggler:e.createBrandModalToggler,handleSearch:e.handleSearch,allSelected:e.allSelected,selectedBrands:e.selectedBrandIds,onDeleteBrandClicked:e.deleteBrandClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","allSelected","selectedBrands","onDeleteBrandClicked","onToggleAll"]),e.isLoading?(y(),F("span",Re,"Загрузка ...")):(y(),I(n,{key:0,tableData:e.brandsTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,selectedUsers:e.selectedBrandIds,onToggleSelection:e.toggleSelection,onOnUserDelete:e.onBrandDelete,onOnUserEdit:e.onBrandEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","selectedUsers","onToggleSelection","onOnUserDelete","onOnUserEdit"]))]),g(a,{toggleModal:e.createBrandModalToggler,modalActive:e.modalActive,onCreateBrand:e.onCreateBrand,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateBrand","errorMessage"]),g(m,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditBrand:e.onEditBrand,errorMessage:e.errorMessage,curBrand:e.selectedEditBrand},null,8,["editModalActive","editToggleModal","onEditBrand","errorMessage","curBrand"]),g(r,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"brand"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const Xe=P(Je,[["render",Ke],["__scopeId","data-v-9e3a4bd2"]]);export{Xe as default};
