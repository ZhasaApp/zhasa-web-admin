import{C as R,l as le,_ as ne,B as P,a as ae,T as O,b as se,D as de,c as re}from"./DeleteModal-b1a37217.js";import{d as z,r as d,w as E,_ as U,a as r,o as A,c as w,b as f,e as p,f as _,m as ie,g as I,t as ue,h as j,i as K,j as G,v as Q,p as ce,k as ge,l as J,n as ve,q,s as pe,F as me}from"./index-7a8a4b3e.js";const he=z({name:"BrandsActionsBlock",props:{allSelected:Boolean,selectedBrands:Array},setup(e,{emit:t}){const l=d(e.allSelected);return E(()=>e.allSelected,v=>{l.value=v}),{allSelected:l,toggleAll:()=>{t("toggleAll")},handleDeleteBrand:()=>{t("deleteBrandClicked")},roleOptions:[]}}});const Be={class:"outer_actions_block"},_e={class:"actions_first_block"},fe=f("span",{class:"deleteText"},"Удалить",-1);function Ce(e,t,l,i,u,v){const g=r("v-checkbox"),n=r("v-icon"),a=r("v-btn"),m=r("v-list-item-content"),c=r("v-list-item"),C=r("v-list"),D=r("v-menu");return A(),w("div",Be,[f("div",_e,[p(g,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=y=>e.allSelected=y),onChange:e.toggleAll},null,8,["modelValue","onChange"]),p(D,null,{activator:_(({props:y})=>{var T,S;return[p(a,ie({color:"primary"},y,{variant:(((T=e.selectedBrands)==null?void 0:T.length)??0)>0?"tonal":"text",disabled:(((S=e.selectedBrands)==null?void 0:S.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:_(()=>{var b,$,V;return[I(ue((((b=e.selectedBrands)==null?void 0:b.length)??0)>0?"Выбрано "+((($=e.selectedBrands)==null?void 0:$.length)??0)+"  ":"Выбрать все")+" ",1),(((V=e.selectedBrands)==null?void 0:V.length)??0)>0?(A(),j(n,{key:0},{default:_(()=>[I("mdi-chevron-down")]),_:1})):K("",!0)]}),_:2},1040,["variant","disabled"])]}),default:_(()=>[p(C,null,{default:_(()=>[p(c,{onClick:e.handleDeleteBrand},{default:_(()=>[p(m,null,{default:_(()=>[fe]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const ye=U(he,[["render",Ce]]),Ae=z({name:"BrandsHeaderBar",components:{BrandsActionsBlock:ye,CustomButton:R},props:{handleSearch:{type:Function,required:!0},brands:Array,allSelected:Boolean,selectedBrands:Array},data(){},setup(e,{emit:t}){const l=d(""),i=d(e.allSelected),u=le.debounce(a=>{e.handleSearch(a)},700),v=a=>{l.value=a,u(a)};return E(()=>e.allSelected,a=>{i.value=a}),{inputValue:l,allSelected:i,handleInput:v,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteBrandClicked")}}}});const Te=e=>(ce("data-v-1a68c492"),e=e(),ge(),e),Se={class:"header_container"},be={class:"header-body"},Me={class:"input-wrapper"},De=Te(()=>f("img",{src:ne,class:"search-icon",alt:"Search"},null,-1));function $e(e,t,l,i,u,v){const g=r("CustomButton"),n=r("BrandsActionsBlock");return A(),w("div",Se,[f("div",be,[f("div",Me,[De,G(f("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=a=>e.inputValue=a),onInput:t[1]||(t[1]=a=>e.handleInput(e.inputValue))},null,544),[[Q,e.inputValue]])]),p(g,{onClick:t[2]||(t[2]=a=>e.$emit("modalToggler"))},{default:_(()=>[I("Создать")]),_:1})]),p(n,{allSelected:e.allSelected,onDeleteBrandClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedBrands:e.selectedBrands},null,8,["allSelected","onDeleteBrandClicked","onToggleAll","selectedBrands"])])}const ke=U(Ae,[["render",$e],["__scopeId","data-v-1a68c492"]]);function Ee(){const e=d([]),t=d(!0);let l=d(0);const i=57,u=d(12),v=()=>{const a=window.innerHeight;u.value=Math.floor((a-310)/i)};J(()=>{v(),window.addEventListener("resize",v),n(1,"",void 0)}),ve(()=>{window.removeEventListener("resize",v)});const g={Authorization:O},n=async(a,m,c)=>{var C,D;try{const y=!c||c.sortState==="none"?"":`&sort_field=title&sort_type=${c.sortState}`,T=`${P}/brands?page=${a-1}&size=${u.value}${y}&search=${m}`,S=await ae.get(T,{headers:g});e.value=(C=S.data)==null?void 0:C.result,l.value=(D=S.data)==null?void 0:D.count}catch(y){console.log(y)}finally{t.value=!1}};return J(()=>{n(1,"",void 0)}),{brands:e,isLoading:t,totalCount:l,size:u,fetching:n}}const we=z({components:{CustomButton:R,CustomModal:se},props:{modalTitle:{type:String,default:"Создать бренд"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e){const t=d(""),l=d(!1);return E(()=>e.modalActive,()=>{t.value="",l.value=!1}),{title:t,validate:()=>{t.value.length>0?l.value=!0:l.value=!1},isAllDataEntered:l}},methods:{onCreateButtonClick(){this.$emit("createBrand",{title:this.title})}}});const Ie={class:"modal-content"},Ve={class:"button-box"};function Pe(e,t,l,i,u,v){const g=r("a-alert"),n=r("CustomButton"),a=r("CustomModal");return A(),j(a,{onClose:q(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:_(()=>{var m;return[f("div",Ie,[(A(),w("form",{onSubmit:t[2]||(t[2]=q((...c)=>e.onCreateButtonClick&&e.onCreateButtonClick(...c),["prevent"])),key:e.modalActive.toString()},[G(f("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=c=>e.title=c),onInput:t[1]||(t[1]=(...c)=>e.validate&&e.validate(...c)),class:"inputFirstName"},null,544),[[Q,e.title]]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(A(),j(g,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):K("",!0),f("div",Ve,[p(n,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:_(()=>[I(" Закрыть ")]),_:1},8,["onClick"]),p(n,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:_(()=>[I(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Oe=U(we,[["render",Pe],["__scopeId","data-v-98f95eb4"]]),je=z({name:"BrandsListPage",components:{DeleteModal:de,CreateBrandModal:Oe,TableData:re,BrandsHeaderBar:ke},setup(){const e=d(!1),t=d(!1),l=d(""),i=d(""),u=d(""),v=d(null),g=d(!1),n=d([]),a=d([]),{brands:m,isLoading:c,fetching:C,totalCount:D,size:y}=Ee(),T=d(!1),S=d(null),b=pe(()=>!m.value||c.value?[]:m.value.map(o=>({id:o.id,title:o.title}))),$=()=>{C(1,u.value,v.value),n.value=[]},V=o=>{u.value=o};E(u,o=>{C(1,o,v.value),n.value=[]});const H=()=>{e.value=!e.value},W=o=>{const h={method:"POST",headers:{Authorization:O,"Content-Type":"application/json"},body:JSON.stringify({title:o.title})};console.log("CREATE BRAND",o,h),fetch(`${P}/brand`,h).then(async s=>{var M;const B=((M=s.headers.get("content-type"))==null?void 0:M.includes("application/json"))&&await s.json();if(!s.ok){const k=B&&B.error||s;return setTimeout(()=>{l.value=B.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(k)}H(),$(),setTimeout(()=>{i.value="Новый бренд успешно создан",setTimeout(()=>{i.value=""},2e3)},200)}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},X=o=>{console.log("ids",o);const h={method:"DELETE",headers:{Authorization:O,"Content-Type":"application/json"},body:JSON.stringify({brand_ids:o})};console.log("requestOptions",h),fetch(`${P}/brand`,h).then(async s=>{var M;const B=((M=s.headers.get("content-type"))==null?void 0:M.includes("application/json"))&&await s.json();if(!s.ok){const k=B&&B.message||s.status;return setTimeout(()=>{l.value=B.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(k)}L(),$()}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},Y=()=>{a.value=[...n.value],t.value=!0,console.log("DELETE2",a)},Z=o=>{console.log("onBrandDelete",o),a.value=[o.id],t.value=!0},x=o=>{console.log("onBrandEdit",o),S.value=o,F()},L=()=>{t.value=!1};function ee(){g.value?n.value=[]:n.value=b.value.map(o=>o.id)}const te=o=>{o.value=o,C(1,u.value,o.value)},oe=o=>{let h=b.value[o].id;n.value.includes(h)?n.value=n.value.filter(s=>s!==h):n.value=[...n.value,h]};E(n,o=>{o.length===b.value.length&&b.value.length!=0?g.value=!0:g.value=!1});const F=()=>{T.value=!T.value};return{brandsTableData:b,isLoading:c,fetching:C,totalCount:D,size:y,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"684px",withSort:!0}],createBrandModalToggler:H,modalActive:e,searchValue:u,onCreateBrand:W,brands:m,errorMessage:l,handleSearch:V,allSelected:g,selectedBrandIds:n,deleteBrandClicked:Y,deleteModalActive:t,onBrandDelete:Z,closeDeleteModal:L,toggleAll:ee,handleSortSelected:te,toggleSelection:oe,onBrandEdit:x,deleteItems:a,deleteAction:X,showAlert:i,editModalActive:T,editToggleModal:F,onEditBrand:o=>{const h={method:"PUT",headers:{Authorization:O,"Content-Type":"application/json"},body:JSON.stringify({brand_id:o.id,title:o.title})};fetch(`${P}/brand`,h).then(async s=>{var M;const B=((M=s.headers.get("content-type"))==null?void 0:M.includes("application/json"))&&await s.json();if(!s.ok){const k=B&&B.message||s.status;return console.log("HERE IT IS",k),setTimeout(()=>{l.value=B.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(k)}F(),$(),setTimeout(()=>{i.value="Бренд успешно отредактирован!",setTimeout(()=>{i.value=""},2e3)},200)}).catch(s=>{l.value=s.error,console.error("There was an error!",s)})},selectedEditBrand:S}}});const ze={class:"content-body"},Ue={key:1};function Fe(e,t,l,i,u,v){const g=r("BrandsHeaderBar"),n=r("TableData"),a=r("CreateBrandModal"),m=r("EditBrandModal"),c=r("DeleteModal");return A(),w(me,null,[f("div",ze,[p(g,{onModalToggler:e.createBrandModalToggler,handleSearch:e.handleSearch,allSelected:e.allSelected,selectedBrands:e.selectedBrandIds,onDeleteBrandClicked:e.deleteBrandClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","allSelected","selectedBrands","onDeleteBrandClicked","onToggleAll"]),e.isLoading?(A(),w("span",Ue,"Загрузка ...")):(A(),j(n,{key:0,tableData:e.brandsTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,selectedUsers:e.selectedBrandIds,onToggleSelection:e.toggleSelection,onOnUserDelete:e.onBrandDelete,onOnUserEdit:e.onBrandEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","selectedUsers","onToggleSelection","onOnUserDelete","onOnUserEdit"]))]),p(a,{toggleModal:e.createBrandModalToggler,modalActive:e.modalActive,onCreateBrand:e.onCreateBrand,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateBrand","errorMessage"]),p(m,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditBrand:e.onEditBrand,errorMessage:e.errorMessage,curBrand:e.selectedEditBrand},null,8,["editModalActive","editToggleModal","onEditBrand","errorMessage","curBrand"]),p(c,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"brand"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const Je=U(je,[["render",Fe],["__scopeId","data-v-0ee4df5b"]]);export{Je as default};
