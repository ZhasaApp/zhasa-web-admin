import{C as L,l as ae,_ as ne,B as j,a as se,T as U,b as W,U as de,D as re,c as ie}from"./maska-702f4c00.js";import{d as O,r as d,w,_ as P,a as u,o as A,c as V,b as h,e as v,f as B,m as ue,g as D,t as ce,h as I,i as N,j as J,v as q,p as pe,k as ge,l as Q,n as ve,q as z,s as me,F as Be}from"./index-58b4ec5e.js";const he=O({name:"BrandsActionsBlock",props:{allSelected:Boolean,selectedBrands:Array},setup(e,{emit:t}){const o=d(e.allSelected);return w(()=>e.allSelected,m=>{o.value=m}),{allSelected:o,toggleAll:()=>{t("toggleAll")},handleDeleteBrand:()=>{t("deleteBrandClicked")},roleOptions:[]}}});const fe={class:"outer_actions_block"},_e={class:"actions_first_block"},Ce=h("span",{class:"deleteText"},"Удалить",-1);function ye(e,t,o,r,i,m){const g=u("v-checkbox"),a=u("v-icon"),n=u("v-btn"),p=u("v-list-item-content"),c=u("v-list-item"),f=u("v-list"),$=u("v-menu");return A(),V("div",fe,[h("div",_e,[v(g,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=b=>e.allSelected=b),onChange:e.toggleAll},null,8,["modelValue","onChange"]),v($,null,{activator:B(({props:b})=>{var M,T;return[v(n,ue({color:"primary"},b,{variant:(((M=e.selectedBrands)==null?void 0:M.length)??0)>0?"tonal":"text",disabled:(((T=e.selectedBrands)==null?void 0:T.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:B(()=>{var _,k,F;return[D(ce((((_=e.selectedBrands)==null?void 0:_.length)??0)>0?"Выбрано "+(((k=e.selectedBrands)==null?void 0:k.length)??0)+"  ":"Выбрать все")+" ",1),(((F=e.selectedBrands)==null?void 0:F.length)??0)>0?(A(),I(a,{key:0},{default:B(()=>[D("mdi-chevron-down")]),_:1})):N("",!0)]}),_:2},1040,["variant","disabled"])]}),default:B(()=>[v(f,null,{default:B(()=>[v(c,{onClick:e.handleDeleteBrand},{default:B(()=>[v(p,null,{default:B(()=>[Ce]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const Ae=P(he,[["render",ye]]),Me=O({name:"BrandsHeaderBar",components:{BrandsActionsBlock:Ae,CustomButton:L},props:{handleSearch:{type:Function,required:!0},brands:Array,allSelected:Boolean,selectedBrands:Array},data(){},setup(e,{emit:t}){const o=d(""),r=d(e.allSelected),i=ae.debounce(n=>{e.handleSearch(n)},700),m=n=>{o.value=n,i(n)};return w(()=>e.allSelected,n=>{r.value=n}),{inputValue:o,allSelected:r,handleInput:m,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteBrandClicked")}}}});const be=e=>(pe("data-v-1a68c492"),e=e(),ge(),e),Se={class:"header_container"},Te={class:"header-body"},De={class:"input-wrapper"},$e=be(()=>h("img",{src:ne,class:"search-icon",alt:"Search"},null,-1));function ke(e,t,o,r,i,m){const g=u("CustomButton"),a=u("BrandsActionsBlock");return A(),V("div",Se,[h("div",Te,[h("div",De,[$e,J(h("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=n=>e.inputValue=n),onInput:t[1]||(t[1]=n=>e.handleInput(e.inputValue))},null,544),[[q,e.inputValue]])]),v(g,{onClick:t[2]||(t[2]=n=>e.$emit("modalToggler"))},{default:B(()=>[D("Создать")]),_:1})]),v(a,{allSelected:e.allSelected,onDeleteBrandClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedBrands:e.selectedBrands},null,8,["allSelected","onDeleteBrandClicked","onToggleAll","selectedBrands"])])}const Ee=P(Me,[["render",ke],["__scopeId","data-v-1a68c492"]]);function we(){const e=d([]),t=d(!0);let o=d(0);const r=57,i=d(12),m=()=>{const p=window.innerHeight;n()?i.value=20:i.value=Math.floor((p-310)/r)};Q(()=>{m(),window.addEventListener("resize",m),a(1,"",void 0)}),ve(()=>{window.removeEventListener("resize",m)});const g={Authorization:U},a=async(p,c,f)=>{var $,b;try{const M=!f||f.sortState==="none"?"":`&sort_field=title&sort_type=${f.sortState}`,T=`${j}/brands?page=${p-1}&size=${i.value}${M}&search=${c}`,_=await se.get(T,{headers:g});e.value=($=_.data)==null?void 0:$.result,o.value=(b=_.data)==null?void 0:b.count}catch(M){console.log(M)}finally{t.value=!1}},n=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return Q(()=>{a(1,"",void 0)}),{brands:e,isLoading:t,totalCount:o,size:i,fetching:a}}const Ie=O({components:{CustomButton:L,CustomModal:W},props:{modalTitle:{type:String,default:"Создать бренд"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e){const t=d(""),o=d(!1);return w(()=>e.modalActive,()=>{t.value="",o.value=!1}),{title:t,validate:()=>{t.value.length>0?o.value=!0:o.value=!1},isAllDataEntered:o}},methods:{onCreateButtonClick(){this.$emit("createBrand",{title:this.title})}}});const Ve={class:"modal-content"},Oe={class:"button-box"};function Pe(e,t,o,r,i,m){const g=u("a-alert"),a=u("CustomButton"),n=u("CustomModal");return A(),I(n,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:B(()=>{var p;return[h("div",Ve,[(A(),V("form",{onSubmit:t[2]||(t[2]=z((...c)=>e.onCreateButtonClick&&e.onCreateButtonClick(...c),["prevent"])),key:e.modalActive.toString()},[J(h("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=c=>e.title=c),onInput:t[1]||(t[1]=(...c)=>e.validate&&e.validate(...c)),class:"inputFirstName"},null,544),[[q,e.title]]),(((p=e.errorMessage)==null?void 0:p.length)??0)>0?(A(),I(g,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),h("div",Oe,[v(a,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),v(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:B(()=>[D(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Fe=P(Ie,[["render",Pe],["__scopeId","data-v-98f95eb4"]]),je=O({components:{CustomButton:L,CustomModal:W},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,curBrand:Object},setup(e){const t=d(""),o=d(!1);w(()=>e.curBrand,i=>{t.value=i.title,r()});const r=()=>{t.value.length>0?o.value=!0:o.value=!1};return{title:t,validate:r,isAllDataEntered:o}},directives:{maska:de},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){console.log("title=",this.title),this.$emit("editBrand",{title:this.title,id:e})}}});const Ue={class:"modal-content"},ze={class:"button-box"};function He(e,t,o,r,i,m){const g=u("a-alert"),a=u("CustomButton"),n=u("CustomModal");return A(),I(n,{onClose:z(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:B(()=>{var p;return[h("div",Ue,[h("form",{onSubmit:t[2]||(t[2]=z(c=>{var f;return e.onSaveButtonClick(((f=e.curBrand)==null?void 0:f.id)??0)},["prevent"]))},[J(h("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=c=>e.title=c),onInput:t[1]||(t[1]=(...c)=>e.validate&&e.validate(...c)),class:"inputFirstName"},null,544),[[q,e.title]]),(((p=e.errorMessage)==null?void 0:p.length)??0)>0?(A(),I(g,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),h("div",ze,[v(a,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:B(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),v(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:B(()=>[D(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Le=P(je,[["render",He],["__scopeId","data-v-870f87c2"]]),Ne=O({name:"BrandsListPage",components:{EditBrandModal:Le,DeleteModal:re,CreateBrandModal:Fe,TableData:ie,BrandsHeaderBar:Ee},setup(){const e=d(!1),t=d(!1),o=d(""),r=d(""),i=d(""),m=d(null),g=d(!1),a=d([]),n=d([]),{brands:p,isLoading:c,fetching:f,totalCount:$,size:b}=we(),M=d(!1),T=d(null),_=me(()=>!p.value||c.value?[]:p.value.map(l=>({id:l.id,title:l.title}))),k=()=>{f(1,i.value,m.value),a.value=[]},F=l=>{i.value=l};w(i,l=>{f(1,l,m.value),a.value=[]});const R=()=>{e.value=!e.value},X=l=>{const C={method:"POST",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({title:l.title})};console.log("CREATE BRAND",l,C),fetch(`${j}/brand`,C).then(async s=>{var S;const y=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=y&&y.error||s;return setTimeout(()=>{o.value=y.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}R(),k(),setTimeout(()=>{r.value="Новый бренд успешно создан",setTimeout(()=>{r.value=""},2e3)},200)}).catch(s=>{setTimeout(()=>{o.value=s.error,setTimeout(()=>{o.value=""},3e3)},200),console.error("There was an error!",s)})},Y=l=>{console.log("ids",l);const C={method:"DELETE",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({brand_ids:l})};console.log("requestOptions",C),fetch(`${j}/brand`,C).then(async s=>{var S;const y=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=y&&y.message||s.status;return setTimeout(()=>{o.value=y.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}K(),k()}).catch(s=>{setTimeout(()=>{o.value=s.error,setTimeout(()=>{o.value=""},3e3)},200),console.error("There was an error!",s)})},Z=()=>{n.value=[...a.value],t.value=!0,console.log("DELETE2",n)},x=l=>{console.log("onBrandDelete",l),n.value=[l.id],t.value=!0},ee=l=>{console.log("onBrandEdit",l),T.value=l,H()},K=()=>{t.value=!1};function te(){g.value?a.value=[]:a.value=_.value.map(l=>l.id)}const oe=l=>{l.value=l,f(1,i.value,l.value)},le=l=>{let C=_.value[l].id;a.value.includes(C)?a.value=a.value.filter(s=>s!==C):a.value=[...a.value,C]};w(a,l=>{l.length===_.value.length&&_.value.length!=0?g.value=!0:g.value=!1});const H=()=>{M.value=!M.value};return{brandsTableData:_,isLoading:c,fetching:f,totalCount:$,size:b,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"684px",withSort:!0}],createBrandModalToggler:R,modalActive:e,searchValue:i,onCreateBrand:X,brands:p,errorMessage:o,handleSearch:F,allSelected:g,selectedBrandIds:a,deleteBrandClicked:Z,deleteModalActive:t,onBrandDelete:x,closeDeleteModal:K,toggleAll:te,handleSortSelected:oe,toggleSelection:le,onBrandEdit:ee,deleteItems:n,deleteAction:Y,showAlert:r,editModalActive:M,editToggleModal:H,onEditBrand:l=>{const C={method:"PUT",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({brand_id:l.id,title:l.title})};fetch(`${j}/brand`,C).then(async s=>{var S;const y=((S=s.headers.get("content-type"))==null?void 0:S.includes("application/json"))&&await s.json();if(!s.ok){const E=y&&y.message||s.status;return console.log("HERE IT IS",E),setTimeout(()=>{o.value=y.error,setTimeout(()=>{o.value=""},3e3)},200),Promise.reject(E)}H(),k(),setTimeout(()=>{r.value="Бренд успешно отредактирован!",setTimeout(()=>{r.value=""},2e3)},200)}).catch(s=>{o.value=s.error,console.error("There was an error!",s)})},selectedEditBrand:T}}});const Je={class:"content-body"},qe={key:1};function Re(e,t,o,r,i,m){const g=u("BrandsHeaderBar"),a=u("TableData"),n=u("CreateBrandModal"),p=u("EditBrandModal"),c=u("DeleteModal");return A(),V(Be,null,[h("div",Je,[v(g,{onModalToggler:e.createBrandModalToggler,handleSearch:e.handleSearch,allSelected:e.allSelected,selectedBrands:e.selectedBrandIds,onDeleteBrandClicked:e.deleteBrandClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","allSelected","selectedBrands","onDeleteBrandClicked","onToggleAll"]),e.isLoading?(A(),V("span",qe,"Загрузка ...")):(A(),I(a,{key:0,tableData:e.brandsTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,selectedUsers:e.selectedBrandIds,onToggleSelection:e.toggleSelection,onOnUserDelete:e.onBrandDelete,onOnUserEdit:e.onBrandEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","selectedUsers","onToggleSelection","onOnUserDelete","onOnUserEdit"]))]),v(n,{toggleModal:e.createBrandModalToggler,modalActive:e.modalActive,onCreateBrand:e.onCreateBrand,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateBrand","errorMessage"]),v(p,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditBrand:e.onEditBrand,errorMessage:e.errorMessage,curBrand:e.selectedEditBrand},null,8,["editModalActive","editToggleModal","onEditBrand","errorMessage","curBrand"]),v(c,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"brand"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const We=P(Ne,[["render",Re],["__scopeId","data-v-d53e1e4d"]]);export{We as default};
