import{C as H,l as ae,_ as ne,B as j,a as se,T as U,b as Q,U as de,c as ie,D as ue}from"./maska-6653e903.js";import{d as F,r as d,w,_ as O,a as r,o as f,c as V,b as T,e as g,f as y,m as re,g as D,t as ce,h as I,i as N,j as J,v as q,p as pe,k as ge,l as G,n as ve,q as z,s as me,F as ye}from"./index-eabbc97a.js";const Te=F({name:"SaleTypesActionsBlock",props:{allSelected:Boolean,selectedSaleTypes:Array},setup(e,{emit:t}){const l=d(e.allSelected);return w(()=>e.allSelected,v=>{l.value=v}),{allSelected:l,toggleAll:()=>{t("toggleAll")},handleDeleteSaleType:()=>{t("deleteSaleTypeClicked")},roleOptions:[]}}});const Se={class:"outer_actions_block"},he={class:"actions_first_block"},_e=T("span",{class:"deleteText"},"Удалить",-1);function fe(e,t,l,u,c,v){const p=r("v-checkbox"),a=r("v-icon"),n=r("v-btn"),m=r("v-list-item-content"),i=r("v-list-item"),S=r("v-list"),k=r("v-menu");return f(),V("div",Se,[T("div",he,[g(p,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=C=>e.allSelected=C),onChange:e.toggleAll},null,8,["modelValue","onChange"]),g(k,null,{activator:y(({props:C})=>{var A,M;return[g(n,re({color:"primary"},C,{variant:(((A=e.selectedSaleTypes)==null?void 0:A.length)??0)>0?"tonal":"text",disabled:(((M=e.selectedSaleTypes)==null?void 0:M.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:y(()=>{var b,E,P;return[D(ce((((b=e.selectedSaleTypes)==null?void 0:b.length)??0)>0?"Выбрано "+(((E=e.selectedSaleTypes)==null?void 0:E.length)??0)+"  ":"Выбрать все")+" ",1),(((P=e.selectedSaleTypes)==null?void 0:P.length)??0)>0?(f(),I(a,{key:0},{default:y(()=>[D("mdi-chevron-down")]),_:1})):N("",!0)]}),_:2},1040,["variant","disabled"])]}),default:y(()=>[g(S,null,{default:y(()=>[g(i,{onClick:e.handleDeleteSaleType},{default:y(()=>[g(m,null,{default:y(()=>[_e]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const Ce=O(Te,[["render",fe]]),Ae=F({name:"SaleTypesHeaderBar",components:{SaleTypesActionsBlock:Ce,CustomButton:H},props:{handleSearch:{type:Function,required:!0},allSelected:Boolean,selectedSaleTypes:Array},data(){},setup(e,{emit:t}){const l=d(""),u=d(e.allSelected),c=ae.debounce(n=>{e.handleSearch(n)},700),v=n=>{l.value=n,c(n)};return w(()=>e.allSelected,n=>{u.value=n}),{inputValue:l,allSelected:u,handleInput:v,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteSaleTypeClicked")}}}});const Me=e=>(pe("data-v-ba4c5485"),e=e(),ge(),e),be={class:"header_container"},$e={class:"header-body"},De={class:"input-wrapper"},ke=Me(()=>T("img",{src:ne,class:"search-icon",alt:"Search"},null,-1));function Ee(e,t,l,u,c,v){const p=r("CustomButton"),a=r("SaleTypesActionsBlock");return f(),V("div",be,[T("div",$e,[T("div",De,[ke,J(T("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=n=>e.inputValue=n),onInput:t[1]||(t[1]=n=>e.handleInput(e.inputValue))},null,544),[[q,e.inputValue]])]),g(p,{onClick:t[2]||(t[2]=n=>e.$emit("modalToggler"))},{default:y(()=>[D("Создать")]),_:1})]),g(a,{allSelected:e.allSelected,onDeleteSaleTypeClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedSaleTypes:e.selectedSaleTypes},null,8,["allSelected","onDeleteSaleTypeClicked","onToggleAll","selectedSaleTypes"])])}const Be=O(Ae,[["render",Ee],["__scopeId","data-v-ba4c5485"]]);function we(){const e=d([]),t=d(!0);let l=d(0);const u=57,c=d(12),v=()=>{const n=window.innerHeight;c.value=Math.floor((n-310)/u)};G(()=>{v(),window.addEventListener("resize",v),a(1,"",void 0)}),ve(()=>{window.removeEventListener("resize",v)});const p={Authorization:U},a=async(n,m,i)=>{var S,k;try{const C=!i||i.sortState==="none"?"":`&sort_field=title&sort_type=${i.sortState}`,A=`${j}/sale-types?page=${n-1}&size=${c.value}${C}&search=${m}`,M=await se.get(A,{headers:p});e.value=(S=M.data)==null?void 0:S.result,l.value=(k=M.data)==null?void 0:k.count}catch(C){console.log(C)}finally{t.value=!1}};return G(()=>{a(1,"",void 0)}),{saleTypes:e,isLoading:t,totalCount:l,size:c,fetching:a}}const Ie=F({components:{CustomButton:H,CustomModal:Q},props:{modalTitle:{type:String,default:"Создать Тип Продаж"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e){const t=d(""),l=d(!1);return w(()=>e.modalActive,()=>{t.value="",l.value=!1}),{title:t,validate:()=>{t.value.length>0?l.value=!0:l.value=!1},isAllDataEntered:l}},methods:{onCreateButtonClick(){this.$emit("createSaleType",{title:this.title})}}});const Ve={class:"modal-content"},Fe={class:"button-box"};function Oe(e,t,l,u,c,v){const p=r("a-alert"),a=r("CustomButton"),n=r("CustomModal");return f(),I(n,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:y(()=>{var m;return[T("div",Ve,[(f(),V("form",{onSubmit:t[2]||(t[2]=z((...i)=>e.onCreateButtonClick&&e.onCreateButtonClick(...i),["prevent"])),key:e.modalActive.toString()},[J(T("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>e.title=i),onInput:t[1]||(t[1]=(...i)=>e.validate&&e.validate(...i)),class:"inputFirstName"},null,544),[[q,e.title]]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(f(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),T("div",Fe,[g(a,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),g(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[D(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Pe=O(Ie,[["render",Oe],["__scopeId","data-v-538d5dae"]]),je=F({components:{CustomButton:H,CustomModal:Q},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,curSaleType:Object},setup(e){const t=d(""),l=d(!1);w(()=>e.curSaleType,c=>{t.value=c.title,u()});const u=()=>{t.value.length>0?l.value=!0:l.value=!1};return{title:t,validate:u,isAllDataEntered:l}},directives:{maska:de},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){console.log("title=",this.title),this.$emit("editSaleType",{title:this.title,id:e})}}});const Ue={class:"modal-content"},ze={class:"button-box"};function Le(e,t,l,u,c,v){const p=r("a-alert"),a=r("CustomButton"),n=r("CustomModal");return f(),I(n,{onClose:z(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:y(()=>{var m;return[T("div",Ue,[T("form",{onSubmit:t[2]||(t[2]=z(i=>{var S;return e.onSaveButtonClick(((S=e.curSaleType)==null?void 0:S.id)??0)},["prevent"]))},[J(T("input",{placeholder:"Название типа продажи",type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>e.title=i),onInput:t[1]||(t[1]=(...i)=>e.validate&&e.validate(...i)),class:"inputFirstName"},null,544),[[q,e.title]]),(((m=e.errorMessage)==null?void 0:m.length)??0)>0?(f(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),T("div",ze,[g(a,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),g(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[D(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const He=O(je,[["render",Le],["__scopeId","data-v-d9f8b4d6"]]),Ne=F({name:"SaleTypeListPage",components:{TableData:ie,DeleteModal:ue,SaleTypesHeaderBar:Be,CreateSaleTypeModal:Pe,EditSaleTypeModal:He},setup(){const e=d(!1),t=d(!1),l=d(""),u=d(""),c=d(""),v=d(null),p=d(!1),a=d([]),n=d([]),{saleTypes:m,isLoading:i,fetching:S,totalCount:k,size:C}=we(),A=d(!1),M=d(null),b=me(()=>!m.value||i.value?[]:m.value.map(o=>({id:o.id,title:o.title}))),E=()=>{S(1,c.value,v.value),a.value=[]},P=o=>{c.value=o};w(c,o=>{S(1,o,v.value),a.value=[]});const R=()=>{e.value=!e.value},W=o=>{const h={method:"POST",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({title:o.title})};console.log("CREATE SALE TYPE",o,h),fetch(`${j}/sale-type`,h).then(async s=>{var $;const _=(($=s.headers.get("content-type"))==null?void 0:$.includes("application/json"))&&await s.json();if(!s.ok){const B=_&&_.error||s;return setTimeout(()=>{l.value=_.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}R(),E(),setTimeout(()=>{u.value="Новый Тип Продаж успешно создан",setTimeout(()=>{u.value=""},2e3)},200)}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},X=o=>{console.log("ids",o);const h={method:"DELETE",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({sale_type_ids:o})};console.log("requestOptions",h),fetch(`${j}/sale-type`,h).then(async s=>{var $;const _=(($=s.headers.get("content-type"))==null?void 0:$.includes("application/json"))&&await s.json();if(!s.ok){const B=_&&_.message||s.status;return setTimeout(()=>{l.value=_.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}K(),E()}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},Z=()=>{n.value=[...a.value],t.value=!0,console.log("DELETE2",n)},x=o=>{console.log("onDelete",o),n.value=[o.id],t.value=!0},ee=o=>{console.log("onEdit",o),M.value=o,L()},K=()=>{t.value=!1};function te(){p.value?a.value=[]:a.value=b.value.map(o=>o.id)}const le=o=>{o.value=o,S(1,c.value,o.value)},oe=o=>{let h=b.value[o].id;a.value.includes(h)?a.value=a.value.filter(s=>s!==h):a.value=[...a.value,h]};w(a,o=>{o.length===b.value.length&&b.value.length!=0?p.value=!0:p.value=!1});const L=()=>{A.value=!A.value};return{saleTypesTableData:b,isLoading:i,fetching:S,totalCount:k,size:C,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"684px",withSort:!0}],createSaleTypeModalToggler:R,modalActive:e,searchValue:c,onCreateSaleType:W,saleTypes:m,errorMessage:l,handleSearch:P,allSelected:p,selectedSaleTypeIds:a,deleteSaleTypeClicked:Z,deleteModalActive:t,onSaleTypeDelete:x,closeDeleteModal:K,toggleAll:te,handleSortSelected:le,toggleSelection:oe,onSaleTypeEdit:ee,deleteItems:n,deleteAction:X,showAlert:u,editModalActive:A,editToggleModal:L,onEditSaleType:o=>{const h={method:"PUT",headers:{Authorization:U,"Content-Type":"application/json"},body:JSON.stringify({sale_type_id:o.id,title:o.title})};fetch(`${j}/sale-type`,h).then(async s=>{var $;const _=(($=s.headers.get("content-type"))==null?void 0:$.includes("application/json"))&&await s.json();if(!s.ok){const B=_&&_.message||s.status;return console.log("HERE IT IS",B),setTimeout(()=>{l.value=_.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}L(),E(),setTimeout(()=>{u.value="Тип продаж успешно отредактирован!",setTimeout(()=>{u.value=""},2e3)},200)}).catch(s=>{l.value=s.error,console.error("There was an error!",s)})},selectedEditSaleType:M}}});const Je={class:"content-body"},qe={key:1};function Re(e,t,l,u,c,v){const p=r("SaleTypesHeaderBar"),a=r("TableData"),n=r("CreateSaleTypeModal"),m=r("EditSaleTypeModal"),i=r("DeleteModal");return f(),V(ye,null,[T("div",Je,[g(p,{onModalToggler:e.createSaleTypeModalToggler,handleSearch:e.handleSearch,allSelected:e.allSelected,selectedSaleTypes:e.selectedSaleTypeIds,onDeleteSaleTypeClicked:e.deleteSaleTypeClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","allSelected","selectedSaleTypes","onDeleteSaleTypeClicked","onToggleAll"]),e.isLoading?(f(),V("span",qe,"Загрузка ...")):(f(),I(a,{key:0,tableData:e.saleTypesTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,selectedUsers:e.selectedSaleTypeIds,onToggleSelection:e.toggleSelection,onOnUserDelete:e.onSaleTypeDelete,onOnUserEdit:e.onSaleTypeEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","selectedUsers","onToggleSelection","onOnUserDelete","onOnUserEdit"]))]),g(n,{toggleModal:e.createSaleTypeModalToggler,modalActive:e.modalActive,onCreateSaleType:e.onCreateSaleType,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateSaleType","errorMessage"]),g(m,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditSaleType:e.onEditSaleType,errorMessage:e.errorMessage,curSaleType:e.selectedEditSaleType},null,8,["editModalActive","editToggleModal","onEditSaleType","errorMessage","curSaleType"]),g(i,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"saleType"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const Qe=O(Ne,[["render",Re],["__scopeId","data-v-aacacdb0"]]);export{Qe as default};
