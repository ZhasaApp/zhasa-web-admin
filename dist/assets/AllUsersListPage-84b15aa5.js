import{C as x,b as le,U as Ie,R as ne,l as Pe,_ as Je,B as V,a as ze,T as N,D as Le,c as qe}from"./maska-6653e903.js";import{d as L,r as s,w as R,_ as q,a as u,u as He,o as A,h as J,f as v,q as z,b as k,c as F,j as X,v as oe,e as r,x as me,i as O,g as T,m as ge,t as ee,p as Ke,k as We,l as ve,n as Ge,s as Qe,F as Xe}from"./index-eabbc97a.js";import{E as Ye}from"./EditUserModal-c68d8f8a.js";const Ze=L({components:{CustomButton:x,CustomModal:le},props:{modalTitle:{type:String,default:"Создать нового пользователя"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,brands:Array,branches:Array},setup(e){const t=s(""),d=s(""),i=s(""),g=s(""),b=s(),c=s([]),p=s(!1);R(()=>e.modalActive,()=>{t.value="",d.value="",i.value="",g.value="",b.value=void 0,c.value=[],p.value=!1});const f=(h,n)=>n.label.toLowerCase().indexOf(h.toLowerCase())>=0,a=h=>{g.value=h,y()},m=h=>{b.value=h,y()},D=h=>{c.value=h,y()},y=()=>{t.value.length>0&&d.value.length>0&&i.value.length==16&&g.value.length>0&&(g.value=="owner"||b.value&&c.value.length>0)?p.value=!0:p.value=!1};return{firstName:t,lastName:d,telephoneNumber:i,selectedRole:g,selectedBranchId:b,selectedBrandsIds:c,filterOption:f,onRoleSelected:a,onBranchSelected:m,onBrandSelected:D,validate:y,isAllDataEntered:p}},directives:{maska:Ie},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1},roleOptions:ne}},methods:{onCreateButtonClick(){this.$emit("createUser",{firstName:this.firstName,lastName:this.lastName,telephoneNumber:this.telephoneNumber,role:this.selectedRole,brand_ids:this.selectedBrandsIds,branch_id:this.selectedBranchId})}}});const xe={class:"modal-content"},et={class:"button-box"};function tt(e,t,d,i,g,b){const c=u("a-select"),p=u("a-alert"),f=u("CustomButton"),a=u("CustomModal"),m=He("maska");return A(),J(a,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:v(()=>{var D,y,h;return[k("div",xe,[(A(),F("form",{onSubmit:t[12]||(t[12]=z((...n)=>e.onCreateButtonClick&&e.onCreateButtonClick(...n),["prevent"])),key:e.modalActive.toString()},[X(k("input",{placeholder:"Имя",type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>e.firstName=n),onInput:t[1]||(t[1]=(...n)=>e.validate&&e.validate(...n)),class:"inputFirstName"},null,544),[[oe,e.firstName]]),X(k("input",{placeholder:"Фамилия",type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>e.lastName=n),onInput:t[3]||(t[3]=(...n)=>e.validate&&e.validate(...n)),class:"inputLastName"},null,544),[[oe,e.lastName]]),X(k("input",{placeholder:"+7 ___ ___ __ __","data-maska":"+7 ### ### ## ##","onUpdate:modelValue":t[4]||(t[4]=n=>e.telephoneNumber=n),onInput:t[5]||(t[5]=(...n)=>e.validate&&e.validate(...n)),class:"inputTelephone"},null,544),[[m],[oe,e.telephoneNumber]]),r(c,{modelValue:e.selectedRole,"onUpdate:modelValue":t[6]||(t[6]=n=>e.selectedRole=n),placeholder:"Выберите роль",style:{width:"100%"},options:e.roleOptions.map(n=>({label:n.text,value:n.value})),onChange:t[7]||(t[7]=n=>e.onRoleSelected(n))},null,8,["modelValue","options"]),X(r(c,{modelValue:e.selectedBranchId,"onUpdate:modelValue":t[8]||(t[8]=n=>e.selectedBranchId=n),"show-search":"",placeholder:"Выберите филиал",style:{width:"100%",margin:"24px auto"},options:(D=e.branches)==null?void 0:D.map(n=>({label:n.title.toString(),value:n.id.toString()})),"filter-option":e.filterOption,onChange:t[9]||(t[9]=n=>e.onBranchSelected(n))},null,8,["modelValue","options","filter-option"]),[[me,e.selectedRole=="branch_director"||e.selectedRole=="sales_manager"]]),X(r(c,{modelValue:e.selectedBrandsIds,"onUpdate:modelValue":t[10]||(t[10]=n=>e.selectedBrandsIds=n),mode:"multiple","show-search":"",placeholder:"Выберите бренд",class:"selector-with_multiple-select",options:(y=e.brands)==null?void 0:y.map(n=>({label:n.title.toString(),value:n.id.toString()})),"filter-option":e.filterOption,onChange:t[11]||(t[11]=n=>e.onBrandSelected(n)),showArrow:""},null,8,["modelValue","options","filter-option"]),[[me,e.selectedRole=="branch_director"||e.selectedRole=="sales_manager"]]),(((h=e.errorMessage)==null?void 0:h.length)??0)>0?(A(),J(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):O("",!0),k("div",et,[r(f,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:v(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(f,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:v(()=>[T(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const ot=q(Ze,[["render",tt],["__scopeId","data-v-e2ab15a9"]]),lt=L({name:"ThreeDotUsers",setup(e,{emit:t}){const d=s(!1),i=s(!1);return{menu:d,show_deleted:i,toggleShowDeleted:()=>{t("toggleShowDeleted",i.value)}}}});const nt={class:"three-dots-users"},at={class:"flex"};function st(e,t,d,i,g,b){const c=u("v-icon"),p=u("v-btn"),f=u("v-checkbox"),a=u("v-list-item"),m=u("v-list"),D=u("v-menu");return A(),F("div",nt,[r(D,{modelValue:e.menu,"onUpdate:modelValue":t[1]||(t[1]=y=>e.menu=y),"close-on-content-click":!1,location:"end"},{activator:v(({props:y})=>[r(p,ge({class:"custom-btn",icon:""},y,{variant:"plain"}),{default:v(()=>[r(c,null,{default:v(()=>[T("mdi-dots-vertical")]),_:1})]),_:2},1040)]),default:v(()=>[r(m,null,{default:v(()=>[r(a,null,{default:v(()=>[k("div",at,[r(f,{label:"Показать удаленные",color:"#1CB5C2",modelValue:e.show_deleted,"onUpdate:modelValue":t[0]||(t[0]=y=>e.show_deleted=y),onChange:e.toggleShowDeleted},null,8,["modelValue","onChange"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const rt=q(lt,[["render",st],["__scopeId","data-v-d28f0a19"]]),dt=L({name:"ActionsBlock",components:{ThreeDotUsers:rt},props:{branches:Array,brands:Array,allSelected:Boolean,selectedUsers:Array},setup(e,{emit:t}){const d=s([]),i=s([]),g=s([]),b=s(e.allSelected),c=s(!1);return R(d,h=>{t("updateRolesFilter",h)}),R(i,h=>{console.log("branches",e.branches),t("updateBrandsFilter",h)}),R(g,h=>{t("updateBranchesFilter",h)}),R(()=>e.allSelected,h=>{b.value=h}),{selectedRoles:d,selectedBrands:i,selectedBranches:g,allSelected:b,toggleAll:()=>{t("toggleAll")},handleEditRole:()=>{t("editRoleClicked")},handleEditBranch:()=>{t("editBranchClicked")},handleEditBrand:()=>{t("editBrandClicked")},handleDeleteUsers:()=>{t("deleteUserClicked")},showDeletedUsers:c,toggleShowDeleted:h=>{t("toggleShowDeleted",h)},roleOptions:ne}}});const ut={class:"outer_actions_block"},it={class:"actions_first_block"},ct=k("span",{class:"deleteText"},"Удалить",-1),pt={class:"actions_inner_cards"},ht={key:0,class:"innerSpan"},mt={key:0,class:"innerSpan"},vt={key:0,class:"innerSpan"};function gt(e,t,d,i,g,b){var S,j;const c=u("v-checkbox"),p=u("v-icon"),f=u("v-btn"),a=u("v-list-item-content"),m=u("v-list-item"),D=u("v-list"),y=u("v-menu"),h=u("v-select"),n=u("ThreeDotUsers");return A(),F("div",ut,[k("div",it,[r(c,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=C=>e.allSelected=C),onChange:e.toggleAll},null,8,["modelValue","onChange"]),r(y,null,{activator:v(({props:C})=>{var E,Q;return[r(f,ge({color:"primary"},C,{variant:(((E=e.selectedUsers)==null?void 0:E.length)??0)>0?"tonal":"text",disabled:(((Q=e.selectedUsers)==null?void 0:Q.length)??0)===0,style:{width:"270px","text-align":"left"}}),{default:v(()=>{var H,K,W;return[T(ee((((H=e.selectedUsers)==null?void 0:H.length)??0)>0?"Выбрано пользователей "+(((K=e.selectedUsers)==null?void 0:K.length)??0)+"  ":"Выбрать все")+" ",1),(((W=e.selectedUsers)==null?void 0:W.length)??0)>0?(A(),J(p,{key:0},{default:v(()=>[T("mdi-chevron-down")]),_:1})):O("",!0)]}),_:2},1040,["variant","disabled"])]}),default:v(()=>[r(D,null,{default:v(()=>[r(m,{onClick:e.handleEditRole},{default:v(()=>[r(a,null,{default:v(()=>[T("Поменять роль")]),_:1})]),_:1},8,["onClick"]),r(m,{onClick:e.handleEditBranch},{default:v(()=>[r(a,null,{default:v(()=>[T("Поменять филиал")]),_:1})]),_:1},8,["onClick"]),r(m,{onClick:e.handleEditBrand},{default:v(()=>[r(a,null,{default:v(()=>[T("Поменять бренд")]),_:1})]),_:1},8,["onClick"]),r(m,{onClick:e.handleDeleteUsers},{default:v(()=>[r(a,null,{default:v(()=>[ct]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),k("div",pt,[r(h,{modelValue:e.selectedRoles,"onUpdate:modelValue":t[1]||(t[1]=C=>e.selectedRoles=C),items:e.roleOptions,"item-title":"text","item-value":"value",multiple:"",chip:"","small-chips":"",style:{width:"144px"},placeholder:"Роли",variant:"outlined",color:"#1CB5C2","bg-color":"#00000000","placeholder-color":"red",class:"demo"},{selection:v(({index:C})=>[C===0?(A(),F("span",ht,"Роли")):O("",!0)]),_:1},8,["modelValue","items"]),r(h,{modelValue:e.selectedBrands,"onUpdate:modelValue":t[2]||(t[2]=C=>e.selectedBrands=C),items:(S=e.brands)==null?void 0:S.map(C=>({text:C.title.toString(),value:C.id.toString()})),"item-title":"text","item-value":"value",multiple:"",chip:"","small-chips":"",style:{width:"144px"},placeholder:"Бренды",variant:"outlined",color:"#1CB5C2","bg-color":"#00000000","placeholder-color":"red"},{selection:v(({index:C})=>[C===0?(A(),F("span",mt,"Бренд")):O("",!0)]),_:1},8,["modelValue","items"]),r(h,{modelValue:e.selectedBranches,"onUpdate:modelValue":t[3]||(t[3]=C=>e.selectedBranches=C),items:(j=e.branches)==null?void 0:j.map(C=>({text:C.title.toString(),value:C.id.toString()})),"item-title":"text","item-value":"value",multiple:"",chip:"","small-chips":"",style:{width:"144px"},placeholder:"Филиал",variant:"outlined",color:"#1CB5C2","bg-color":"#00000000","placeholder-color":"red"},{selection:v(({index:C})=>[C===0?(A(),F("span",vt,"Филиалы")):O("",!0)]),_:1},8,["modelValue","items"]),r(n,{onToggleShowDeleted:e.toggleShowDeleted},null,8,["onToggleShowDeleted"])])])}const fe=q(dt,[["render",gt]]),ft=L({name:"HeaderBar",components:{ActionsBlock:fe,CustomButton:x},props:{isCreate:{type:Boolean,default:!1},handleSearch:{type:Function,required:!0},branches:Array,brands:Array,allSelected:Boolean,selectedUsers:Array},data(){},setup(e,{emit:t}){const d=s(""),i=s(e.allSelected),g=Pe.debounce(S=>{e.handleSearch(S)},700),b=S=>{d.value=S,g(S)};return R(()=>e.allSelected,S=>{i.value=S}),{inputValue:d,allSelected:i,handleInput:b,handleUpdateRolesFilter:S=>{t("updateRolesFilter",S)},handleUpdateBrandsFilter:S=>{t("updateBrandsFilter",S)},handleUpdateBranchesFilter:S=>{t("updateBranchesFilter",S)},handleRoleUpdate:()=>{t("editRoleClicked")},handleBrandUpdate:()=>{t("editBrandClicked")},handleBranchUpdate:()=>{t("editBranchClicked")},toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteUserClicked")},toggleShowDeleted:S=>{t("toggleShowDeleted",S)}}}});const Bt=e=>(Ke("data-v-fcb622c0"),e=e(),We(),e),bt={class:"header_container"},Ct={class:"header-body"},_t={class:"input-wrapper"},Ut=Bt(()=>k("img",{src:Je,class:"search-icon",alt:"Search"},null,-1));function yt(e,t,d,i,g,b){const c=u("CustomButton"),p=u("ActionsBlock");return A(),F("div",bt,[k("div",Ct,[k("div",_t,[Ut,X(k("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=f=>e.inputValue=f),onInput:t[1]||(t[1]=f=>e.handleInput(e.inputValue))},null,544),[[oe,e.inputValue]])]),r(c,{onClick:t[2]||(t[2]=f=>e.$emit("modalToggler"))},{default:v(()=>[T(ee(e.isCreate?"Создать":"Добавить"),1)]),_:1})]),r(p,{brands:e.brands,branches:e.branches,allSelected:e.allSelected,onUpdateRolesFilter:e.handleUpdateRolesFilter,onUpdateBrandsFilter:e.handleUpdateBrandsFilter,onUpdateBranchesFilter:e.handleUpdateBranchesFilter,onEditRoleClicked:e.handleRoleUpdate,onEditBrandClicked:e.handleBrandUpdate,onEditBranchClicked:e.handleBranchUpdate,onDeleteUserClicked:e.handleDelete,onToggleAll:e.toggleAll,onToggleShowDeleted:e.toggleShowDeleted,selectedUsers:e.selectedUsers},null,8,["brands","branches","allSelected","onUpdateRolesFilter","onUpdateBrandsFilter","onUpdateBranchesFilter","onEditRoleClicked","onEditBrandClicked","onEditBranchClicked","onDeleteUserClicked","onToggleAll","onToggleShowDeleted","selectedUsers"])])}const St=q(ft,[["render",yt],["__scopeId","data-v-fcb622c0"]]);function kt(){const e=s([]),t=s(!0);let d=s(0);const i=57,g=s(12),b=()=>{const f=window.innerHeight;g.value=Math.floor((f-310)/i)};ve(()=>{b(),window.addEventListener("resize",b),p(1,"",[],[],[],void 0,!1)}),Ge(()=>{window.removeEventListener("resize",b)});const c={Authorization:N},p=async(f,a,m,D,y,h,n)=>{var S,j;try{const C=m.map(G=>`&role_keys=${encodeURIComponent(G)}`).join("&"),E=D.map(G=>`&brand_ids=${encodeURIComponent(G)}`).join("&"),Q=y.map(G=>`&branch_ids=${encodeURIComponent(G)}`).join("&"),H=!h||h.sortState==="none"?"":`&sort_field=${h.columnName=="fullName"?"fio":"branch"}&sort_type=${h.sortState}`;console.log("roleKeysParams=",C),console.log("sortParams=",H);const K=`${V}/users?page=${f-1}&size=${g.value}${C}${E}${Q}${H}&show_deleted=${n}&search=${a}`;console.log("url=",K);const W=await ze.get(K,{headers:c});e.value=(S=W.data)==null?void 0:S.result,d.value=(j=W.data)==null?void 0:j.count}catch(C){console.log(C)}finally{t.value=!1}};return ve(()=>{p(1,"",[],[],[],void 0,!1)}),{users:e,isLoading:t,totalCount:d,size:g,fetching:p}}const wt=L({components:{CustomButton:x,CustomModal:le},props:{modalTitle:{type:String,default:"Поменять роль"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e,{emit:t}){const d=s(null),i=()=>{t("editRoleFromDropDown",{role:d.value})};return R(()=>e.modalActive,()=>{d.value=null}),{selectedRole:d,onEditButtonClick:i,roleOptions:ne}}});const At={class:"modal-content"},Dt={key:0,class:"error-message"},$t={class:"buttons_block"};function Mt(e,t,d,i,g,b){const c=u("v-select"),p=u("CustomButton"),f=u("CustomModal");return A(),J(f,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:v(()=>[k("div",At,[k("form",{onSubmit:t[1]||(t[1]=z((...a)=>e.onEditButtonClick&&e.onEditButtonClick(...a),["prevent"]))},[r(c,{items:e.roleOptions,modelValue:e.selectedRole,"onUpdate:modelValue":t[0]||(t[0]=a=>e.selectedRole=a),"item-title":"text","item-value":"value",placeholder:"Выберите роль",variant:"outlined",style:{width:"100%","margin-bottom":"24px"}},null,8,["items","modelValue"]),e.errorMessage?(A(),F("div",Dt,ee(e.errorMessage),1)):O("",!0),k("div",$t,[r(p,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:v(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(p,{type:"submit"},{default:v(()=>[T(" Сохранить ")]),_:1})])],32)])]),_:1},8,["onClose","modalActive","modal-title"])}const Tt=q(wt,[["render",Mt],["__scopeId","data-v-93dc129b"]]),Et=L({components:{CustomButton:x,CustomModal:le},props:{modalTitle:{type:String,default:"Поменять бренд"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,brands:Array},setup(e,{emit:t}){const d=s(null),i=()=>{console.log("selectedBrand.value",d.value),t("editBrandFromDropDown",{brand:d.value})};return R(()=>e.modalActive,()=>{d.value=null}),{selectedBrand:d,onEditButtonClick:i}}});const Rt={class:"modal-content"},Ft={key:0,class:"error-message"},Vt={class:"buttons_block"};function Nt(e,t,d,i,g,b){const c=u("v-select"),p=u("CustomButton"),f=u("CustomModal");return A(),J(f,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:v(()=>{var a;return[k("div",Rt,[k("form",{onSubmit:t[1]||(t[1]=z((...m)=>e.onEditButtonClick&&e.onEditButtonClick(...m),["prevent"]))},[r(c,{items:(a=e.brands)==null?void 0:a.map(m=>({text:m.title.toString(),value:m.id.toString()})),modelValue:e.selectedBrand,"onUpdate:modelValue":t[0]||(t[0]=m=>e.selectedBrand=m),"item-title":"text","item-value":"value",placeholder:"Выберите бренд",variant:"outlined",color:"#1CB5C2",multiple:"",style:{width:"100%","margin-bottom":"24px"}},null,8,["items","modelValue"]),e.errorMessage?(A(),F("div",Ft,ee(e.errorMessage),1)):O("",!0),k("div",Vt,[r(p,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:v(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(p,{type:"submit"},{default:v(()=>[T(" Сохранить ")]),_:1})])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Ot=q(Et,[["render",Nt],["__scopeId","data-v-6f0d9ccd"]]),jt=L({components:{CustomButton:x,CustomModal:le},props:{modalTitle:{type:String,default:"Поменять филиал"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String,branches:Array},setup(e,{emit:t}){const d=s(null),i=()=>{t("editBranchFromDropDown",{branch:d.value})};return R(()=>e.modalActive,()=>{d.value=null}),{selectedBranch:d,onEditButtonClick:i}}});const It={class:"modal-content"},Pt={key:0,class:"error-message"},Jt={class:"buttons_block"};function zt(e,t,d,i,g,b){const c=u("v-select"),p=u("CustomButton"),f=u("CustomModal");return A(),J(f,{onClose:z(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:v(()=>{var a;return[k("div",It,[k("form",{onSubmit:t[1]||(t[1]=z((...m)=>e.onEditButtonClick&&e.onEditButtonClick(...m),["prevent"]))},[r(c,{items:(a=e.branches)==null?void 0:a.map(m=>({text:m.title.toString(),value:m.id.toString()})),modelValue:e.selectedBranch,"onUpdate:modelValue":t[0]||(t[0]=m=>e.selectedBranch=m),"item-title":"text","item-value":"value",placeholder:"Выберите филиал",variant:"outlined",color:"#1CB5C2",style:{width:"100%","margin-bottom":"24px"}},null,8,["items","modelValue"]),e.errorMessage?(A(),F("div",Pt,ee(e.errorMessage),1)):O("",!0),k("div",Jt,[r(p,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:v(()=>[T(" Закрыть ")]),_:1},8,["onClick"]),r(p,{type:"submit"},{default:v(()=>[T(" Сохранить ")]),_:1})])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const Lt=q(jt,[["render",zt],["__scopeId","data-v-e1012e6c"]]),qt=L({name:"AllUsersListPage",components:{EditUserModal:Ye,DeleteModal:Le,ChangeBranchModal:Lt,ChangeBrandModal:Ot,ActionsBlock:fe,ChangeRole:Tt,CreatUserModal:ot,TableData:qe,HeaderBar:St},mounted(){const e={Authorization:N};fetch(`${V}/branches`,{headers:e}).then(t=>t.json()).then(t=>this.branches=t==null?void 0:t.result).catch(t=>console.log(t)),fetch(`${V}/brands`,{headers:e}).then(t=>t.json()).then(t=>this.brands=t==null?void 0:t.result).catch(t=>console.log(t))},setup(){const e=s([]),t=s([]),d=s([]),i=s(""),g=s([]),b=s([]),c=s([]),p=s(null),f=s([]),a=s([]),m=s(!1),D=s(!1),y=s(!1),h=s(!1),n=s(!1),S=s(!1),j=s(null),C=s(null),E=s(!1);R(a,o=>{o.length===Y.value.length&&Y.value.length!=0?m.value=!0:m.value=!1});function Q(){m.value?a.value=[]:a.value=Y.value.map(o=>o.id)}const H=o=>{let U=Y.value[o].id;a.value.includes(U)?a.value=a.value.filter(l=>l!==U):a.value=[...a.value,U]},K=(o,U)=>{Ee(o,U.id)},W=o=>{g.value=o},G=o=>{b.value=o},Be=o=>{c.value=o},ae=()=>{D.value=!D.value},se=()=>{y.value=!y.value},re=()=>{h.value=!h.value},be=()=>{ae()},Ce=()=>{se()},_e=()=>{re()},{users:te,isLoading:ce,fetching:I,totalCount:Ue,size:ye}=kt(),Y=Qe(()=>!te.value||ce.value?[]:(e.value=te.value,te.value.map(o=>({id:o.id,fullName:`${o.first_name} ${o.last_name}`,phone:`${o.phone.slice(0,2)} ${o.phone.slice(2,5)} ${o.phone.slice(5,8)}
          ${o.phone.slice(8,10)} ${o.phone.slice(10)}`,branch:`${o.role=="owner"?"-":o.branch_title??"-"}`,brand:`${o.role=="owner"?"-":o.brands.join(", ")}`,role:o.role,deleted:o.deleted})))),P=()=>{I(1,i.value,g.value,b.value,c.value,p.value,E.value),a.value=[]},Se=o=>{i.value=o};R(i,o=>{I(1,o,[],[],[],p.value,E.value),a.value=[]}),R(g,o=>{I(1,i.value,o,b.value,c.value,p.value,E.value),a.value=[]}),R(b,o=>{I(1,i.value,g.value,o,c.value,p.value,E.value),a.value=[]}),R(c,o=>{I(1,i.value,g.value,b.value,o,p.value,E.value),a.value=[]});const ke=o=>{o.value=o,I(1,i.value,g.value,b.value,c.value,o.value,E.value),console.log("sortState",o)},we=o=>{E.value=o,I(1,i.value,g.value,b.value,c.value,p.value,E.value),a.value=[]},Ae=o=>{const U={method:"PUT",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({user_ids:a.value,new_role:o.role})};fetch(`${V}/change-users-role`,U).then(async l=>{var B;const _=((B=l.headers.get("content-type"))==null?void 0:B.includes("application/json"))&&await l.json();if(!l.ok){const w=_&&_.message||l.status;return Promise.reject(w)}ae(),P()}).catch(l=>{setTimeout(()=>{M.value=o.error,setTimeout(()=>{M.value=""},3e3)},200),console.error("There was an error!",l)})},De=()=>{f.value=[...a.value],n.value=!0},$e=o=>{f.value=[o.id],n.value=!0},Me=o=>{console.log(o);const U={method:"PUT",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({UserIds:[o.id]})};fetch(`${V}/users/activate`,U).then(async l=>{var B;const _=((B=l.headers.get("content-type"))==null?void 0:B.includes("application/json"))&&await l.json();if(!l.ok){const w=_&&_.message||l.status;return Promise.reject(w)}P()}).catch(l=>{M.value=l.error,console.error("There was an error!",l)})},pe=()=>{n.value=!1},Te=o=>{var _;const U=e.value.find(B=>B.id==o.id);j.value=U;const l=(_=t.value.find(B=>B.title==U.branch_title))==null?void 0:_.id,$=[];for(let B=0;B<U.brands.length;B++)for(let w=0;w<d.value.length;w++)if(U.brands[B]==d.value[w].title){$.push(d.value[w].id);break}C.value={role:o.role,brandIds:$,branchId:l},ie()},Ee=(o,U)=>{const l={method:"PUT",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({user_ids:[U],new_role:o})};fetch(`${V}/change-users-role`,l).then(async $=>{var w;const B=((w=$.headers.get("content-type"))==null?void 0:w.includes("application/json"))&&await $.json();if(!$.ok){const je=B&&B.message||$.status;return Promise.reject(je)}P()}).catch($=>{M.value=$.error,console.error("There was an error!",$)})},Re=o=>{const U={method:"PUT",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({user_ids:a.value,new_brands_ids:o.brand.map(l=>Number(l))})};fetch(`${V}/change-users-brands`,U).then(async l=>{var B;const _=((B=l.headers.get("content-type"))==null?void 0:B.includes("application/json"))&&await l.json();if(!l.ok){const w=_&&_.message||l.status;return Promise.reject(w)}se(),P()}).catch(l=>{setTimeout(()=>{M.value=o.error,setTimeout(()=>{M.value=""},3e3)},200),console.error("There was an error!",l)})},Fe=o=>{const U={method:"PUT",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({user_ids:a.value,new_branch_id:Number(o.branch)})};fetch(`${V}/change-users-branch`,U).then(async l=>{var B;const _=((B=l.headers.get("content-type"))==null?void 0:B.includes("application/json"))&&await l.json();if(!l.ok){const w=_&&_.message||l.status;return Promise.reject(w)}re(),P()}).catch(l=>{setTimeout(()=>{M.value=o.error,setTimeout(()=>{M.value=""},3e3)},200),console.error("There was an error!",l)})},Ve=o=>{console.log("ids",o);const U={method:"DELETE",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({user_ids:o})};fetch(`${V}/users`,U).then(async l=>{var B;const _=((B=l.headers.get("content-type"))==null?void 0:B.includes("application/json"))&&await l.json();if(!l.ok){const w=_&&_.message||l.status;return Promise.reject(w)}pe(),P()}).catch(l=>{M.value=l.error,console.error("There was an error!",l)})},de=s(!1),ue=s(""),M=s(""),Z=s(""),Ne=o=>{const U={method:"POST",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({phone:o.telephoneNumber.replace(/\s/g,""),first_name:o.firstName,last_name:o.lastName,role:o.role,brand_ids:o.brand_ids.map(l=>Number(l)),branch_id:Number(o.branch_id)})};fetch(`${V}/user`,U).then(async l=>{var B;const _=((B=l.headers.get("content-type"))==null?void 0:B.includes("application/json"))&&await l.json();if(!l.ok){const w=_&&_.error||l;return setTimeout(()=>{M.value=_.error,setTimeout(()=>{M.value=""},3e3)},200),Promise.reject(w)}ue.value=_,he(),P(),setTimeout(()=>{Z.value="Новый пользователь успешно создан",setTimeout(()=>{Z.value=""},2e3)},200)}).catch(l=>{M.value=l.error,console.error("There was an error!",l)})},Oe=o=>{const U={method:"PUT",headers:{Authorization:N,"Content-Type":"application/json"},body:JSON.stringify({user_id:o.id,phone:o.telephoneNumber.replace(/\s/g,""),first_name:o.firstName,last_name:o.lastName,role:o.role,brand_ids:o.brand_ids.map(l=>Number(l)),branch_id:Number(o.branch_id)})};fetch(`${V}/update-user`,U).then(async l=>{var B;const _=((B=l.headers.get("content-type"))==null?void 0:B.includes("application/json"))&&await l.json();if(!l.ok){const w=_&&_.message||l.status;return console.log("HERE IT IS",w),setTimeout(()=>{M.value=_.error,setTimeout(()=>{M.value=""},3e3)},200),Promise.reject(w)}ue.value=_,ie(),P(),setTimeout(()=>{Z.value="Пользователь успешно отредактирован!",setTimeout(()=>{Z.value=""},2e3)},200)}).catch(l=>{M.value=l.error,console.error("There was an error!",l)})},he=()=>{de.value=!de.value},ie=()=>{S.value=!S.value,S.value==!1&&(C.value=null)};return{usersTableData:Y,isLoading:ce,users:te,totalCount:Ue,size:ye,fetching:I,handleSearch:Se,searchValue:i,selectedRoles:g,selectedBrands:b,selectedBranches:c,selectedUsers:a,toggleAll:Q,allSelected:m,toggleSelection:H,updateSelectedRoles:W,updateSelectedBrands:G,updateSelectedBranches:Be,editRoleModalToggler:ae,editBrandModalToggler:se,editBranchModalToggler:re,editRoleClicked:be,editBrandClicked:Ce,editBranchClicked:_e,editRoleAction:Ae,editBrandAction:Re,editBranchAction:Fe,deleteAction:Ve,editRoleModalActive:D,editBrandModalActive:y,editBranchModalActive:h,deleteModalActive:n,deleteUserClicked:De,editModalActive:S,editToggleModal:ie,onEditUser:Oe,branches:t,brands:d,handleSortSelected:ke,roleOptions:ne,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"fullName",label:"ФИО",width:"216px",withSort:!0},{key:"phone",label:"Номер телефона",width:"168px",withSort:!1},{key:"branch",label:"Филиал",width:"188px",withSort:!0},{key:"brand",label:"Бренд",width:"140px",withSort:!1},{key:"role",label:"Роль",width:"198px",withSort:!1}],onRoleSelected:K,onUserDelete:$e,onUserEdit:Te,deleteItems:f,closeDeleteModal:pe,onCreateUser:Ne,modalActive:de,createdUserId:ue,errorMessage:M,showAlert:Z,createUserModalToggler:he,selectedEditUser:j,selectedEditUserDefaultOption:C,toggleShowDeleted:we,showDeletedUsers:E,onUserRestore:Me}},watch:{}});const Ht={class:"content-body"},Kt={key:1};function Wt(e,t,d,i,g,b){const c=u("HeaderBar"),p=u("TableData"),f=u("CreatUserModal"),a=u("EditUserModal"),m=u("ChangeRole"),D=u("ChangeBrandModal"),y=u("ChangeBranchModal"),h=u("DeleteModal"),n=u("a-alert");return A(),F(Xe,null,[k("div",Ht,[r(c,{onModalToggler:e.createUserModalToggler,handleSearch:e.handleSearch,isCreate:!0,brands:e.brands,branches:e.branches,allSelected:e.allSelected,selectedUsers:e.selectedUsers,onUpdateRolesFilter:e.updateSelectedRoles,onUpdateBrandsFilter:e.updateSelectedBrands,onUpdateBranchesFilter:e.updateSelectedBranches,onEditRoleClicked:e.editRoleClicked,onEditBrandClicked:e.editBrandClicked,onEditBranchClicked:e.editBranchClicked,onDeleteUserClicked:e.deleteUserClicked,onToggleAll:e.toggleAll,onToggleShowDeleted:e.toggleShowDeleted},null,8,["onModalToggler","handleSearch","brands","branches","allSelected","selectedUsers","onUpdateRolesFilter","onUpdateBrandsFilter","onUpdateBranchesFilter","onEditRoleClicked","onEditBrandClicked","onEditBranchClicked","onDeleteUserClicked","onToggleAll","onToggleShowDeleted"]),e.isLoading?(A(),F("span",Kt,"Загрузка ...")):(A(),J(p,{key:0,tableData:e.usersTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,onUpdateRolesFilter:e.updateSelectedRoles,onUpdateBrandsFilter:e.updateSelectedBrands,onUpdateBranchesFilter:e.updateSelectedBranches,onToggleSelection:e.toggleSelection,filterRoles:e.selectedRoles,filterBrands:e.selectedBrands,filterBranches:e.selectedBranches,selectedUsers:e.selectedUsers,onOnRoleSelected:e.onRoleSelected,onOnUserDelete:e.onUserDelete,onOnUserEdit:e.onUserEdit,showDeletedUsers:e.showDeletedUsers,onOnUserRestore:e.onUserRestore},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","onUpdateRolesFilter","onUpdateBrandsFilter","onUpdateBranchesFilter","onToggleSelection","filterRoles","filterBrands","filterBranches","selectedUsers","onOnRoleSelected","onOnUserDelete","onOnUserEdit","showDeletedUsers","onOnUserRestore"]))]),r(f,{modalActive:e.modalActive,toggleModal:e.createUserModalToggler,onCreateUser:e.onCreateUser,brands:e.brands,branches:e.branches,errorMessage:e.errorMessage},null,8,["modalActive","toggleModal","onCreateUser","brands","branches","errorMessage"]),r(a,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditUser:e.onEditUser,brands:e.brands,branches:e.branches,errorMessage:e.errorMessage,user:e.selectedEditUser,defaultOption:e.selectedEditUserDefaultOption},null,8,["editModalActive","editToggleModal","onEditUser","brands","branches","errorMessage","user","defaultOption"]),r(m,{modalActive:e.editRoleModalActive,toggleModal:e.editRoleModalToggler,onEditRoleFromDropDown:e.editRoleAction},null,8,["modalActive","toggleModal","onEditRoleFromDropDown"]),r(D,{modalActive:e.editBrandModalActive,toggleModal:e.editBrandModalToggler,brands:e.brands,onEditBrandFromDropDown:e.editBrandAction},null,8,["modalActive","toggleModal","brands","onEditBrandFromDropDown"]),r(y,{modalActive:e.editBranchModalActive,toggleModal:e.editBranchModalToggler,branches:e.branches,onEditBranchFromDropDown:e.editBranchAction},null,8,["modalActive","toggleModal","branches","onEditBranchFromDropDown"]),r(h,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"]),e.showAlert.length>0?(A(),J(n,{key:0,message:e.showAlert,type:"success","show-icon":"",class:"success-alert"},null,8,["message"])):O("",!0)],64)}const Yt=q(qt,[["render",Wt],["__scopeId","data-v-7160d1f0"]]);export{Yt as default};
