import{C as H,l as ae,_ as ne,B as V,a as se,T as F,b as Q,c as ie,D as de}from"./DeleteModal-e3ce54f7.js";import{d as O,r as i,w,_ as P,a as r,o as f,c as j,b as T,e as g,f as y,m as ue,g as D,t as re,h as I,i as N,j as J,v as q,p as ce,k as pe,l as G,n as ge,q as U,s as me,F as ve}from"./index-16df9620.js";import{U as ye}from"./maska-82a16b27.js";const Te=O({name:"SaleTypesActionsBlock",props:{allSelected:Boolean,selectedSaleTypes:Array},setup(e,{emit:t}){const l=i(e.allSelected);return w(()=>e.allSelected,m=>{l.value=m}),{allSelected:l,toggleAll:()=>{t("toggleAll")},handleDeleteSaleType:()=>{t("deleteSaleTypeClicked")},roleOptions:[]}}});const Se={class:"outer_actions_block"},he={class:"actions_first_block"},_e=T("span",{class:"deleteText"},"Удалить",-1);function fe(e,t,l,u,c,m){const p=r("v-checkbox"),a=r("v-icon"),n=r("v-btn"),v=r("v-list-item-content"),d=r("v-list-item"),S=r("v-list"),k=r("v-menu");return f(),j("div",Se,[T("div",he,[g(p,{color:"#1CB5C2",style:{"padding-left":"0"},modelValue:e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=C=>e.allSelected=C),onChange:e.toggleAll},null,8,["modelValue","onChange"]),g(k,null,{activator:y(({props:C})=>{var A,M;return[g(n,ue({color:"primary"},C,{variant:(((A=e.selectedSaleTypes)==null?void 0:A.length)??0)>0?"tonal":"text",disabled:(((M=e.selectedSaleTypes)==null?void 0:M.length)??0)===0,style:{width:"140px","text-align":"left"}}),{default:y(()=>{var $,E,z;return[D(re(((($=e.selectedSaleTypes)==null?void 0:$.length)??0)>0?"Выбрано "+(((E=e.selectedSaleTypes)==null?void 0:E.length)??0)+"  ":"Выбрать все")+" ",1),(((z=e.selectedSaleTypes)==null?void 0:z.length)??0)>0?(f(),I(a,{key:0},{default:y(()=>[D("mdi-chevron-down")]),_:1})):N("",!0)]}),_:2},1040,["variant","disabled"])]}),default:y(()=>[g(S,null,{default:y(()=>[g(d,{onClick:e.handleDeleteSaleType},{default:y(()=>[g(v,null,{default:y(()=>[_e]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const Ce=P(Te,[["render",fe]]),Ae=O({name:"SaleTypesHeaderBar",components:{SaleTypesActionsBlock:Ce,CustomButton:H},props:{handleSearch:{type:Function,required:!0},allSelected:Boolean,selectedSaleTypes:Array},data(){},setup(e,{emit:t}){const l=i(""),u=i(e.allSelected),c=ae.debounce(n=>{e.handleSearch(n)},700),m=n=>{l.value=n,c(n)};return w(()=>e.allSelected,n=>{u.value=n}),{inputValue:l,allSelected:u,handleInput:m,toggleAll:()=>{t("toggleAll")},handleDelete:()=>{t("deleteSaleTypeClicked")}}}});const Me=e=>(ce("data-v-ba4c5485"),e=e(),pe(),e),$e={class:"header_container"},be={class:"header-body"},De={class:"input-wrapper"},ke=Me(()=>T("img",{src:ne,class:"search-icon",alt:"Search"},null,-1));function Ee(e,t,l,u,c,m){const p=r("CustomButton"),a=r("SaleTypesActionsBlock");return f(),j("div",$e,[T("div",be,[T("div",De,[ke,J(T("input",{type:"text",placeholder:"Поиск","onUpdate:modelValue":t[0]||(t[0]=n=>e.inputValue=n),onInput:t[1]||(t[1]=n=>e.handleInput(e.inputValue))},null,544),[[q,e.inputValue]])]),g(p,{onClick:t[2]||(t[2]=n=>e.$emit("modalToggler"))},{default:y(()=>[D("Создать")]),_:1})]),g(a,{allSelected:e.allSelected,onDeleteSaleTypeClicked:e.handleDelete,onToggleAll:e.toggleAll,selectedSaleTypes:e.selectedSaleTypes},null,8,["allSelected","onDeleteSaleTypeClicked","onToggleAll","selectedSaleTypes"])])}const Be=P(Ae,[["render",Ee],["__scopeId","data-v-ba4c5485"]]);function we(){const e=i([]),t=i(!0);let l=i(0);const u=57,c=i(12),m=()=>{const n=window.innerHeight;c.value=Math.floor((n-310)/u)};G(()=>{m(),window.addEventListener("resize",m),a(1,"",void 0)}),ge(()=>{window.removeEventListener("resize",m)});const p={Authorization:F},a=async(n,v,d)=>{var S,k;try{const C=!d||d.sortState==="none"?"":`&sort_field=title&sort_type=${d.sortState}`,A=`${V}/sale-types?page=${n-1}&size=${c.value}${C}&search=${v}`,M=await se.get(A,{headers:p});e.value=(S=M.data)==null?void 0:S.result,l.value=(k=M.data)==null?void 0:k.count}catch(C){console.log(C)}finally{t.value=!1}};return G(()=>{a(1,"",void 0)}),{saleTypes:e,isLoading:t,totalCount:l,size:c,fetching:a}}const Ie=O({components:{CustomButton:H,CustomModal:Q},props:{modalTitle:{type:String,default:"Создать Тип Продаж"},modalActive:{type:Boolean,default:!1},toggleModal:{type:Function,required:!0},errorMessage:String},setup(e){const t=i(""),l=i(!1);return w(()=>e.modalActive,()=>{t.value="",l.value=!1}),{title:t,validate:()=>{t.value.length>0?l.value=!0:l.value=!1},isAllDataEntered:l}},methods:{onCreateButtonClick(){this.$emit("createSaleType",{title:this.title})}}});const Ve={class:"modal-content"},Fe={class:"button-box"};function je(e,t,l,u,c,m){const p=r("a-alert"),a=r("CustomButton"),n=r("CustomModal");return f(),I(n,{onClose:U(e.toggleModal,["prevent"]),modalActive:e.modalActive,"modal-title":e.modalTitle},{default:y(()=>{var v;return[T("div",Ve,[(f(),j("form",{onSubmit:t[2]||(t[2]=U((...d)=>e.onCreateButtonClick&&e.onCreateButtonClick(...d),["prevent"])),key:e.modalActive.toString()},[J(T("input",{placeholder:"Название бренда",type:"text","onUpdate:modelValue":t[0]||(t[0]=d=>e.title=d),onInput:t[1]||(t[1]=(...d)=>e.validate&&e.validate(...d)),class:"inputFirstName"},null,544),[[q,e.title]]),(((v=e.errorMessage)==null?void 0:v.length)??0)>0?(f(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),T("div",Fe,[g(a,{onClick:e.toggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),g(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[D(" Создать ")]),_:1},8,["additional-styles","disabled"])])],32))])]}),_:1},8,["onClose","modalActive","modal-title"])}const Oe=P(Ie,[["render",je],["__scopeId","data-v-538d5dae"]]),Pe=O({components:{CustomButton:H,CustomModal:Q},props:{modalTitle:{type:String,default:"Редактировать филиал"},editModalActive:{type:Boolean,default:!1},editToggleModal:{type:Function,required:!0},errorMessage:String,curSaleType:Object},setup(e){const t=i(""),l=i(!1);w(()=>e.curSaleType,c=>{t.value=c.title,u()});const u=()=>{t.value.length>0?l.value=!0:l.value=!1};return{title:t,validate:u,isAllDataEntered:l}},directives:{maska:ye},data(){return{maskedValue:"",bindedObject:{masked:"",unmasked:"",completed:!1}}},methods:{onSaveButtonClick(e){console.log("title=",this.title),this.$emit("editSaleType",{title:this.title,id:e})}}});const ze={class:"modal-content"},Ue={class:"button-box"};function Le(e,t,l,u,c,m){const p=r("a-alert"),a=r("CustomButton"),n=r("CustomModal");return f(),I(n,{onClose:U(e.editToggleModal,["prevent"]),modalActive:e.editModalActive,"modal-title":e.modalTitle},{default:y(()=>{var v;return[T("div",ze,[T("form",{onSubmit:t[2]||(t[2]=U(d=>{var S;return e.onSaveButtonClick(((S=e.curSaleType)==null?void 0:S.id)??0)},["prevent"]))},[J(T("input",{placeholder:"Название типа продажи",type:"text","onUpdate:modelValue":t[0]||(t[0]=d=>e.title=d),onInput:t[1]||(t[1]=(...d)=>e.validate&&e.validate(...d)),class:"inputFirstName"},null,544),[[q,e.title]]),(((v=e.errorMessage)==null?void 0:v.length)??0)>0?(f(),I(p,{key:0,type:"error",style:{"margin-top":"16px"},message:e.errorMessage,"show-icon":""},null,8,["message"])):N("",!0),T("div",Ue,[g(a,{onClick:e.editToggleModal,type:"button","additional-styles":{color:"#333",border:"1px solid #999",opacity:"0.5",background:"#FFF"}},{default:y(()=>[D(" Закрыть ")]),_:1},8,["onClick"]),g(a,{type:"submit","additional-styles":{opacity:`${e.isAllDataEntered?"1":"0.5"}`},disabled:!e.isAllDataEntered},{default:y(()=>[D(" Сохранить ")]),_:1},8,["additional-styles","disabled"])])],32)])]}),_:1},8,["onClose","modalActive","modal-title"])}const He=P(Pe,[["render",Le],["__scopeId","data-v-d9f8b4d6"]]),Ne=O({name:"SaleTypeListPage",components:{TableData:ie,DeleteModal:de,SaleTypesHeaderBar:Be,CreateSaleTypeModal:Oe,EditSaleTypeModal:He},mounted(){const e={Authorization:F};fetch(`${V}/sale-types`,{headers:e}).then(t=>t.json()).then(t=>this.saleTypes=t==null?void 0:t.result).catch(t=>console.log(t))},setup(){const e=i(!1),t=i(!1),l=i(""),u=i(""),c=i(""),m=i(null),p=i(!1),a=i([]),n=i([]),{saleTypes:v,isLoading:d,fetching:S,totalCount:k,size:C}=we(),A=i(!1),M=i(null),$=me(()=>!v.value||d.value?[]:v.value.map(o=>({id:o.id,title:o.title}))),E=()=>{S(1,c.value,m.value),a.value=[]},z=o=>{c.value=o};w(c,o=>{S(1,o,m.value),a.value=[]});const R=()=>{e.value=!e.value},W=o=>{const h={method:"POST",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({title:o.title})};console.log("CREATE SALE TYPE",o,h),fetch(`${V}/sale-type`,h).then(async s=>{var b;const _=((b=s.headers.get("content-type"))==null?void 0:b.includes("application/json"))&&await s.json();if(!s.ok){const B=_&&_.error||s;return setTimeout(()=>{l.value=_.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}R(),E(),setTimeout(()=>{u.value="Новый Тип Продаж успешно создан",setTimeout(()=>{u.value=""},2e3)},200)}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},X=o=>{console.log("ids",o);const h={method:"DELETE",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({sale_type_ids:o})};console.log("requestOptions",h),fetch(`${V}/sale-type`,h).then(async s=>{var b;const _=((b=s.headers.get("content-type"))==null?void 0:b.includes("application/json"))&&await s.json();if(!s.ok){const B=_&&_.message||s.status;return setTimeout(()=>{l.value=_.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}K(),E()}).catch(s=>{setTimeout(()=>{l.value=s.error,setTimeout(()=>{l.value=""},3e3)},200),console.error("There was an error!",s)})},Z=()=>{n.value=[...a.value],t.value=!0,console.log("DELETE2",n)},x=o=>{console.log("onDelete",o),n.value=[o.id],t.value=!0},ee=o=>{console.log("onEdit",o),M.value=o,L()},K=()=>{t.value=!1};function te(){p.value?a.value=[]:a.value=$.value.map(o=>o.id)}const le=o=>{o.value=o,S(1,c.value,o.value)},oe=o=>{let h=$.value[o].id;a.value.includes(h)?a.value=a.value.filter(s=>s!==h):a.value=[...a.value,h]};w(a,o=>{o.length===$.value.length&&$.value.length!=0?p.value=!0:p.value=!1});const L=()=>{A.value=!A.value};return{saleTypesTableData:$,isLoading:d,fetching:S,totalCount:k,size:C,tableColumns:[{key:"id",label:"ID",width:"56px",withSort:!1},{key:"title",label:"Название",width:"684px",withSort:!0}],createSaleTypeModalToggler:R,modalActive:e,searchValue:c,onCreateSaleType:W,saleTypes:v,errorMessage:l,handleSearch:z,allSelected:p,selectedSaleTypeIds:a,deleteSaleTypeClicked:Z,deleteModalActive:t,onSaleTypeDelete:x,closeDeleteModal:K,toggleAll:te,handleSortSelected:le,toggleSelection:oe,onSaleTypeEdit:ee,deleteItems:n,deleteAction:X,showAlert:u,editModalActive:A,editToggleModal:L,onEditSaleType:o=>{const h={method:"PUT",headers:{Authorization:F,"Content-Type":"application/json"},body:JSON.stringify({sale_type_id:o.id,title:o.title})};fetch(`${V}/sale-type`,h).then(async s=>{var b;const _=((b=s.headers.get("content-type"))==null?void 0:b.includes("application/json"))&&await s.json();if(!s.ok){const B=_&&_.message||s.status;return console.log("HERE IT IS",B),setTimeout(()=>{l.value=_.error,setTimeout(()=>{l.value=""},3e3)},200),Promise.reject(B)}L(),E(),setTimeout(()=>{u.value="Тип продаж успешно отредактирован!",setTimeout(()=>{u.value=""},2e3)},200)}).catch(s=>{l.value=s.error,console.error("There was an error!",s)})},selectedEditSaleType:M}}});const Je={class:"content-body"},qe={key:1};function Re(e,t,l,u,c,m){const p=r("SaleTypesHeaderBar"),a=r("TableData"),n=r("CreateSaleTypeModal"),v=r("EditSaleTypeModal"),d=r("DeleteModal");return f(),j(ve,null,[T("div",Je,[g(p,{onModalToggler:e.createSaleTypeModalToggler,handleSearch:e.handleSearch,allSelected:e.allSelected,selectedSaleTypes:e.selectedSaleTypeIds,onDeleteSaleTypeClicked:e.deleteSaleTypeClicked,onToggleAll:e.toggleAll},null,8,["onModalToggler","handleSearch","allSelected","selectedSaleTypes","onDeleteSaleTypeClicked","onToggleAll"]),e.isLoading?(f(),j("span",qe,"Загрузка ...")):(f(),I(a,{key:0,tableData:e.saleTypesTableData,columns:e.tableColumns,onSortSelected:e.handleSortSelected,onHandlePageChange:e.fetching,totalCount:e.totalCount,size:e.size,searchValue:e.searchValue,selectedUsers:e.selectedSaleTypeIds,onToggleSelection:e.toggleSelection,onOnUserDelete:e.onSaleTypeDelete,onOnUserEdit:e.onSaleTypeEdit},null,8,["tableData","columns","onSortSelected","onHandlePageChange","totalCount","size","searchValue","selectedUsers","onToggleSelection","onOnUserDelete","onOnUserEdit"]))]),g(n,{toggleModal:e.createSaleTypeModalToggler,modalActive:e.modalActive,onCreateSaleType:e.onCreateSaleType,errorMessage:e.errorMessage},null,8,["toggleModal","modalActive","onCreateSaleType","errorMessage"]),g(v,{editModalActive:e.editModalActive,editToggleModal:e.editToggleModal,onEditSaleType:e.onEditSaleType,errorMessage:e.errorMessage,curSaleType:e.selectedEditSaleType},null,8,["editModalActive","editToggleModal","onEditSaleType","errorMessage","curSaleType"]),g(d,{deleteItems:e.deleteItems,modalActive:e.deleteModalActive,toggleModal:e.closeDeleteModal,onDeleteFromDropDown:e.deleteAction,type:"saleType"},null,8,["deleteItems","modalActive","toggleModal","onDeleteFromDropDown"])],64)}const We=P(Ne,[["render",Re],["__scopeId","data-v-f0808330"]]);export{We as default};
